(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function t(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(n){if(n.ep)return;n.ep=!0;const s=t(n);fetch(n.href,s)}})();var xe=1e-6,K=typeof Float32Array<"u"?Float32Array:Array;function Bt(){var o=new K(9);return K!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[5]=0,o[6]=0,o[7]=0),o[0]=1,o[4]=1,o[8]=1,o}function me(){var o=new K(16);return K!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0),o[0]=1,o[5]=1,o[10]=1,o[15]=1,o}function Ht(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function tt(o,e){var t=e[0],i=e[1],n=e[2],s=e[3],r=e[4],a=e[5],l=e[6],h=e[7],d=e[8],c=e[9],m=e[10],u=e[11],_=e[12],p=e[13],g=e[14],b=e[15],y=t*a-i*r,D=t*l-n*r,v=t*h-s*r,x=i*l-n*a,C=i*h-s*a,O=n*h-s*l,k=d*p-c*_,F=d*g-m*_,V=d*b-u*_,H=c*g-m*p,j=c*b-u*p,G=m*b-u*g,z=y*G-D*j+v*H+x*V-C*F+O*k;return z?(z=1/z,o[0]=(a*G-l*j+h*H)*z,o[1]=(n*j-i*G-s*H)*z,o[2]=(p*O-g*C+b*x)*z,o[3]=(m*C-c*O-u*x)*z,o[4]=(l*V-r*G-h*F)*z,o[5]=(t*G-n*V+s*F)*z,o[6]=(g*v-_*O-b*D)*z,o[7]=(d*O-m*v+u*D)*z,o[8]=(r*j-a*V+h*k)*z,o[9]=(i*V-t*j-s*k)*z,o[10]=(_*C-p*v+b*y)*z,o[11]=(c*v-d*C-u*y)*z,o[12]=(a*F-r*H-l*k)*z,o[13]=(t*H-i*F+n*k)*z,o[14]=(p*D-_*x-g*y)*z,o[15]=(d*x-c*D+m*y)*z,o):null}function Ut(o,e,t){var i=e[0],n=e[1],s=e[2],r=e[3],a=e[4],l=e[5],h=e[6],d=e[7],c=e[8],m=e[9],u=e[10],_=e[11],p=e[12],g=e[13],b=e[14],y=e[15],D=t[0],v=t[1],x=t[2],C=t[3];return o[0]=D*i+v*a+x*c+C*p,o[1]=D*n+v*l+x*m+C*g,o[2]=D*s+v*h+x*u+C*b,o[3]=D*r+v*d+x*_+C*y,D=t[4],v=t[5],x=t[6],C=t[7],o[4]=D*i+v*a+x*c+C*p,o[5]=D*n+v*l+x*m+C*g,o[6]=D*s+v*h+x*u+C*b,o[7]=D*r+v*d+x*_+C*y,D=t[8],v=t[9],x=t[10],C=t[11],o[8]=D*i+v*a+x*c+C*p,o[9]=D*n+v*l+x*m+C*g,o[10]=D*s+v*h+x*u+C*b,o[11]=D*r+v*d+x*_+C*y,D=t[12],v=t[13],x=t[14],C=t[15],o[12]=D*i+v*a+x*c+C*p,o[13]=D*n+v*l+x*m+C*g,o[14]=D*s+v*h+x*u+C*b,o[15]=D*r+v*d+x*_+C*y,o}function Ft(o,e,t,i,n){var s=1/Math.tan(e/2);if(o[0]=s/t,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=s,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,n!=null&&n!==1/0){var r=1/(i-n);o[10]=(n+i)*r,o[14]=2*n*i*r}else o[10]=-1,o[14]=-2*i;return o}var jt=Ft;function $t(o,e,t,i){var n,s,r,a,l,h,d,c,m,u,_=e[0],p=e[1],g=e[2],b=i[0],y=i[1],D=i[2],v=t[0],x=t[1],C=t[2];return Math.abs(_-v)<xe&&Math.abs(p-x)<xe&&Math.abs(g-C)<xe?Ht(o):(d=_-v,c=p-x,m=g-C,u=1/Math.sqrt(d*d+c*c+m*m),d*=u,c*=u,m*=u,n=y*m-D*c,s=D*d-b*m,r=b*c-y*d,u=Math.sqrt(n*n+s*s+r*r),u?(u=1/u,n*=u,s*=u,r*=u):(n=0,s=0,r=0),a=c*r-m*s,l=m*n-d*r,h=d*s-c*n,u=Math.sqrt(a*a+l*l+h*h),u?(u=1/u,a*=u,l*=u,h*=u):(a=0,l=0,h=0),o[0]=n,o[1]=a,o[2]=d,o[3]=0,o[4]=s,o[5]=l,o[6]=c,o[7]=0,o[8]=r,o[9]=h,o[10]=m,o[11]=0,o[12]=-(n*_+s*p+r*g),o[13]=-(a*_+l*p+h*g),o[14]=-(d*_+c*p+m*g),o[15]=1,o)}function Q(){var o=new K(3);return K!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o}function We(o){var e=o[0],t=o[1],i=o[2];return Math.sqrt(e*e+t*t+i*i)}function se(o,e,t){var i=new K(3);return i[0]=o,i[1]=e,i[2]=t,i}function qt(o,e){return o[0]=e[0],o[1]=e[1],o[2]=e[2],o}function it(o,e,t){return o[0]=e[0]+t[0],o[1]=e[1]+t[1],o[2]=e[2]+t[2],o}function Ne(o,e,t){return o[0]=e[0]-t[0],o[1]=e[1]-t[1],o[2]=e[2]-t[2],o}function nt(o,e,t){return o[0]=e[0]*t,o[1]=e[1]*t,o[2]=e[2]*t,o}function _e(o,e,t,i){return o[0]=e[0]+t[0]*i,o[1]=e[1]+t[1]*i,o[2]=e[2]+t[2]*i,o}function le(o,e){var t=e[0],i=e[1],n=e[2],s=t*t+i*i+n*n;return s>0&&(s=1/Math.sqrt(s)),o[0]=e[0]*s,o[1]=e[1]*s,o[2]=e[2]*s,o}function Yt(o,e){return o[0]*e[0]+o[1]*e[1]+o[2]*e[2]}function ge(o,e,t){var i=e[0],n=e[1],s=e[2],r=t[0],a=t[1],l=t[2];return o[0]=n*l-s*a,o[1]=s*r-i*l,o[2]=i*a-n*r,o}var Xt=We;(function(){var o=Q();return function(e,t,i,n,s,r){var a,l;for(t||(t=3),i||(i=0),n?l=Math.min(n*t+i,e.length):l=e.length,a=i;a<l;a+=t)o[0]=e[a],o[1]=e[a+1],o[2]=e[a+2],s(o,o,r),e[a]=o[0],e[a+1]=o[1],e[a+2]=o[2];return e}})();function Zt(){var o=new K(4);return K!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0,o[3]=0),o}function Jt(o,e){var t=e[0],i=e[1],n=e[2],s=e[3],r=t*t+i*i+n*n+s*s;return r>0&&(r=1/Math.sqrt(r)),o[0]=t*r,o[1]=i*r,o[2]=n*r,o[3]=s*r,o}(function(){var o=Zt();return function(e,t,i,n,s,r){var a,l;for(t||(t=4),i||(i=0),n?l=Math.min(n*t+i,e.length):l=e.length,a=i;a<l;a+=t)o[0]=e[a],o[1]=e[a+1],o[2]=e[a+2],o[3]=e[a+3],s(o,o,r),e[a]=o[0],e[a+1]=o[1],e[a+2]=o[2],e[a+3]=o[3];return e}})();function Be(){var o=new K(4);return K!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o[3]=1,o}function Kt(o,e,t){t=t*.5;var i=Math.sin(t);return o[0]=i*e[0],o[1]=i*e[1],o[2]=i*e[2],o[3]=Math.cos(t),o}function Te(o,e,t,i){var n=e[0],s=e[1],r=e[2],a=e[3],l=t[0],h=t[1],d=t[2],c=t[3],m,u,_,p,g;return u=n*l+s*h+r*d+a*c,u<0&&(u=-u,l=-l,h=-h,d=-d,c=-c),1-u>xe?(m=Math.acos(u),_=Math.sin(m),p=Math.sin((1-i)*m)/_,g=Math.sin(i*m)/_):(p=1-i,g=i),o[0]=p*n+g*l,o[1]=p*s+g*h,o[2]=p*r+g*d,o[3]=p*a+g*c,o}function Qt(o,e){var t=e[0]+e[4]+e[8],i;if(t>0)i=Math.sqrt(t+1),o[3]=.5*i,i=.5/i,o[0]=(e[5]-e[7])*i,o[1]=(e[6]-e[2])*i,o[2]=(e[1]-e[3])*i;else{var n=0;e[4]>e[0]&&(n=1),e[8]>e[n*3+n]&&(n=2);var s=(n+1)%3,r=(n+2)%3;i=Math.sqrt(e[n*3+n]-e[s*3+s]-e[r*3+r]+1),o[n]=.5*i,i=.5/i,o[3]=(e[s*3+r]-e[r*3+s])*i,o[s]=(e[s*3+n]+e[n*3+s])*i,o[r]=(e[r*3+n]+e[n*3+r])*i}return o}var ft=Jt;(function(){var o=Q(),e=se(1,0,0),t=se(0,1,0);return function(i,n,s){var r=Yt(n,s);return r<-.999999?(ge(o,e,n),Xt(o)<1e-6&&ge(o,t,n),le(o,o),Kt(i,o,Math.PI),i):r>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(ge(o,n,s),i[0]=o[0],i[1]=o[1],i[2]=o[2],i[3]=1+r,ft(i,i))}})();(function(){var o=Be(),e=Be();return function(t,i,n,s,r,a){return Te(o,i,r,a),Te(e,n,s,a),Te(t,o,e,2*a*(1-a)),t}})();(function(){var o=Bt();return function(e,t,i,n){return o[0]=i[0],o[3]=i[1],o[6]=i[2],o[1]=n[0],o[4]=n[1],o[7]=n[2],o[2]=-t[0],o[5]=-t[1],o[8]=-t[2],ft(e,Qt(e,o))}})();class gt{device;vertexBuffer;indexBuffer;indexCount=0;indexFormat;modelBuffer;bindGroup;vertexCount=0;vertexStride;allowsMapping;constructor(e,t,i,n){this.device=e,this.vertexStride=i.stride,this.allowsMapping=!!n?.allowCpuUpdate;const s=(n?.usage??0)|GPUBufferUsage.VERTEX|(this.allowsMapping?GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_WRITE:GPUBufferUsage.COPY_DST);if(this.vertexCount=t.byteLength/this.vertexStride,this.vertexBuffer=this.createBufferWithData(t.buffer,t.byteOffset,t.byteLength,s,n?.label?`${n.label}-vertex`:"mesh-vertex"),n?.indices&&n.indices.length>0){const l=n.indices,h=l instanceof Uint32Array||l instanceof Uint16Array&&l.BYTES_PER_ELEMENT===4;this.indexFormat=h?"uint32":"uint16",this.indexCount=l.length;const d=(n?.usage??0)|GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST;this.indexBuffer=this.createBufferWithData(l.buffer,l.byteOffset,l.byteLength,d,n?.label?`${n.label}-index`:"mesh-index")}const r=64;this.modelBuffer=e.createBuffer({size:r,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,mappedAtCreation:!1,label:n?.label?`${n.label}-model`:"mesh-model"});const a=e.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}}],label:n?.label?`${n.label}-bgl`:"mesh-bgl"});this.bindGroup=e.createBindGroup({layout:a,entries:[{binding:0,resource:{buffer:this.modelBuffer,offset:0,size:r}}],label:n?.label?`${n.label}-bg`:"mesh-bg"})}createBufferWithData(e,t,i,n,s){const r=i+3&-4,a=this.device.createBuffer({size:r,usage:n,mappedAtCreation:!1,label:s});if(i%4===0)this.device.queue.writeBuffer(a,0,new Uint8Array(e,t,i));else{const l=new Uint8Array(r);l.set(new Uint8Array(e,t,i)),this.device.queue.writeBuffer(a,0,l)}return a}updateIndexData(e,t=0){if(!this.indexBuffer){const i=e instanceof Uint32Array;this.indexFormat=i?"uint32":"uint16",this.indexBuffer=this.createBufferWithData(e.buffer,e.byteOffset,e.byteLength,GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST),this.indexCount=e.length;return}this.device.queue.writeBuffer(this.indexBuffer,t,e.buffer,e.byteOffset,e.byteLength),this.indexCount=e.length}setModelMatrix(e){if(e.length!==16)throw new Error("Model matrix must be a Float32Array(16)");this.device.queue.writeBuffer(this.modelBuffer,0,e.buffer,e.byteOffset,64)}draw(e,t){e.setVertexBuffer(0,this.vertexBuffer),t&&e.setBindGroup(0,t),this.indexBuffer?(e.setIndexBuffer(this.indexBuffer,this.indexFormat),e.drawIndexed(this.indexCount,1,0,0,0)):e.draw(this.vertexCount,1,0,0)}destroy(){try{this.vertexBuffer.destroy()}catch{}if(this.indexBuffer)try{this.indexBuffer.destroy()}catch{}try{this.modelBuffer.destroy()}catch{}}}const ei=`
struct Uniforms {
    resolution: vec2<f32>,
    mouse: vec4<f32>,
    time: f32,
    deltaTime: f32,
};

struct Camera {
    position: vec3<f32>,
    invViewProj: mat4x4<f32>,
};

struct Object {
    position: vec3<f32>,
    _pad0: f32,
    rotation: vec3<f32>,
    _pad1: f32,
    scale: vec3<f32>,
    _pad2: f32,
    color: vec3<f32>,
    _pad3: f32,
    primitive: f32,
    id: f32,
};

@group(0) @binding(0)
var<uniform> uniforms : Uniforms;

@group(0) @binding(1)
var<storage, read> objects: array<Object>;

@group(0) @binding(2)
var<uniform> objectCount: u32;

@group(0) @binding(3)
var<storage, read_write> objectHitBuffer: array<f32>;

@group(0) @binding(4)
var<uniform> camera: Camera;

struct VertexOut {
    @builtin(position) position: vec4<f32>,
}

// -------------------------------------------------------------

@vertex
fn vs_main(@location(0) position: vec2<f32>) -> VertexOut {
    var out: VertexOut;
    out.position = vec4(position, 0.0, 1.0);
    return out;
}

// -------------------------------------------------------------
// SDFResult: unified return for distance + material + index + color
// -------------------------------------------------------------
struct SDFResult {
    dist: f32,
    mat: f32,
    idx: f32,
    color: vec3<f32>,
};

// -------------------------------------------------------------
const MAX_DIST: f32 = 100.0;
const SURF_DIST: f32 = 0.001;
const MAX_STEPS: i32 = 256;

const MAT_GRID = 0.0;

const MAT_SKY_COLOR: vec3<f32> = vec3(0.25, 0.25, 0.25);

// -------------------------------------------------------------
// Helpers
// -------------------------------------------------------------
fn atan2(y: f32, x: f32) -> f32 {
    return select(0.5 * 3.14159265, atan(y / x), x != 0.0);
}

// -------------------------------------------------------------
// Primitives
// -------------------------------------------------------------
fn sd_sphere(p: vec3<f32>, r: f32) -> f32 {
    return length(p) - r;
}

fn sd_ellipsoid(p: vec3<f32>, radii: vec3<f32>) -> f32 {
    let k0 = length(p / radii);
    let k1 = length(p / (radii * radii));
    return k0 * (k0 - 1.0) / k1;
}

fn sd_box(p: vec3<f32>, b: vec3<f32>) -> f32 {
    let q = abs(p) - b;
    return length(max(q, vec3(0.0))) + min(max(q.x, max(q.y, q.z)), 0.0);
}

fn sd_torus(p: vec3<f32>, t: vec2<f32>) -> f32 {
    let q = vec2(length(p.xz) - t.x, p.y);
    return length(q) - t.y;
}

fn sd_cylinder(p: vec3<f32>, radius: f32) -> f32 {
    return length(p.xz) - radius;
}

fn sd_cone_simple(p: vec3<f32>, angle: f32) -> f32 {
    let q = vec2(length(p.xz), p.y);
    let s = atan2(q.x, q.y);
    return length(q) * cos(angle) - q.y;
}

fn sd_capsule(p: vec3<f32>, a: vec3<f32>, b: vec3<f32>, r: f32) -> f32 {
    let pa = p - a;
    let ba = b - a;
    let h = clamp(dot(pa, ba) / dot(ba, ba), 0.0, 1.0);
    return length(pa - ba * h) - r;
}

// -------------------------------------------------------------
// Rotation helper
// -------------------------------------------------------------
fn rotate_y(p: vec3<f32>, angle: f32) -> vec3<f32> {
    let c = cos(angle);
    let s = sin(angle);
    return vec3(
        c * p.x + s * p.z,
        p.y,
        -s * p.x + c * p.z
    );
}

// -------------------------------------------------------------
// Primitive dispatcher
// -------------------------------------------------------------
fn sdf_primitive(p: vec3<f32>, primitiveType: u32, scale: vec3<f32>, rotation: vec3<f32>) -> f32 {
    var q = p;

    // Apply rotation (simple Y rotation for demonstration; can extend to XYZ)
    q = rotate_y(q, rotation.y);

    switch (primitiveType) {
        case 0u: { // SPHERE / ELLIPSOID
            if all(scale == vec3<f32>(scale.x)) {
                return sd_sphere(q, scale.x);
            } else {
                return sd_ellipsoid(q, scale);
            }
        }
        case 1u: { // BOX / CUBOID
            return sd_box(q, scale);
        }
        case 2u: { // TORUS
            return sd_torus(q, vec2<f32>(scale.x, scale.y));
        }
        case 3u: { // CYLINDER
            return sd_cylinder(q, scale.x);
        }
        case 4u: { // CONE
            return sd_cone_simple(q, scale.x);
        }
        case 5u: { // CAPSULE
            let a = vec3<f32>(0.0, -scale.y * 0.5, 0.0);
            let b = vec3<f32>(0.0, scale.y * 0.5, 0.0);
            return sd_capsule(q, a, b, scale.x);
        }
        default: {
            return MAX_DIST;
        }
    }
}


fn sd_grid_2D(p: vec3<f32>, thickness: f32, tile_size: f32) -> f32 {
    var q = p;
    q.x = q.x - tile_size * floor(q.x / tile_size + 0.5);
    q.z = q.z - tile_size * floor(q.z / tile_size + 0.5);

    let dx = abs(q.x) - thickness;
    let dz = abs(q.z) - thickness;

    let dX = max(dx, 0.0);
    let dZ = max(dz, 0.0);

    return max(min(dX, dZ), abs(q.y));
}

// -------------------------------------------------------------
// OBJECT DISTANCE (with object color)
// -------------------------------------------------------------
fn get_dist_obj(p: vec3<f32>) -> SDFResult {
    var res: SDFResult;
    res.dist = MAX_DIST;
    res.mat = -1.0;
    res.idx = -1.0;
    res.color = vec3(0.0);

    for (var i: u32 = 0u; i < objectCount; i++) {
        let obj = objects[i];
        let primitive = u32(obj.primitive);

        let local_p = p - obj.position;
        let d = sdf_primitive(local_p, u32(obj.primitive), obj.scale, obj.rotation);

        if d < res.dist {
            res.dist = d;
            res.idx = obj.id;
            res.color = obj.color;
            if (obj.id == objectHitBuffer[0]) {
                res.color = mix(res.color, vec3<f32>(1.0, 0.0, 0.0), 0.4);
            }
        }
    }

    return res;
}

// -------------------------------------------------------------
// SCENE SDF (distance + material + color integrated here)
// -------------------------------------------------------------
fn get_dist(p: vec3<f32>) -> SDFResult {
    var res: SDFResult;
    res.dist = MAX_DIST;
    res.mat = -1.0;
    res.idx = -1.0;
    res.color = vec3(0.0);

    // ----- GRID -----
    let gd = sd_grid_2D(p, 0.025, 1.0);
    if gd < res.dist {
        res.dist = gd;
        res.idx = -1.0;
        res.mat = MAT_GRID;

        // Reproduce your grid color logic:
        let modx = abs(p.x - 10.0 * floor(p.x / 10.0 + 0.5));
        let modz = abs(p.z - 10.0 * floor(p.z / 10.0 + 0.5));

        if abs(p.z) < 0.025 {
            res.color = vec3(1.0, 0.0, 0.0);
        } else if abs(p.x) < 0.025 {
            res.color = vec3(0.0, 1.0, 0.0);
        } else if modx < 0.025 || modz < 0.025 {
            res.color = vec3(0.31) * 0.4;
        } else {
            res.color = vec3(0.31);
        }
    }

    // ----- OBJECTS -----
    let o = get_dist_obj(p);
    if o.dist < res.dist {
        res = o; // includes color + idx
    }

    return res;
}

// -------------------------------------------------------------
// RAY MARCH (returns SDFResult including color)
// -------------------------------------------------------------
fn ray_march(ro: vec3<f32>, rd: vec3<f32>) -> SDFResult {
    var total = 0.0;
    var res: SDFResult;

    res.dist = MAX_DIST;
    res.idx = -1.0;
    res.mat = -1.0;
    res.color = vec3(0.0);

    for (var i = 0; i < MAX_STEPS; i++) {
        let p = ro + rd * total;
        let s = get_dist(p);

        total += s.dist;
        res = s;

        if s.dist < SURF_DIST || total > MAX_DIST {
            res.dist = total;
            return res;
        }
    }

    res.dist = total;
    return res;
}

// -------------------------------------------------------------
fn get_normal(p: vec3<f32>) -> vec3<f32> {
    let e = vec2(0.001, 0.0);
    return normalize(vec3(
        get_dist(p + e.xyy).dist - get_dist(p - e.xyy).dist,
        get_dist(p + e.yxy).dist - get_dist(p - e.yxy).dist,
        get_dist(p + e.yyx).dist - get_dist(p - e.yyx).dist
    ));
}

// -------------------------------------------------------------
fn pick_object(ro: vec3<f32>, rd: vec3<f32>) -> i32 {
    var t = 0.0;
    for (var i = 0; i < MAX_STEPS; i++) {
        let p = ro + rd * t;
        let s = get_dist_obj(p);

        t += s.dist;
        if s.dist < SURF_DIST {
            return i32(s.idx);
        }
        if t > MAX_DIST {
            break;
        }
    }
    return -1;
}

// -------------------------------------------------------------
// Gamma
fn gamma_correct(c: vec3<f32>) -> vec3<f32> {
    return pow(c, vec3(1.0 / 2.2));
}
// -------------------------------------------------------------

@fragment
fn fs_main(@builtin(position) fragCoord: vec4<f32>) -> @location(0) vec4<f32> {
    let uv = fragCoord.xy * 2.0 / uniforms.resolution.xy - 1.0;

    // Mouse picking ray
    if uniforms.mouse.z == 1.0 {
        let ndc = vec4(
            (uniforms.mouse.x * 2.0 / uniforms.resolution.x - 1.0),
            -(uniforms.mouse.y * 2.0 / uniforms.resolution.y - 1.0),
            1.0,
            1.0
        );

        let wp = camera.invViewProj * ndc;
        let pos3 = wp.xyz / wp.w;

        let ro = camera.position;
        let rd = normalize(pos3 - ro);

        objectHitBuffer[0] = f32(pick_object(ro, rd));
    }

    // Main view ray
    let ndc = vec4(uv.x, -uv.y, 1.0, 1.0);
    let wp = camera.invViewProj * ndc;
    let pos3 = wp.xyz / wp.w;
    let ro = camera.position;
    let rd = normalize(pos3 - ro);

    let rm = ray_march(ro, rd);
    let dist = rm.dist;

    if dist < MAX_DIST {
        let hit_pos = ro + rd * dist;
        let normal = get_normal(hit_pos);

        var color = rm.color;

        if rm.mat != MAT_GRID {
        // Lighting
            let light_pos = vec3(2.0, 5.0, -1.0);
            let light_dir = normalize(light_pos - hit_pos);
            let diffuse = max(dot(normal, light_dir), 0.0);

        // Shadow
            let shadow_pos = hit_pos + normal * 0.01;
            let shadow = select(0.3, 1.0, ray_march(shadow_pos, light_dir).dist > length(light_pos - shadow_pos));

            let ambient = 0.2;
            let albedo = rm.color;

            let shaded = albedo * (ambient + diffuse * shadow * 0.8);

        // Fog
            let fog = exp(-dist * 0.005);
            color = mix(MAT_SKY_COLOR, shaded, fog);
        }

        return vec4(gamma_correct(color), 1.0);
    }

    // Sky
    let sky = mix(MAT_SKY_COLOR, MAT_SKY_COLOR * 0.9, uv.y * 0.5 + 0.5);
    return vec4(gamma_correct(sky), 1.0);
}

`,He={SPHERE:0,ELLIPSOID:0,BOX:1,CUBOID:1,TORUS:2,CYLINDER:3,CONE:4,CAPSULE:5};class ${static globalId=0;static typeCountsRecord=new Map;name;static GPU_DATA_SIZE_WPAD_BYTES=80;position;rotation;scale;color;primitive;id;_device;_objectBuffer;_objectBufferIdx;constructor({name:e="",position:t=[0,0,0],rotation:i=[0,0,0],scale:n=[1,1,1],color:s=[1,1,1],primitive:r=He.CUBOID}={}){this.name=e,this.id=$.generateId(),this.position=[...t],this.rotation=[...i],this.scale=[...n],this.color=[...s],this.primitive=r,$.typeCountsRecord.set(r,($.typeCountsRecord.get(r)||0)+1)}sync(){if(!this._device||!this._objectBuffer||this._objectBufferIdx===void 0)return;const e=this._objectBufferIdx*$.GPU_DATA_SIZE_WPAD_BYTES,t=new Float32Array($.GPU_DATA_SIZE_WPAD_BYTES/4);t.set(this.position,0),t.set(this.rotation,4),t.set(this.scale,8),t.set(this.color,12),t.set([this.primitive,this.id],16),this._device.queue.writeBuffer(this._objectBuffer,e,t.buffer,0,t.byteLength)}destroy(){this._device=void 0,this._objectBuffer=void 0,this._objectBufferIdx=void 0,this.position=[0,0,0],this.rotation=[0,0,0],this.scale=[0,0,0],this.color=[0,0,0],this.name=""}static generateId(){$.globalId++;const e=Math.floor(Math.random()*65535);return($.globalId&65535)<<16|e&65535}static getCountByType(e){return $.typeCountsRecord.get(e)||0}}class Ze{static MAX_OBJECTS=1e3;static UNIFORMS_SIZE_WPAD_BYTES=48;device;pipeline;bindGroup;lastUniforms;uniformBuffer;objects;objectBuffer;objectCountBuffer;objectHitBuffer;objectHitStagingBuffer;camera;cameraBuffer;mesh;_lastIntersectedObj;get lastIntersectedObj(){return this._lastIntersectedObj}constructor(e,t,i){this.device=e,this.camera=i,this.lastUniforms={},this.objects=[];const n={stride:8,attributes:[{shaderLocation:0,offset:0,format:"float32x2"}]},s=e.createShaderModule({code:ei}),r={arrayStride:8,attributes:[{shaderLocation:0,offset:0,format:"float32x2"}]};this.pipeline=e.createRenderPipeline({layout:"auto",vertex:{module:s,entryPoint:"vs_main",buffers:[r]},fragment:{module:s,entryPoint:"fs_main",targets:[{format:t}]},primitive:{topology:"triangle-strip",cullMode:"none"}}),this.uniformBuffer=e.createBuffer({size:Ze.UNIFORMS_SIZE_WPAD_BYTES,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,mappedAtCreation:!1}),this.objectBuffer=e.createBuffer({size:$.GPU_DATA_SIZE_WPAD_BYTES*128,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST}),this.objectCountBuffer=e.createBuffer({size:4,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),this.objectHitBuffer=e.createBuffer({size:4,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST}),this.device.queue.writeBuffer(this.objectHitBuffer,0,Float32Array.from([-1]).buffer),this.objectHitStagingBuffer=e.createBuffer({size:4,usage:GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST}),this.cameraBuffer=e.createBuffer({size:80,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,mappedAtCreation:!1}),this.bindGroup=e.createBindGroup({layout:this.pipeline.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:this.uniformBuffer}},{binding:1,resource:{buffer:this.objectBuffer}},{binding:2,resource:{buffer:this.objectCountBuffer}},{binding:3,resource:{buffer:this.objectHitBuffer}},{binding:4,resource:{buffer:this.cameraBuffer}}]});const a=new Float32Array([-1,-1,1,-1,-1,1,1,1]);this.mesh=new gt(e,a,n,{indices:null,label:"fullscreen-quad"})}selectObject(e){this.device.queue.writeBuffer(this.objectHitBuffer,0,Float32Array.from([e.id]).buffer),this._lastIntersectedObj=e}addObject(e){if(this.objects.length>=this.objectBuffer.size){const i=this.objectBuffer.size*2,n=this.device.createBuffer({size:i,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST|GPUBufferUsage.COPY_SRC}),s=this.device.createCommandEncoder();s.copyBufferToBuffer(this.objectBuffer,0,n,0,this.objectBuffer.size),this.device.queue.submit([s.finish()]),this.objectBuffer.destroy(),this.objectBuffer=n}e._objectBuffer=this.objectBuffer,e._device=this.device,e._objectBufferIdx=this.objects.length,this.objects.push(e);const t=new Uint32Array([this.objects.length]);this.device.queue.writeBuffer(this.objectCountBuffer,0,t.buffer),e.sync()}removeObject(e){const t=e._objectBufferIdx;if(t===void 0||t<0||t>=this.objects.length)return;const i=this.objects.length-1;if(t!==i){const s=this.objects[i],r=this.device.createCommandEncoder();r.copyBufferToBuffer(s._objectBuffer,i*$.GPU_DATA_SIZE_WPAD_BYTES,e._objectBuffer,t*$.GPU_DATA_SIZE_WPAD_BYTES,$.GPU_DATA_SIZE_WPAD_BYTES),this.device.queue.submit([r.finish()]),s._objectBufferIdx=t,this.objects[t]=s}this.objects.pop();const n=new Uint32Array([this.objects.length]);this.device.queue.writeBuffer(this.objectCountBuffer,0,n.buffer),e.destroy()}getObjectByName(e){return this.objects.find(t=>t.name===e)??null}getObjectById(e){return this.objects.find(t=>t.id==e)??null}redeemMemory(){}updateUniforms(e){for(const i in e){const n=e[i];n!==void 0&&(this.lastUniforms[i]=n)}const t=new Float32Array(12);t.set([...this.lastUniforms.resolution??[0,0],0,0],0),t.set(this.lastUniforms.mouse??[0,0,0,0],4),t.set([this.lastUniforms.time??0,this.lastUniforms.deltaTime??0,0,0],8),this.device.queue.writeBuffer(this.uniformBuffer,0,t.buffer)}async checkCollision(){const e=this.device.createCommandEncoder();e.copyBufferToBuffer(this.objectHitBuffer,0,this.objectHitStagingBuffer,0,4),this.device.queue.submit([e.finish()]),await this.objectHitStagingBuffer.mapAsync(GPUMapMode.READ,0,4);const i=this.objectHitStagingBuffer.getMappedRange(0,4).slice();this.objectHitStagingBuffer.unmap();const s=new Float32Array(i)[0],r=this.getObjectById(s);return this._lastIntersectedObj=r,r}render(e){const t=new Float32Array(20);t.set(this.camera.position,0),t.set(this.camera.getInvViewProjMatrix(),4),this.device.queue.writeBuffer(this.cameraBuffer,0,t),e.setPipeline(this.pipeline),e.setBindGroup(0,this.bindGroup),this.mesh.draw(e)}}class ti{position=se(0,2,4);rotation=Be();fov=45*Math.PI/180;near=.1;far=100;worldUp=se(0,1,0);up=Q();right=Q();forward=Q();target=se(0,0,0);aspect=window.innerWidth/window.innerHeight;_viewMatrix=me();_projMatrix=me();_viewProjMatrix=me();_invViewProjMatrix=me();constructor(){this.updateMatrices()}updateMatrices(){$t(this._viewMatrix,this.position,this.target,this.worldUp);const e=me();tt(e,this._viewMatrix),this.right=se(e[0],e[1],e[2]),this.up=se(e[4],e[5],e[6]),this.forward=se(e[8],e[9],e[10]),nt(this.forward,this.forward,-1),le(this.right,this.right),le(this.up,this.up),le(this.forward,this.forward),jt(this._projMatrix,this.fov,this.aspect,this.near,this.far),Ut(this._viewProjMatrix,this._projMatrix,this._viewMatrix),tt(this._invViewProjMatrix,this._viewProjMatrix)}getViewMatrix(){return this._viewMatrix}getProjectionMatrix(){return this._projMatrix}getInvViewProjMatrix(){return this._invViewProjMatrix}getViewProjMatrix(){return this._viewProjMatrix}orbit(e,t,i=.005){const n=Q();Ne(n,this.position,this.target);let s=We(n),r=Math.atan2(n[2],n[0]),a=Math.acos(n[1]/s);r+=e*i,a-=t*i,a=Math.max(.1,Math.min(Math.PI-.1,a)),n[0]=s*Math.sin(a)*Math.cos(r),n[1]=s*Math.cos(a),n[2]=s*Math.sin(a)*Math.sin(r),it(this.position,this.target,n)}zoom(e,t=.05,i=1,n=50){const s=Q();Ne(s,this.position,this.target);let r=We(s);r+=e*t,r=Math.max(i,Math.min(n,r)),le(s,s),nt(s,s,r),it(this.position,this.target,s)}lookAt(e){qt(this.target,e)}}const ii=`@group(0) @binding(0) var<uniform> uViewProj : mat4x4<f32>;

struct VSOut {
    @builtin(position) Position: vec4<f32>,
    @location(0) color: vec3<f32>,
};

@vertex
fn vs_main(
    @location(0) pos: vec3<f32>,
    @location(1) color: vec3<f32>
) -> VSOut {
    var out: VSOut;
    out.Position = uViewProj * vec4<f32>(pos, 1.0);
    out.color = color;
    return out;
}

@fragment
fn fs_main(
    @builtin(position) fragCoord: vec4<f32>,
    @location(0) color: vec3<f32>
) -> @location(0) vec4<f32> {
    return vec4<f32>(color, 1.0);
}

`;class ni{gizmos;camera;matricesBuffer;device;pipeline;bindGroup;constructor(e,t,i){this.device=e,this.camera=i,this.gizmos=[];const n={stride:24,attributes:[{shaderLocation:0,offset:0,format:"float32x3"},{shaderLocation:1,offset:12,format:"float32x3"}]},s=e.createShaderModule({code:ii}),r={arrayStride:24,attributes:[{shaderLocation:0,offset:0,format:"float32x3"},{shaderLocation:1,offset:12,format:"float32x3"}]};this.pipeline=e.createRenderPipeline({layout:"auto",vertex:{module:s,entryPoint:"vs_main",buffers:[r]},fragment:{module:s,entryPoint:"fs_main",targets:[{format:t}]},primitive:{topology:"line-list",cullMode:"none"}}),this.matricesBuffer=e.createBuffer({size:64,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,mappedAtCreation:!1}),this.bindGroup=e.createBindGroup({layout:this.pipeline.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:this.matricesBuffer}}]});const a=new Float32Array([0,0,0,1,0,0,1,0,0,1,0,0,0,0,0,0,1,0,0,1,0,0,1,0,0,0,0,0,0,1,0,0,1,0,0,1]),l=new Uint16Array([0,1,2,3,4,5]),h=new gt(e,a,n,{indices:l,label:"gizmo"});this.gizmos.push(h)}render(e){const t=new Float32Array(16);t.set(this.camera.getViewProjMatrix(),0),this.device.queue.writeBuffer(this.matricesBuffer,0,t),e.setPipeline(this.pipeline),e.setBindGroup(0,this.bindGroup);for(const i of this.gizmos)i.draw(e)}}class si{}class re extends si{constructor(e,t,i){super(),this.viewId=e,this.groupId=t,this.panelId=i}}class ce{constructor(){}static getInstance(){return ce.INSTANCE}hasData(e){return e&&e===this.proto}clearData(e){this.hasData(e)&&(this.proto=void 0,this.data=void 0)}getData(e){if(this.hasData(e))return this.data}setData(e,t){t&&(this.data=e,this.proto=t)}}ce.INSTANCE=new ce;function q(){const o=ce.getInstance();if(o.hasData(re.prototype))return o.getData(re.prototype)[0]}var de;(function(o){o.any=(...e)=>t=>{const i=e.map(n=>n(t));return{dispose:()=>{i.forEach(n=>{n.dispose()})}}}})(de||(de={}));class Je{constructor(){this._defaultPrevented=!1}get defaultPrevented(){return this._defaultPrevented}preventDefault(){this._defaultPrevented=!0}}class oi{constructor(){this._isAccepted=!1}get isAccepted(){return this._isAccepted}accept(){this._isAccepted=!0}}class ri{constructor(){this.events=new Map}get size(){return this.events.size}add(e,t){this.events.set(e,t)}delete(e){this.events.delete(e)}clear(){this.events.clear()}}class Ae{static create(){var e;return new Ae((e=new Error().stack)!==null&&e!==void 0?e:"")}constructor(e){this.value=e}print(){console.warn("dockview: stacktrace",this.value)}}class ai{constructor(e,t){this.callback=e,this.stacktrace=t}}class f{static setLeakageMonitorEnabled(e){e!==f.ENABLE_TRACKING&&f.MEMORY_LEAK_WATCHER.clear(),f.ENABLE_TRACKING=e}get value(){return this._last}constructor(e){this.options=e,this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=e=>{var t;!((t=this.options)===null||t===void 0)&&t.replay&&this._last!==void 0&&e(this._last);const i=new ai(e,f.ENABLE_TRACKING?Ae.create():void 0);return this._listeners.push(i),{dispose:()=>{const n=this._listeners.indexOf(i);n>-1&&this._listeners.splice(n,1)}}},f.ENABLE_TRACKING&&f.MEMORY_LEAK_WATCHER.add(this._event,Ae.create())),this._event}fire(e){var t;!((t=this.options)===null||t===void 0)&&t.replay&&(this._last=e);for(const i of this._listeners)i.callback(e)}dispose(){this._disposed||(this._disposed=!0,this._listeners.length>0&&(f.ENABLE_TRACKING&&queueMicrotask(()=>{var e;for(const t of this._listeners)console.warn("dockview: stacktrace",(e=t.stacktrace)===null||e===void 0?void 0:e.print())}),this._listeners=[]),f.ENABLE_TRACKING&&this._event&&f.MEMORY_LEAK_WATCHER.delete(this._event))}}f.ENABLE_TRACKING=!1;f.MEMORY_LEAK_WATCHER=new ri;function I(o,e,t,i){return o.addEventListener(e,t,i),{dispose:()=>{o.removeEventListener(e,t,i)}}}class st{constructor(){this._onFired=new f,this._currentFireCount=0,this._queued=!1,this.onEvent=e=>{const t=this._currentFireCount;return this._onFired.event(()=>{this._currentFireCount>t&&e()})}}fire(){this._currentFireCount++,!this._queued&&(this._queued=!0,queueMicrotask(()=>{this._queued=!1,this._onFired.fire()}))}dispose(){this._onFired.dispose()}}var N;(function(o){o.NONE={dispose:()=>{}};function e(t){return{dispose:()=>{t()}}}o.from=e})(N||(N={}));class E{get isDisposed(){return this._isDisposed}constructor(...e){this._isDisposed=!1,this._disposables=e}addDisposables(...e){e.forEach(t=>this._disposables.push(t))}dispose(){this._isDisposed||(this._isDisposed=!0,this._disposables.forEach(e=>e.dispose()),this._disposables=[])}}class Z{constructor(){this._disposable=N.NONE}set value(e){this._disposable&&this._disposable.dispose(),this._disposable=e}dispose(){this._disposable&&(this._disposable.dispose(),this._disposable=N.NONE)}}class li extends E{constructor(e){super(),this._onDidChange=new f,this.onDidChange=this._onDidChange.event,this._value=null,this.addDisposables(this._onDidChange,Ie(e,t=>{const i=t.target.scrollWidth>t.target.clientWidth,n=t.target.scrollHeight>t.target.clientHeight;this._value={hasScrollX:i,hasScrollY:n},this._onDidChange.fire(this._value)}))}}function Ie(o,e){const t=new ResizeObserver(i=>{requestAnimationFrame(()=>{const n=i[0];e(n)})});return t.observe(o),{dispose:()=>{t.unobserve(o),t.disconnect()}}}const Ue=(o,...e)=>{for(const t of e)o.classList.contains(t)&&o.classList.remove(t)},vt=(o,...e)=>{for(const t of e)o.classList.contains(t)||o.classList.add(t)},A=(o,e,t)=>{const i=o.classList.contains(e);t&&!i&&o.classList.add(e),!t&&i&&o.classList.remove(e)};function Fe(o,e){for(;o;){if(o===e)return!0;o=o.parentNode}return!1}function _t(o){return new hi(o)}class hi extends E{constructor(e){super(),this._onDidFocus=new f,this.onDidFocus=this._onDidFocus.event,this._onDidBlur=new f,this.onDidBlur=this._onDidBlur.event,this.addDisposables(this._onDidFocus,this._onDidBlur);let t=Fe(document.activeElement,e),i=!1;const n=()=>{i=!1,t||(t=!0,this._onDidFocus.fire())},s=()=>{t&&(i=!0,window.setTimeout(()=>{i&&(i=!1,t=!1,this._onDidBlur.fire())},0))};this._refreshStateHandler=()=>{Fe(document.activeElement,e)!==t&&(t?s():n())},this.addDisposables(I(e,"focus",n,!0)),this.addDisposables(I(e,"blur",s,!0))}refreshState(){this._refreshStateHandler()}}const wt="dv-quasiPreventDefault";function di(o){o[wt]=!0}function ot(o){return o[wt]}function ci(o,e){const t=Array.from(e);for(const i of t){if(i.href){const s=o.createElement("link");s.href=i.href,s.type=i.type,s.rel="stylesheet",o.head.appendChild(s)}let n=[];try{i.cssRules&&(n=Array.from(i.cssRules).map(s=>s.cssText))}catch{}for(const s of n){const r=o.createElement("style");r.appendChild(o.createTextNode(s)),o.head.appendChild(r)}}}function je(o){const{left:e,top:t,width:i,height:n}=o.getBoundingClientRect();return{left:e+window.scrollX,top:t+window.scrollY,width:i,height:n}}function ui(o){let e=o;for(;e?.parentNode;){if(e.parentNode===document)return!0;e.parentNode instanceof DocumentFragment?e=e.parentNode.host:e=e.parentNode}return!1}function pi(o,e){o.setAttribute("data-testid",e)}function mi(o){const e=[];function t(i){if(i.nodeType===Node.ELEMENT_NODE){o.includes(i.tagName)&&e.push(i),i.shadowRoot&&t(i.shadowRoot);for(const n of i.children)t(n)}}return t(document.documentElement),e}function Se(o=document){const e=mi(["IFRAME","WEBVIEW"]),t=new WeakMap;for(const i of e)t.set(i,i.style.pointerEvents),i.style.pointerEvents="none";return{release:()=>{var i;for(const n of e)n.style.pointerEvents=(i=t.get(n))!==null&&i!==void 0?i:"auto";e.splice(0,e.length)}}}function fi(o){function e(n){const s=[];for(let r=0;r<n.classList.length;r++)s.push(n.classList.item(r));return s}let t,i=o;for(;i!==null&&(t=e(i).find(n=>n.startsWith("dockview-theme-")),typeof t!="string");)i=i.parentElement;return t}class bt{constructor(e){this.element=e,this._classNames=[]}setClassNames(e){for(const t of this._classNames)A(this.element,t,!1);this._classNames=e.split(" ").filter(t=>t.trim().length>0);for(const t of this._classNames)A(this.element,t,!0)}}const Dt=100;function gi(o,e){const t=je(o),i=je(e);return!(t.left<i.left||t.left+t.width>i.left+i.width)}function vi(o){const e=new f;let t=o.screenX,i=o.screenY,n;const s=()=>{if(o.closed)return;const r=o.screenX,a=o.screenY;(r!==t||a!==i)&&(clearTimeout(n),n=setTimeout(()=>{e.fire()},Dt),t=r,i=a),requestAnimationFrame(s)};return s(),e}function _i(o,e){let t;return new E(I(o,"resize",()=>{clearTimeout(t),t=setTimeout(()=>{e()},Dt)}))}function wi(o,e,t={buffer:10}){const i=t.buffer,n=o.getBoundingClientRect(),s=e.getBoundingClientRect();let r=0,a=0;const l=n.left-s.left,h=n.top-s.top,d=n.bottom-s.bottom,c=n.right-s.right;l<i?r=i-l:c>i&&(r=-i-c),h<i?a=i-h:d>i&&(a=-d-i),(r!==0||a!==0)&&(o.style.transform=`translate(${r}px, ${a}px)`)}function bi(o){let e=o;for(;e&&(e.style.zIndex==="auto"||e.style.zIndex==="");)e=e.parentElement;return e}function he(o){if(o.length===0)throw new Error("Invalid tail call");return[o.slice(0,o.length-1),o[o.length-1]]}function Di(o,e){if(o.length!==e.length)return!1;for(let t=0;t<o.length;t++)if(o[t]!==e[t])return!1;return!0}function Le(o,e){const t=o.indexOf(e);t>-1&&(o.splice(t,1),o.unshift(e))}function we(o,e){const t=o.indexOf(e);t>-1&&(o.splice(t,1),o.push(e))}function Ci(o,e){for(let t=0;t<o.length;t++){const i=o[t];if(e(i))return t}return-1}function ke(o,e){const t=o.findIndex(i=>i===e);return t>-1?(o.splice(t,1),!0):!1}const M=(o,e,t)=>e>t?e:Math.min(t,Math.max(o,e)),Ct=()=>{let o=1;return{next:()=>(o++).toString()}},J=(o,e)=>{const t=[];if(typeof e!="number"&&(e=o,o=0),o<=e)for(let i=o;i<e;i++)t.push(i);else for(let i=o;i>e;i--)t.push(i);return t};class yi{set size(e){this._size=e}get size(){return this._size}get cachedVisibleSize(){return this._cachedVisibleSize}get visible(){return typeof this._cachedVisibleSize>"u"}get minimumSize(){return this.visible?this.view.minimumSize:0}get viewMinimumSize(){return this.view.minimumSize}get maximumSize(){return this.visible?this.view.maximumSize:0}get viewMaximumSize(){return this.view.maximumSize}get priority(){return this.view.priority}get snap(){return!!this.view.snap}set enabled(e){this.container.style.pointerEvents=e?"":"none"}constructor(e,t,i,n){this.container=e,this.view=t,this.disposable=n,this._cachedVisibleSize=void 0,typeof i=="number"?(this._size=i,this._cachedVisibleSize=void 0,e.classList.add("visible")):(this._size=0,this._cachedVisibleSize=i.cachedVisibleSize)}setVisible(e,t){var i;e!==this.visible&&(e?(this.size=M((i=this._cachedVisibleSize)!==null&&i!==void 0?i:0,this.viewMinimumSize,this.viewMaximumSize),this._cachedVisibleSize=void 0):(this._cachedVisibleSize=typeof t=="number"?t:this.size,this.size=0),this.container.classList.toggle("visible",e),this.view.setVisible&&this.view.setVisible(e))}dispose(){return this.disposable.dispose(),this.view}}var P;(function(o){o.HORIZONTAL="HORIZONTAL",o.VERTICAL="VERTICAL"})(P||(P={}));var Y;(function(o){o[o.MAXIMUM=0]="MAXIMUM",o[o.MINIMUM=1]="MINIMUM",o[o.DISABLED=2]="DISABLED",o[o.ENABLED=3]="ENABLED"})(Y||(Y={}));var W;(function(o){o.Low="low",o.High="high",o.Normal="normal"})(W||(W={}));var ie;(function(o){o.Distribute={type:"distribute"};function e(i){return{type:"split",index:i}}o.Split=e;function t(i){return{type:"invisible",cachedVisibleSize:i}}o.Invisible=t})(ie||(ie={}));class rt{get contentSize(){return this._contentSize}get size(){return this._size}set size(e){this._size=e}get orthogonalSize(){return this._orthogonalSize}set orthogonalSize(e){this._orthogonalSize=e}get length(){return this.viewItems.length}get proportions(){return this._proportions?[...this._proportions]:void 0}get orientation(){return this._orientation}set orientation(e){this._orientation=e;const t=this.size;this.size=this.orthogonalSize,this.orthogonalSize=t,Ue(this.element,"dv-horizontal","dv-vertical"),this.element.classList.add(this.orientation==P.HORIZONTAL?"dv-horizontal":"dv-vertical")}get minimumSize(){return this.viewItems.reduce((e,t)=>e+t.minimumSize,0)}get maximumSize(){return this.length===0?Number.POSITIVE_INFINITY:this.viewItems.reduce((e,t)=>e+t.maximumSize,0)}get startSnappingEnabled(){return this._startSnappingEnabled}set startSnappingEnabled(e){this._startSnappingEnabled!==e&&(this._startSnappingEnabled=e,this.updateSashEnablement())}get endSnappingEnabled(){return this._endSnappingEnabled}set endSnappingEnabled(e){this._endSnappingEnabled!==e&&(this._endSnappingEnabled=e,this.updateSashEnablement())}get disabled(){return this._disabled}set disabled(e){this._disabled=e,A(this.element,"dv-splitview-disabled",e)}get margin(){return this._margin}set margin(e){this._margin=e,A(this.element,"dv-splitview-has-margin",e!==0)}constructor(e,t){var i,n;this.container=e,this.viewItems=[],this.sashes=[],this._size=0,this._orthogonalSize=0,this._contentSize=0,this._proportions=void 0,this._startSnappingEnabled=!0,this._endSnappingEnabled=!0,this._disabled=!1,this._margin=0,this._onDidSashEnd=new f,this.onDidSashEnd=this._onDidSashEnd.event,this._onDidAddView=new f,this.onDidAddView=this._onDidAddView.event,this._onDidRemoveView=new f,this.onDidRemoveView=this._onDidRemoveView.event,this.resize=(s,r,a=this.viewItems.map(_=>_.size),l,h,d=Number.NEGATIVE_INFINITY,c=Number.POSITIVE_INFINITY,m,u)=>{if(s<0||s>this.viewItems.length)return 0;const _=J(s,-1),p=J(s+1,this.viewItems.length);if(h)for(const w of h)Le(_,w),Le(p,w);if(l)for(const w of l)we(_,w),we(p,w);const g=_.map(w=>this.viewItems[w]),b=_.map(w=>a[w]),y=p.map(w=>this.viewItems[w]),D=p.map(w=>a[w]),v=_.reduce((w,S)=>w+this.viewItems[S].minimumSize-a[S],0),x=_.reduce((w,S)=>w+this.viewItems[S].maximumSize-a[S],0),C=p.length===0?Number.POSITIVE_INFINITY:p.reduce((w,S)=>w+a[S]-this.viewItems[S].minimumSize,0),O=p.length===0?Number.NEGATIVE_INFINITY:p.reduce((w,S)=>w+a[S]-this.viewItems[S].maximumSize,0),k=Math.max(v,O),F=Math.min(C,x);let V=!1;if(m){const w=this.viewItems[m.index],S=r>=m.limitDelta;V=S!==w.visible,w.setVisible(S,m.size)}if(!V&&u){const w=this.viewItems[u.index],S=r<u.limitDelta;V=S!==w.visible,w.setVisible(S,u.size)}if(V)return this.resize(s,r,a,l,h,d,c);const H=M(r,k,F);let j=0,G=H;for(let w=0;w<g.length;w++){const S=g[w],R=M(b[w]+G,S.minimumSize,S.maximumSize),ve=R-b[w];j+=ve,G-=ve,S.size=R}let z=j;for(let w=0;w<y.length;w++){const S=y[w],R=M(D[w]-z,S.minimumSize,S.maximumSize),ve=R-D[w];z+=ve,S.size=R}return r},this._orientation=(i=t.orientation)!==null&&i!==void 0?i:P.VERTICAL,this.element=this.createContainer(),this.margin=(n=t.margin)!==null&&n!==void 0?n:0,this.proportionalLayout=t.proportionalLayout===void 0?!0:!!t.proportionalLayout,this.viewContainer=this.createViewContainer(),this.sashContainer=this.createSashContainer(),this.element.appendChild(this.sashContainer),this.element.appendChild(this.viewContainer),this.container.appendChild(this.element),this.style(t.styles),t.descriptor&&(this._size=t.descriptor.size,t.descriptor.views.forEach((s,r)=>{const a=s.visible===void 0||s.visible?s.size:{type:"invisible",cachedVisibleSize:s.size},l=s.view;this.addView(l,a,r,!0)}),this._contentSize=this.viewItems.reduce((s,r)=>s+r.size,0),this.saveProportions())}style(e){e?.separatorBorder==="transparent"?(Ue(this.element,"dv-separator-border"),this.element.style.removeProperty("--dv-separator-border")):(vt(this.element,"dv-separator-border"),e?.separatorBorder&&this.element.style.setProperty("--dv-separator-border",e.separatorBorder))}isViewVisible(e){if(e<0||e>=this.viewItems.length)throw new Error("Index out of bounds");return this.viewItems[e].visible}setViewVisible(e,t){if(e<0||e>=this.viewItems.length)throw new Error("Index out of bounds");const i=this.viewItems[e];i.setVisible(t,i.size),this.distributeEmptySpace(e),this.layoutViews(),this.saveProportions()}getViewSize(e){return e<0||e>=this.viewItems.length?-1:this.viewItems[e].size}resizeView(e,t){if(e<0||e>=this.viewItems.length)return;const i=J(this.viewItems.length).filter(a=>a!==e),n=[...i.filter(a=>this.viewItems[a].priority===W.Low),e],s=i.filter(a=>this.viewItems[a].priority===W.High),r=this.viewItems[e];t=Math.round(t),t=M(t,r.minimumSize,Math.min(r.maximumSize,this._size)),r.size=t,this.relayout(n,s)}getViews(){return this.viewItems.map(e=>e.view)}onDidChange(e,t){const i=this.viewItems.indexOf(e);if(i<0||i>=this.viewItems.length)return;t=typeof t=="number"?t:e.size,t=M(t,e.minimumSize,e.maximumSize),e.size=t;const n=J(this.viewItems.length).filter(a=>a!==i),s=[...n.filter(a=>this.viewItems[a].priority===W.Low),i],r=n.filter(a=>this.viewItems[a].priority===W.High);this.relayout([...s,i],r)}addView(e,t={type:"distribute"},i=this.viewItems.length,n){const s=document.createElement("div");s.className="dv-view",s.appendChild(e.element);let r;typeof t=="number"?r=t:t.type==="split"?r=this.getViewSize(t.index)/2:t.type==="invisible"?r={cachedVisibleSize:t.cachedVisibleSize}:r=e.minimumSize;const a=e.onDidChange(h=>this.onDidChange(l,h.size)),l=new yi(s,e,r,{dispose:()=>{a.dispose(),this.viewContainer.removeChild(s)}});if(i===this.viewItems.length?this.viewContainer.appendChild(s):this.viewContainer.insertBefore(s,this.viewContainer.children.item(i)),this.viewItems.splice(i,0,l),this.viewItems.length>1){const h=document.createElement("div");h.className="dv-sash";const d=m=>{for(const w of this.viewItems)w.enabled=!1;const u=Se(),_=this._orientation===P.HORIZONTAL?m.clientX:m.clientY,p=Ci(this.sashes,w=>w.container===h),g=this.viewItems.map(w=>w.size);let b,y;const D=J(p,-1),v=J(p+1,this.viewItems.length),x=D.reduce((w,S)=>w+(this.viewItems[S].minimumSize-g[S]),0),C=D.reduce((w,S)=>w+(this.viewItems[S].viewMaximumSize-g[S]),0),O=v.length===0?Number.POSITIVE_INFINITY:v.reduce((w,S)=>w+(g[S]-this.viewItems[S].minimumSize),0),k=v.length===0?Number.NEGATIVE_INFINITY:v.reduce((w,S)=>w+(g[S]-this.viewItems[S].viewMaximumSize),0),F=Math.max(x,k),V=Math.min(O,C),H=this.findFirstSnapIndex(D),j=this.findFirstSnapIndex(v);if(typeof H=="number"){const w=this.viewItems[H],S=Math.floor(w.viewMinimumSize/2);b={index:H,limitDelta:w.visible?F-S:F+S,size:w.size}}if(typeof j=="number"){const w=this.viewItems[j],S=Math.floor(w.viewMinimumSize/2);y={index:j,limitDelta:w.visible?V+S:V-S,size:w.size}}const G=w=>{const R=(this._orientation===P.HORIZONTAL?w.clientX:w.clientY)-_;this.resize(p,R,g,void 0,void 0,F,V,b,y),this.distributeEmptySpace(),this.layoutViews()},z=()=>{for(const w of this.viewItems)w.enabled=!0;u.release(),this.saveProportions(),document.removeEventListener("pointermove",G),document.removeEventListener("pointerup",z),document.removeEventListener("pointercancel",z),this._onDidSashEnd.fire(void 0)};document.addEventListener("pointermove",G),document.addEventListener("pointerup",z),document.addEventListener("pointercancel",z)};h.addEventListener("pointerdown",d);const c={container:h,disposable:()=>{h.removeEventListener("pointerdown",d),this.sashContainer.removeChild(h)}};this.sashContainer.appendChild(h),this.sashes.push(c)}n||this.relayout([i]),!n&&typeof t!="number"&&t.type==="distribute"&&this.distributeViewSizes(),this._onDidAddView.fire(e)}distributeViewSizes(){const e=[];let t=0;for(const a of this.viewItems)a.maximumSize-a.minimumSize>0&&(e.push(a),t+=a.size);const i=Math.floor(t/e.length);for(const a of e)a.size=M(i,a.minimumSize,a.maximumSize);const n=J(this.viewItems.length),s=n.filter(a=>this.viewItems[a].priority===W.Low),r=n.filter(a=>this.viewItems[a].priority===W.High);this.relayout(s,r)}removeView(e,t,i=!1){const n=this.viewItems.splice(e,1)[0];if(n.dispose(),this.viewItems.length>=1){const s=Math.max(e-1,0);this.sashes.splice(s,1)[0].disposable()}return i||this.relayout(),t&&t.type==="distribute"&&this.distributeViewSizes(),this._onDidRemoveView.fire(n.view),n.view}getViewCachedVisibleSize(e){if(e<0||e>=this.viewItems.length)throw new Error("Index out of bounds");return this.viewItems[e].cachedVisibleSize}moveView(e,t){const i=this.getViewCachedVisibleSize(e),n=typeof i>"u"?this.getViewSize(e):ie.Invisible(i),s=this.removeView(e,void 0,!0);this.addView(s,n,t)}layout(e,t){const i=Math.max(this.size,this._contentSize);if(this.size=e,this.orthogonalSize=t,this.proportions){let n=0;for(let s=0;s<this.viewItems.length;s++){const r=this.viewItems[s],a=this.proportions[s];typeof a=="number"?n+=a:e-=r.size}for(let s=0;s<this.viewItems.length;s++){const r=this.viewItems[s],a=this.proportions[s];typeof a=="number"&&n>0&&(r.size=M(Math.round(a*e/n),r.minimumSize,r.maximumSize))}}else{const n=J(this.viewItems.length),s=n.filter(a=>this.viewItems[a].priority===W.Low),r=n.filter(a=>this.viewItems[a].priority===W.High);this.resize(this.viewItems.length-1,e-i,void 0,s,r)}this.distributeEmptySpace(),this.layoutViews()}relayout(e,t){const i=this.viewItems.reduce((n,s)=>n+s.size,0);this.resize(this.viewItems.length-1,this._size-i,void 0,e,t),this.distributeEmptySpace(),this.layoutViews(),this.saveProportions()}distributeEmptySpace(e){const t=this.viewItems.reduce((a,l)=>a+l.size,0);let i=this.size-t;const n=J(this.viewItems.length-1,-1),s=n.filter(a=>this.viewItems[a].priority===W.Low),r=n.filter(a=>this.viewItems[a].priority===W.High);for(const a of r)Le(n,a);for(const a of s)we(n,a);typeof e=="number"&&we(n,e);for(let a=0;i!==0&&a<n.length;a++){const l=this.viewItems[n[a]],h=M(l.size+i,l.minimumSize,l.maximumSize),d=h-l.size;i-=d,l.size=h}}saveProportions(){this.proportionalLayout&&this._contentSize>0&&(this._proportions=this.viewItems.map(e=>e.visible?e.size/this._contentSize:void 0))}layoutViews(){if(this._contentSize=this.viewItems.reduce((l,h)=>l+h.size,0),this.updateSashEnablement(),this.viewItems.length===0)return;const e=this.viewItems.filter(l=>l.visible),t=Math.max(0,e.length-1),i=this.margin*t/Math.max(1,e.length);let n=0;const s=[],r=4,a=this.viewItems.reduce((l,h,d)=>{const c=h.visible?1:0;return d===0?l.push(c):l.push(l[d-1]+c),l},[]);this.viewItems.forEach((l,h)=>{n+=this.viewItems[h].size,s.push(n);const d=l.visible?l.size-i:0,c=Math.max(0,a[h]-1),m=h===0||c===0?0:s[h-1]+c/t*i;if(h<this.viewItems.length-1){const u=l.visible?m+d-r/2+this.margin/2:m;this._orientation===P.HORIZONTAL&&(this.sashes[h].container.style.left=`${u}px`,this.sashes[h].container.style.top="0px"),this._orientation===P.VERTICAL&&(this.sashes[h].container.style.left="0px",this.sashes[h].container.style.top=`${u}px`)}this._orientation===P.HORIZONTAL&&(l.container.style.width=`${d}px`,l.container.style.left=`${m}px`,l.container.style.top="",l.container.style.height=""),this._orientation===P.VERTICAL&&(l.container.style.height=`${d}px`,l.container.style.top=`${m}px`,l.container.style.width="",l.container.style.left=""),l.view.layout(l.size-i,this._orthogonalSize)})}findFirstSnapIndex(e){for(const t of e){const i=this.viewItems[t];if(i.visible&&i.snap)return t}for(const t of e){const i=this.viewItems[t];if(i.visible&&i.maximumSize-i.minimumSize>0)return;if(!i.visible&&i.snap)return t}}updateSashEnablement(){let e=!1;const t=this.viewItems.map(l=>e=l.size-l.minimumSize>0||e);e=!1;const i=this.viewItems.map(l=>e=l.maximumSize-l.size>0||e),n=[...this.viewItems].reverse();e=!1;const s=n.map(l=>e=l.size-l.minimumSize>0||e).reverse();e=!1;const r=n.map(l=>e=l.maximumSize-l.size>0||e).reverse();let a=0;for(let l=0;l<this.sashes.length;l++){const h=this.sashes[l],d=this.viewItems[l];a+=d.size;const c=!(t[l]&&r[l+1]),m=!(i[l]&&s[l+1]);if(c&&m){const u=J(l,-1),_=J(l+1,this.viewItems.length),p=this.findFirstSnapIndex(u),g=this.findFirstSnapIndex(_),b=typeof p=="number"&&!this.viewItems[p].visible,y=typeof g=="number"&&!this.viewItems[g].visible;b&&s[l]&&(a>0||this.startSnappingEnabled)?this.updateSash(h,Y.MINIMUM):y&&t[l]&&(a<this._contentSize||this.endSnappingEnabled)?this.updateSash(h,Y.MAXIMUM):this.updateSash(h,Y.DISABLED)}else c&&!m?this.updateSash(h,Y.MINIMUM):!c&&m?this.updateSash(h,Y.MAXIMUM):this.updateSash(h,Y.ENABLED)}}updateSash(e,t){A(e.container,"dv-disabled",t===Y.DISABLED),A(e.container,"dv-enabled",t===Y.ENABLED),A(e.container,"dv-maximum",t===Y.MAXIMUM),A(e.container,"dv-minimum",t===Y.MINIMUM)}createViewContainer(){const e=document.createElement("div");return e.className="dv-view-container",e}createSashContainer(){const e=document.createElement("div");return e.className="dv-sash-container",e}createContainer(){const e=document.createElement("div"),t=this._orientation===P.HORIZONTAL?"dv-horizontal":"dv-vertical";return e.className=`dv-split-view-container ${t}`,e}dispose(){this._onDidSashEnd.dispose(),this._onDidAddView.dispose(),this._onDidRemoveView.dispose();for(let e=0;e<this.element.children.length;e++)if(this.element.children.item(e)===this.element){this.element.removeChild(this.element);break}for(const e of this.viewItems)e.dispose();this.element.remove()}}class B{get minimumWidth(){return this.view.minimumWidth}get maximumWidth(){return this.view.maximumWidth}get minimumHeight(){return this.view.minimumHeight}get maximumHeight(){return this.view.maximumHeight}get priority(){return this.view.priority}get snap(){return this.view.snap}get minimumSize(){return this.orientation===P.HORIZONTAL?this.minimumHeight:this.minimumWidth}get maximumSize(){return this.orientation===P.HORIZONTAL?this.maximumHeight:this.maximumWidth}get minimumOrthogonalSize(){return this.orientation===P.HORIZONTAL?this.minimumWidth:this.minimumHeight}get maximumOrthogonalSize(){return this.orientation===P.HORIZONTAL?this.maximumWidth:this.maximumHeight}get orthogonalSize(){return this._orthogonalSize}get size(){return this._size}get element(){return this.view.element}get width(){return this.orientation===P.HORIZONTAL?this.orthogonalSize:this.size}get height(){return this.orientation===P.HORIZONTAL?this.size:this.orthogonalSize}constructor(e,t,i,n=0){this.view=e,this.orientation=t,this._onDidChange=new f,this.onDidChange=this._onDidChange.event,this._orthogonalSize=i,this._size=n,this._disposable=this.view.onDidChange(s=>{s?this._onDidChange.fire({size:this.orientation===P.VERTICAL?s.width:s.height,orthogonalSize:this.orientation===P.VERTICAL?s.height:s.width}):this._onDidChange.fire({})})}setVisible(e){this.view.setVisible&&this.view.setVisible(e)}layout(e,t){this._size=e,this._orthogonalSize=t,this.view.layout(this.width,this.height)}dispose(){this._onDidChange.dispose(),this._disposable.dispose()}}class L extends E{get width(){return this.orientation===P.HORIZONTAL?this.size:this.orthogonalSize}get height(){return this.orientation===P.HORIZONTAL?this.orthogonalSize:this.size}get minimumSize(){return this.children.length===0?0:Math.max(...this.children.map((e,t)=>this.splitview.isViewVisible(t)?e.minimumOrthogonalSize:0))}get maximumSize(){return Math.min(...this.children.map((e,t)=>this.splitview.isViewVisible(t)?e.maximumOrthogonalSize:Number.POSITIVE_INFINITY))}get minimumOrthogonalSize(){return this.splitview.minimumSize}get maximumOrthogonalSize(){return this.splitview.maximumSize}get orthogonalSize(){return this._orthogonalSize}get size(){return this._size}get minimumWidth(){return this.orientation===P.HORIZONTAL?this.minimumOrthogonalSize:this.minimumSize}get minimumHeight(){return this.orientation===P.HORIZONTAL?this.minimumSize:this.minimumOrthogonalSize}get maximumWidth(){return this.orientation===P.HORIZONTAL?this.maximumOrthogonalSize:this.maximumSize}get maximumHeight(){return this.orientation===P.HORIZONTAL?this.maximumSize:this.maximumOrthogonalSize}get priority(){if(this.children.length===0)return W.Normal;const e=this.children.map(t=>typeof t.priority>"u"?W.Normal:t.priority);return e.some(t=>t===W.High)?W.High:e.some(t=>t===W.Low)?W.Low:W.Normal}get disabled(){return this.splitview.disabled}set disabled(e){this.splitview.disabled=e}get margin(){return this.splitview.margin}set margin(e){this.splitview.margin=e,this.children.forEach(t=>{t instanceof L&&(t.margin=e)})}constructor(e,t,i,n,s,r,a,l){if(super(),this.orientation=e,this.proportionalLayout=t,this.styles=i,this._childrenDisposable=N.NONE,this.children=[],this._onDidChange=new f,this.onDidChange=this._onDidChange.event,this._onDidVisibilityChange=new f,this.onDidVisibilityChange=this._onDidVisibilityChange.event,this._orthogonalSize=s,this._size=n,this.element=document.createElement("div"),this.element.className="dv-branch-node",!l)this.splitview=new rt(this.element,{orientation:this.orientation,proportionalLayout:t,styles:i,margin:a}),this.splitview.layout(this.size,this.orthogonalSize);else{const h={views:l.map(d=>({view:d.node,size:d.node.size,visible:d.node instanceof B&&d.visible!==void 0?d.visible:!0})),size:this.orthogonalSize};this.children=l.map(d=>d.node),this.splitview=new rt(this.element,{orientation:this.orientation,descriptor:h,proportionalLayout:t,styles:i,margin:a})}this.disabled=r,this.addDisposables(this._onDidChange,this._onDidVisibilityChange,this.splitview.onDidSashEnd(()=>{this._onDidChange.fire({})})),this.setupChildrenEvents()}setVisible(e){}isChildVisible(e){if(e<0||e>=this.children.length)throw new Error("Invalid index");return this.splitview.isViewVisible(e)}setChildVisible(e,t){if(e<0||e>=this.children.length)throw new Error("Invalid index");if(this.splitview.isViewVisible(e)===t)return;const i=this.splitview.contentSize===0;this.splitview.setViewVisible(e,t);const n=this.splitview.contentSize===0;(t&&i||!t&&n)&&this._onDidVisibilityChange.fire({visible:t})}moveChild(e,t){if(e===t)return;if(e<0||e>=this.children.length)throw new Error("Invalid from index");e<t&&t--,this.splitview.moveView(e,t);const i=this._removeChild(e);this._addChild(i,t)}getChildSize(e){if(e<0||e>=this.children.length)throw new Error("Invalid index");return this.splitview.getViewSize(e)}resizeChild(e,t){if(e<0||e>=this.children.length)throw new Error("Invalid index");this.splitview.resizeView(e,t)}layout(e,t){this._size=t,this._orthogonalSize=e,this.splitview.layout(t,e)}addChild(e,t,i,n){if(i<0||i>this.children.length)throw new Error("Invalid index");this.splitview.addView(e,t,i,n),this._addChild(e,i)}getChildCachedVisibleSize(e){if(e<0||e>=this.children.length)throw new Error("Invalid index");return this.splitview.getViewCachedVisibleSize(e)}removeChild(e,t){if(e<0||e>=this.children.length)throw new Error("Invalid index");return this.splitview.removeView(e,t),this._removeChild(e)}_addChild(e,t){this.children.splice(t,0,e),this.setupChildrenEvents()}_removeChild(e){const[t]=this.children.splice(e,1);return this.setupChildrenEvents(),t}setupChildrenEvents(){this._childrenDisposable.dispose(),this._childrenDisposable=new E(de.any(...this.children.map(e=>e.onDidChange))(e=>{this._onDidChange.fire({size:e.orthogonalSize})}),...this.children.map((e,t)=>e instanceof L?e.onDidVisibilityChange(({visible:i})=>{this.setChildVisible(t,i)}):N.NONE))}dispose(){this._childrenDisposable.dispose(),this.splitview.dispose(),this.children.forEach(e=>e.dispose()),super.dispose()}}function $e(o,e){if(o instanceof B)return o;if(o instanceof L)return $e(o.children[e?o.children.length-1:0],e);throw new Error("invalid node")}function yt(o,e,t){if(o instanceof L){const i=new L(o.orientation,o.proportionalLayout,o.styles,e,t,o.disabled,o.margin);for(let n=o.children.length-1;n>=0;n--){const s=o.children[n];i.addChild(yt(s,s.size,s.orthogonalSize),s.size,0,!0)}return i}else return new B(o.view,o.orientation,t)}function qe(o,e,t){if(o instanceof L){const i=new L(ee(o.orientation),o.proportionalLayout,o.styles,e,t,o.disabled,o.margin);let n=0;for(let s=o.children.length-1;s>=0;s--){const r=o.children[s],a=r instanceof L?r.orthogonalSize:r.size;let l=o.size===0?0:Math.round(e*a/o.size);n+=l,s===0&&(l+=e-n),i.addChild(qe(r,t,l),l,0,!0)}return i}else return new B(o.view,ee(o.orientation),t)}function xi(o){const e=o.parentElement;if(!e)throw new Error("Invalid grid element");let t=e.firstElementChild,i=0;for(;t!==o&&t!==e.lastElementChild&&t;)t=t.nextElementSibling,i++;return i}function U(o){const e=o.parentElement;if(!e)throw new Error("Invalid grid element");if(/\bdv-grid-view\b/.test(e.className))return[];const t=xi(e),i=e.parentElement.parentElement.parentElement;return[...U(i),t]}function ue(o,e,t){const i=Si(o,e),n=Ai(t);if(i===n){const[s,r]=he(e);let a=r;return(t==="right"||t==="bottom")&&(a+=1),[...s,a]}else{const s=t==="right"||t==="bottom"?1:0;return[...e,s]}}function Ai(o){return o==="top"||o==="bottom"?P.VERTICAL:P.HORIZONTAL}function Si(o,e){return e.length%2===0?ee(o):o}const ee=o=>o===P.HORIZONTAL?P.VERTICAL:P.HORIZONTAL;function Pi(o){return!!o.children}const Ye=(o,e)=>{const t=e===P.VERTICAL?o.box.width:o.box.height;return Pi(o)?{type:"branch",data:o.children.map(i=>Ye(i,ee(e))),size:t}:typeof o.cachedVisibleSize=="number"?{type:"leaf",data:o.view.toJSON(),size:o.cachedVisibleSize,visible:!1}:{type:"leaf",data:o.view.toJSON(),size:t}};class Ei{get length(){return this._root?this._root.children.length:0}get orientation(){return this.root.orientation}set orientation(e){if(this.root.orientation===e)return;const{size:t,orthogonalSize:i}=this.root;this.root=qe(this.root,i,t),this.root.layout(t,i)}get width(){return this.root.width}get height(){return this.root.height}get minimumWidth(){return this.root.minimumWidth}get minimumHeight(){return this.root.minimumHeight}get maximumWidth(){return this.root.maximumHeight}get maximumHeight(){return this.root.maximumHeight}get locked(){return this._locked}set locked(e){this._locked=e;const t=[this.root];for(;t.length>0;){const i=t.pop();i instanceof L&&(i.disabled=e,t.push(...i.children))}}get margin(){return this._margin}set margin(e){this._margin=e,this.root.margin=e}maximizedView(){var e;return(e=this._maximizedNode)===null||e===void 0?void 0:e.leaf.view}hasMaximizedView(){return this._maximizedNode!==void 0}maximizeView(e){var t;const i=U(e.element),[n,s]=this.getNode(i);if(!(s instanceof B)||((t=this._maximizedNode)===null||t===void 0?void 0:t.leaf)===s)return;this.hasMaximizedView()&&this.exitMaximizedView(),Ye(this.getView(),this.orientation);const r=[];function a(l,h){for(let d=0;d<l.children.length;d++){const c=l.children[d];c instanceof B?c!==h&&(l.isChildVisible(d)?l.setChildVisible(d,!1):r.push(c)):a(c,h)}}a(this.root,s),this._maximizedNode={leaf:s,hiddenOnMaximize:r},this._onDidMaximizedNodeChange.fire({view:s.view,isMaximized:!0})}exitMaximizedView(){if(!this._maximizedNode)return;const e=this._maximizedNode.hiddenOnMaximize;function t(n){for(let s=n.children.length-1;s>=0;s--){const r=n.children[s];r instanceof B?e.includes(r)||n.setChildVisible(s,!0):t(r)}}t(this.root);const i=this._maximizedNode.leaf;this._maximizedNode=void 0,this._onDidMaximizedNodeChange.fire({view:i.view,isMaximized:!1})}serialize(){const e=this.maximizedView();let t;e&&(t=U(e.element)),this.hasMaximizedView()&&this.exitMaximizedView();const n={root:Ye(this.getView(),this.orientation),width:this.width,height:this.height,orientation:this.orientation};return t&&(n.maximizedNode={location:t}),e&&this.maximizeView(e),n}dispose(){this.disposable.dispose(),this._onDidChange.dispose(),this._onDidMaximizedNodeChange.dispose(),this._onDidViewVisibilityChange.dispose(),this.root.dispose(),this._maximizedNode=void 0,this.element.remove()}clear(){const e=this.root.orientation;this.root=new L(e,this.proportionalLayout,this.styles,this.root.size,this.root.orthogonalSize,this.locked,this.margin)}deserialize(e,t){const i=e.orientation,n=i===P.VERTICAL?e.height:e.width;if(this._deserialize(e.root,i,t,n),this.layout(e.width,e.height),e.maximizedNode){const s=e.maximizedNode.location,[r,a]=this.getNode(s);if(!(a instanceof B))return;this.maximizeView(a.view)}}_deserialize(e,t,i,n){this.root=this._deserializeNode(e,t,i,n)}_deserializeNode(e,t,i,n){var s;let r;if(e.type==="branch"){const l=e.data.map(h=>({node:this._deserializeNode(h,ee(t),i,e.size),visible:h.visible}));r=new L(t,this.proportionalLayout,this.styles,e.size,n,this.locked,this.margin,l)}else{const a=i.fromJSON(e);typeof e.visible=="boolean"&&((s=a.setVisible)===null||s===void 0||s.call(a,e.visible)),r=new B(a,t,n,e.size)}return r}get root(){return this._root}set root(e){const t=this._root;t&&(t.dispose(),this._maximizedNode=void 0,this.element.removeChild(t.element)),this._root=e,this.element.appendChild(this._root.element),this.disposable.value=this._root.onDidChange(i=>{this._onDidChange.fire(i)})}normalize(){if(!this._root||this._root.children.length!==1)return;const e=this.root,t=e.children[0];if(t instanceof B)return;e.element.remove();const i=e.removeChild(0);e.dispose(),i.dispose(),this._root=yt(t,t.size,t.orthogonalSize),this.element.appendChild(this._root.element),this.disposable.value=this._root.onDidChange(n=>{this._onDidChange.fire(n)})}insertOrthogonalSplitviewAtRoot(){if(!this._root)return;const e=this.root;if(e.element.remove(),this._root=new L(ee(e.orientation),this.proportionalLayout,this.styles,this.root.orthogonalSize,this.root.size,this.locked,this.margin),e.children.length!==0)if(e.children.length===1){const t=e.children[0];e.removeChild(0).dispose(),e.dispose(),this._root.addChild(qe(t,t.orthogonalSize,t.size),ie.Distribute,0)}else this._root.addChild(e,ie.Distribute,0);this.element.appendChild(this._root.element),this.disposable.value=this._root.onDidChange(t=>{this._onDidChange.fire(t)})}next(e){return this.progmaticSelect(e)}previous(e){return this.progmaticSelect(e,!0)}getView(e){const t=e?this.getNode(e)[1]:this.root;return this._getViews(t,this.orientation)}_getViews(e,t,i){const n={height:e.height,width:e.width};if(e instanceof B)return{box:n,view:e.view,cachedVisibleSize:i};const s=[];for(let r=0;r<e.children.length;r++){const a=e.children[r],l=e.getChildCachedVisibleSize(r);s.push(this._getViews(a,ee(t),l))}return{box:n,children:s}}progmaticSelect(e,t=!1){const[i,n]=this.getNode(e);if(!(n instanceof B))throw new Error("invalid location");for(let s=i.length-1;s>-1;s--){const r=i[s],a=e[s]||0;if(t?a-1>-1:a+1<r.children.length)return $e(r.children[t?a-1:a+1],t)}return $e(this.root,t)}constructor(e,t,i,n,s){this.proportionalLayout=e,this.styles=t,this._locked=!1,this._margin=0,this._maximizedNode=void 0,this.disposable=new Z,this._onDidChange=new f,this.onDidChange=this._onDidChange.event,this._onDidViewVisibilityChange=new f,this.onDidViewVisibilityChange=this._onDidViewVisibilityChange.event,this._onDidMaximizedNodeChange=new f,this.onDidMaximizedNodeChange=this._onDidMaximizedNodeChange.event,this.element=document.createElement("div"),this.element.className="dv-grid-view",this._locked=n??!1,this._margin=s??0,this.root=new L(i,e,t,0,0,this.locked,this.margin)}isViewVisible(e){const[t,i]=he(e),[,n]=this.getNode(t);if(!(n instanceof L))throw new Error("Invalid from location");return n.isChildVisible(i)}setViewVisible(e,t){this.hasMaximizedView()&&this.exitMaximizedView();const[i,n]=he(e),[,s]=this.getNode(i);if(!(s instanceof L))throw new Error("Invalid from location");this._onDidViewVisibilityChange.fire(),s.setChildVisible(n,t)}moveView(e,t,i){this.hasMaximizedView()&&this.exitMaximizedView();const[,n]=this.getNode(e);if(!(n instanceof L))throw new Error("Invalid location");n.moveChild(t,i)}addView(e,t,i){this.hasMaximizedView()&&this.exitMaximizedView();const[n,s]=he(i),[r,a]=this.getNode(n);if(a instanceof L){const l=new B(e,ee(a.orientation),a.orthogonalSize);a.addChild(l,t,s)}else{const[l,...h]=[...r].reverse(),[d,...c]=[...n].reverse();let m=0;const u=l.getChildCachedVisibleSize(d);typeof u=="number"&&(m=ie.Invisible(u)),l.removeChild(d).dispose();const p=new L(a.orientation,this.proportionalLayout,this.styles,a.size,a.orthogonalSize,this.locked,this.margin);l.addChild(p,a.size,d);const g=new B(a.view,l.orientation,a.size);p.addChild(g,m,0),typeof t!="number"&&t.type==="split"&&(t={type:"split",index:0});const b=new B(e,l.orientation,a.size);p.addChild(b,t,s)}}remove(e,t){const i=U(e.element);return this.removeView(i,t)}removeView(e,t){this.hasMaximizedView()&&this.exitMaximizedView();const[i,n]=he(e),[s,r]=this.getNode(i);if(!(r instanceof L))throw new Error("Invalid location");const a=r.children[n];if(!(a instanceof B))throw new Error("Invalid location");if(r.removeChild(n,t),a.dispose(),r.children.length!==1)return a.view;const l=r.children[0];if(s.length===0)return l instanceof B||(r.removeChild(0,t),this.root=l),a.view;const[h,...d]=[...s].reverse(),[c,...m]=[...i].reverse(),u=r.isChildVisible(0);r.removeChild(0,t);const _=h.children.map((p,g)=>h.getChildSize(g));if(h.removeChild(c,t).dispose(),l instanceof L){_.splice(c,1,...l.children.map(p=>p.size));for(let p=0;p<l.children.length;p++){const g=l.children[p];h.addChild(g,g.size,c+p)}for(;l.children.length>0;)l.removeChild(0)}else{const p=new B(l.view,ee(l.orientation),l.size),g=u?l.orthogonalSize:ie.Invisible(l.orthogonalSize);h.addChild(p,g,c)}l.dispose();for(let p=0;p<_.length;p++)h.resizeChild(p,_[p]);return a.view}layout(e,t){const[i,n]=this.root.orientation===P.HORIZONTAL?[t,e]:[e,t];this.root.layout(i,n)}getNode(e,t=this.root,i=[]){if(e.length===0)return[i,t];if(!(t instanceof L))throw new Error("Invalid location");const[n,...s]=e;if(n<0||n>=t.children.length)throw new Error("Invalid location");const r=t.children[n];return i.push(t),this.getNode(s,r,i)}}class zi extends E{get element(){return this._element}get disableResizing(){return this._disableResizing}set disableResizing(e){this._disableResizing=e}constructor(e,t=!1){super(),this._disableResizing=t,this._element=e,this.addDisposables(Ie(this._element,i=>{if(this.isDisposed||this.disableResizing||!this._element.offsetParent||!ui(this._element))return;const{width:n,height:s}=i.contentRect;this.layout(n,s)}))}}const Ii=Ct();function at(o){switch(o){case"left":return"left";case"right":return"right";case"above":return"top";case"below":return"bottom";case"within":default:return"center"}}class Gi extends zi{get id(){return this._id}get size(){return this._groups.size}get groups(){return Array.from(this._groups.values()).map(e=>e.value)}get width(){return this.gridview.width}get height(){return this.gridview.height}get minimumHeight(){return this.gridview.minimumHeight}get maximumHeight(){return this.gridview.maximumHeight}get minimumWidth(){return this.gridview.minimumWidth}get maximumWidth(){return this.gridview.maximumWidth}get activeGroup(){return this._activeGroup}get locked(){return this.gridview.locked}set locked(e){this.gridview.locked=e}constructor(e,t){var i;super(document.createElement("div"),t.disableAutoResizing),this._id=Ii.next(),this._groups=new Map,this._onDidRemove=new f,this.onDidRemove=this._onDidRemove.event,this._onDidAdd=new f,this.onDidAdd=this._onDidAdd.event,this._onDidMaximizedChange=new f,this.onDidMaximizedChange=this._onDidMaximizedChange.event,this._onDidActiveChange=new f,this.onDidActiveChange=this._onDidActiveChange.event,this._bufferOnDidLayoutChange=new st,this.onDidLayoutChange=this._bufferOnDidLayoutChange.onEvent,this._onDidViewVisibilityChangeMicroTaskQueue=new st,this.onDidViewVisibilityChangeMicroTaskQueue=this._onDidViewVisibilityChangeMicroTaskQueue.onEvent,this.element.style.height="100%",this.element.style.width="100%",this._classNames=new bt(this.element),this._classNames.setClassNames((i=t.className)!==null&&i!==void 0?i:""),e.appendChild(this.element),this.gridview=new Ei(!!t.proportionalLayout,t.styles,t.orientation,t.locked,t.margin),this.gridview.locked=!!t.locked,this.element.appendChild(this.gridview.element),this.layout(0,0,!0),this.addDisposables(this.gridview.onDidMaximizedNodeChange(n=>{this._onDidMaximizedChange.fire({panel:n.view,isMaximized:n.isMaximized})}),this.gridview.onDidViewVisibilityChange(()=>this._onDidViewVisibilityChangeMicroTaskQueue.fire()),this.onDidViewVisibilityChangeMicroTaskQueue(()=>{this.layout(this.width,this.height,!0)}),N.from(()=>{var n;(n=this.element.parentElement)===null||n===void 0||n.removeChild(this.element)}),this.gridview.onDidChange(()=>{this._bufferOnDidLayoutChange.fire()}),de.any(this.onDidAdd,this.onDidRemove,this.onDidActiveChange)(()=>{this._bufferOnDidLayoutChange.fire()}),this._onDidMaximizedChange,this._onDidViewVisibilityChangeMicroTaskQueue,this._bufferOnDidLayoutChange)}setVisible(e,t){this.gridview.setViewVisible(U(e.element),t),this._bufferOnDidLayoutChange.fire()}isVisible(e){return this.gridview.isViewVisible(U(e.element))}updateOptions(e){var t,i,n,s;e.proportionalLayout,e.orientation&&(this.gridview.orientation=e.orientation),"disableResizing"in e&&(this.disableResizing=(t=e.disableAutoResizing)!==null&&t!==void 0?t:!1),"locked"in e&&(this.locked=(i=e.locked)!==null&&i!==void 0?i:!1),"margin"in e&&(this.gridview.margin=(n=e.margin)!==null&&n!==void 0?n:0),"className"in e&&this._classNames.setClassNames((s=e.className)!==null&&s!==void 0?s:"")}maximizeGroup(e){this.gridview.maximizeView(e),this.doSetGroupActive(e)}isMaximizedGroup(e){return this.gridview.maximizedView()===e}exitMaximizedGroup(){this.gridview.exitMaximizedView()}hasMaximizedGroup(){return this.gridview.hasMaximizedView()}doAddGroup(e,t=[0],i){this.gridview.addView(e,i??ie.Distribute,t),this._onDidAdd.fire(e)}doRemoveGroup(e,t){if(!this._groups.has(e.id))throw new Error("invalid operation");const i=this._groups.get(e.id),n=this.gridview.remove(e,ie.Distribute);if(i&&!t?.skipDispose&&(i.disposable.dispose(),i.value.dispose(),this._groups.delete(e.id),this._onDidRemove.fire(e)),!t?.skipActive&&this._activeGroup===e){const s=Array.from(this._groups.values());this.doSetGroupActive(s.length>0?s[0].value:void 0)}return n}getPanel(e){var t;return(t=this._groups.get(e))===null||t===void 0?void 0:t.value}doSetGroupActive(e){this._activeGroup!==e&&(this._activeGroup&&this._activeGroup.setActive(!1),e&&e.setActive(!0),this._activeGroup=e,this._onDidActiveChange.fire(e))}removeGroup(e){this.doRemoveGroup(e)}moveToNext(e){var t;if(e||(e={}),!e.group){if(!this.activeGroup)return;e.group=this.activeGroup}const i=U(e.group.element),n=(t=this.gridview.next(i))===null||t===void 0?void 0:t.view;this.doSetGroupActive(n)}moveToPrevious(e){var t;if(e||(e={}),!e.group){if(!this.activeGroup)return;e.group=this.activeGroup}const i=U(e.group.element),n=(t=this.gridview.previous(i))===null||t===void 0?void 0:t.view;this.doSetGroupActive(n)}layout(e,t,i){(i||e!==this.width||t!==this.height)&&(this.gridview.element.style.height=`${t}px`,this.gridview.element.style.width=`${e}px`,this.gridview.layout(e,t))}dispose(){this._onDidActiveChange.dispose(),this._onDidAdd.dispose(),this._onDidRemove.dispose();for(const e of this.groups)e.dispose();this.gridview.dispose(),super.dispose()}}class Pe{get id(){return this.component.id}get width(){return this.component.width}get height(){return this.component.height}get minimumHeight(){return this.component.minimumHeight}get maximumHeight(){return this.component.maximumHeight}get minimumWidth(){return this.component.minimumWidth}get maximumWidth(){return this.component.maximumWidth}get size(){return this.component.size}get totalPanels(){return this.component.totalPanels}get onDidActiveGroupChange(){return this.component.onDidActiveGroupChange}get onDidAddGroup(){return this.component.onDidAddGroup}get onDidRemoveGroup(){return this.component.onDidRemoveGroup}get onDidActivePanelChange(){return this.component.onDidActivePanelChange}get onDidAddPanel(){return this.component.onDidAddPanel}get onDidRemovePanel(){return this.component.onDidRemovePanel}get onDidMovePanel(){return this.component.onDidMovePanel}get onDidLayoutFromJSON(){return this.component.onDidLayoutFromJSON}get onDidLayoutChange(){return this.component.onDidLayoutChange}get onDidDrop(){return this.component.onDidDrop}get onWillDrop(){return this.component.onWillDrop}get onWillShowOverlay(){return this.component.onWillShowOverlay}get onWillDragGroup(){return this.component.onWillDragGroup}get onWillDragPanel(){return this.component.onWillDragPanel}get onUnhandledDragOverEvent(){return this.component.onUnhandledDragOverEvent}get onDidPopoutGroupSizeChange(){return this.component.onDidPopoutGroupSizeChange}get onDidPopoutGroupPositionChange(){return this.component.onDidPopoutGroupPositionChange}get onDidOpenPopoutWindowFail(){return this.component.onDidOpenPopoutWindowFail}get panels(){return this.component.panels}get groups(){return this.component.groups}get activePanel(){return this.component.activePanel}get activeGroup(){return this.component.activeGroup}constructor(e){this.component=e}focus(){this.component.focus()}getPanel(e){return this.component.getGroupPanel(e)}layout(e,t,i=!1){this.component.layout(e,t,i)}addPanel(e){return this.component.addPanel(e)}removePanel(e){this.component.removePanel(e)}addGroup(e){return this.component.addGroup(e)}closeAllGroups(){return this.component.closeAllGroups()}removeGroup(e){this.component.removeGroup(e)}getGroup(e){return this.component.getPanel(e)}addFloatingGroup(e,t){return this.component.addFloatingGroup(e,t)}fromJSON(e){this.component.fromJSON(e)}toJSON(){return this.component.toJSON()}clear(){this.component.clear()}moveToNext(e){this.component.moveToNext(e)}moveToPrevious(e){this.component.moveToPrevious(e)}maximizeGroup(e){this.component.maximizeGroup(e.group)}hasMaximizedGroup(){return this.component.hasMaximizedGroup()}exitMaximizedGroup(){this.component.exitMaximizedGroup()}get onDidMaximizedGroupChange(){return this.component.onDidMaximizedGroupChange}addPopoutGroup(e,t){return this.component.addPopoutGroup(e,t)}updateOptions(e){this.component.updateOptions(e)}dispose(){this.component.dispose()}}class xt extends E{constructor(e,t){super(),this.el=e,this.disabled=t,this.dataDisposable=new Z,this.pointerEventsDisposable=new Z,this._onDragStart=new f,this.onDragStart=this._onDragStart.event,this.addDisposables(this._onDragStart,this.dataDisposable,this.pointerEventsDisposable),this.configure()}setDisabled(e){this.disabled=e}isCancelled(e){return!1}configure(){this.addDisposables(this._onDragStart,I(this.el,"dragstart",e=>{if(e.defaultPrevented||this.isCancelled(e)||this.disabled){e.preventDefault();return}const t=Se();this.pointerEventsDisposable.value={dispose:()=>{t.release()}},this.el.classList.add("dv-dragged"),setTimeout(()=>this.el.classList.remove("dv-dragged"),0),this.dataDisposable.value=this.getData(e),this._onDragStart.fire(e),e.dataTransfer&&(e.dataTransfer.effectAllowed="move",e.dataTransfer.items.length>0||e.dataTransfer.setData("text/plain",""))}),I(this.el,"dragend",()=>{this.pointerEventsDisposable.dispose(),setTimeout(()=>{this.dataDisposable.dispose()},0)}))}}class At extends E{constructor(e,t){super(),this.element=e,this.callbacks=t,this.target=null,this.registerListeners()}onDragEnter(e){this.target=e.target,this.callbacks.onDragEnter(e)}onDragOver(e){e.preventDefault(),this.callbacks.onDragOver&&this.callbacks.onDragOver(e)}onDragLeave(e){this.target===e.target&&(this.target=null,this.callbacks.onDragLeave(e))}onDragEnd(e){this.target=null,this.callbacks.onDragEnd(e)}onDrop(e){this.callbacks.onDrop(e)}registerListeners(){this.addDisposables(I(this.element,"dragenter",e=>{this.onDragEnter(e)},!0)),this.addDisposables(I(this.element,"dragover",e=>{this.onDragOver(e)},!0)),this.addDisposables(I(this.element,"dragleave",e=>{this.onDragLeave(e)})),this.addDisposables(I(this.element,"dragend",e=>{this.onDragEnd(e)})),this.addDisposables(I(this.element,"drop",e=>{this.onDrop(e)}))}}function Mi(o,e){const{top:t,left:i,width:n,height:s}=e,r=`${Math.round(t)}px`,a=`${Math.round(i)}px`,l=`${Math.round(n)}px`,h=`${Math.round(s)}px`;o.style.top=r,o.style.left=a,o.style.width=l,o.style.height=h,o.style.visibility="visible",(!o.style.transform||o.style.transform==="")&&(o.style.transform="translate3d(0, 0, 0)")}function Oi(o,e){const{top:t,left:i,width:n,height:s}=e;o.style.top=t,o.style.left=i,o.style.width=n,o.style.height=s,o.style.visibility="visible",(!o.style.transform||o.style.transform==="")&&(o.style.transform="translate3d(0, 0, 0)")}function Ti(o,e){const{top:t,left:i,width:n,height:s}=e,r=`${Math.round(t)}px`,a=`${Math.round(i)}px`,l=`${Math.round(n)}px`,h=`${Math.round(s)}px`;return o.style.top!==r||o.style.left!==a||o.style.width!==l||o.style.height!==h}class Li extends Je{get nativeEvent(){return this.options.nativeEvent}get position(){return this.options.position}constructor(e){super(),this.options=e}}function lt(o){switch(o){case"above":return"top";case"below":return"bottom";case"left":return"left";case"right":return"right";case"within":return"center";default:throw new Error(`invalid direction '${o}'`)}}function ki(o){switch(o){case"top":return"above";case"bottom":return"below";case"left":return"left";case"right":return"right";case"center":return"within";default:throw new Error(`invalid position '${o}'`)}}const Vi={value:20,type:"percentage"},Ri={value:50,type:"percentage"},Wi=100,Ni=100;class te extends E{get disabled(){return this._disabled}set disabled(e){this._disabled=e}get state(){return this._state}constructor(e,t){super(),this.element=e,this.options=t,this._onDrop=new f,this.onDrop=this._onDrop.event,this._onWillShowOverlay=new f,this.onWillShowOverlay=this._onWillShowOverlay.event,this._disabled=!1,this._acceptedTargetZonesSet=new Set(this.options.acceptedTargetZones),this.dnd=new At(this.element,{onDragEnter:()=>{var i,n,s;(s=(n=(i=this.options).getOverrideTarget)===null||n===void 0?void 0:n.call(i))===null||s===void 0||s.getElements()},onDragOver:i=>{var n,s,r,a,l,h,d;te.ACTUAL_TARGET=this;const c=(s=(n=this.options).getOverrideTarget)===null||s===void 0?void 0:s.call(n);if(this._acceptedTargetZonesSet.size===0){if(c)return;this.removeDropTarget();return}const m=(l=(a=(r=this.options).getOverlayOutline)===null||a===void 0?void 0:a.call(r))!==null&&l!==void 0?l:this.element,u=m.offsetWidth,_=m.offsetHeight;if(u===0||_===0)return;const p=i.currentTarget.getBoundingClientRect(),g=((h=i.clientX)!==null&&h!==void 0?h:0)-p.left,b=((d=i.clientY)!==null&&d!==void 0?d:0)-p.top,y=this.calculateQuadrant(this._acceptedTargetZonesSet,g,b,u,_);if(this.isAlreadyUsed(i)||y===null){this.removeDropTarget();return}if(!this.options.canDisplayOverlay(i,y)){if(c)return;this.removeDropTarget();return}const D=new Li({nativeEvent:i,position:y});if(this._onWillShowOverlay.fire(D),D.defaultPrevented){this.removeDropTarget();return}this.markAsUsed(i),c||this.targetElement||(this.targetElement=document.createElement("div"),this.targetElement.className="dv-drop-target-dropzone",this.overlayElement=document.createElement("div"),this.overlayElement.className="dv-drop-target-selection",this._state="center",this.targetElement.appendChild(this.overlayElement),m.classList.add("dv-drop-target"),m.append(this.targetElement)),this.toggleClasses(y,u,_),this._state=y},onDragLeave:()=>{var i,n;!((n=(i=this.options).getOverrideTarget)===null||n===void 0)&&n.call(i)||this.removeDropTarget()},onDragEnd:i=>{var n,s;const r=(s=(n=this.options).getOverrideTarget)===null||s===void 0?void 0:s.call(n);r&&te.ACTUAL_TARGET===this&&this._state&&(i.stopPropagation(),this._onDrop.fire({position:this._state,nativeEvent:i})),this.removeDropTarget(),r?.clear()},onDrop:i=>{var n,s,r;i.preventDefault();const a=this._state;this.removeDropTarget(),(r=(s=(n=this.options).getOverrideTarget)===null||s===void 0?void 0:s.call(n))===null||r===void 0||r.clear(),a&&(i.stopPropagation(),this._onDrop.fire({position:a,nativeEvent:i}))}}),this.addDisposables(this._onDrop,this._onWillShowOverlay,this.dnd)}setTargetZones(e){this._acceptedTargetZonesSet=new Set(e)}setOverlayModel(e){this.options.overlayModel=e}dispose(){this.removeDropTarget(),super.dispose()}markAsUsed(e){e[te.USED_EVENT_ID]=!0}isAlreadyUsed(e){const t=e[te.USED_EVENT_ID];return typeof t=="boolean"&&t}toggleClasses(e,t,i){var n,s,r,a,l,h,d;const c=(s=(n=this.options).getOverrideTarget)===null||s===void 0?void 0:s.call(n);if(!c&&!this.overlayElement)return;const m=t<Wi,u=i<Ni,_=e==="left",p=e==="right",g=e==="top",b=e==="bottom",y=!m&&p,D=!m&&_,v=!u&&g,x=!u&&b;let C=1;const O=(a=(r=this.options.overlayModel)===null||r===void 0?void 0:r.size)!==null&&a!==void 0?a:Ri;if(O.type==="percentage"?C=M(O.value,0,100)/100:((y||D)&&(C=M(0,O.value,t)/t),(v||x)&&(C=M(0,O.value,i)/i)),c){const F=(d=(h=(l=this.options).getOverlayOutline)===null||h===void 0?void 0:h.call(l))!==null&&d!==void 0?d:this.element,V=F.getBoundingClientRect(),H=c.getElements(void 0,F),j=H.root,G=H.overlay,z=j.getBoundingClientRect(),w=V.top-z.top,S=V.left-z.left,R={top:w,left:S,width:t,height:i};if(y?(R.left=S+t*(1-C),R.width=t*C):D?R.width=t*C:v?R.height=i*C:x&&(R.top=w+i*(1-C),R.height=i*C),m&&_&&(R.width=4),m&&p&&(R.left=S+t-4,R.width=4),!Ti(G,R))return;Mi(G,R),G.className=`dv-drop-target-anchor${this.options.className?` ${this.options.className}`:""}`,A(G,"dv-drop-target-left",_),A(G,"dv-drop-target-right",p),A(G,"dv-drop-target-top",g),A(G,"dv-drop-target-bottom",b),A(G,"dv-drop-target-center",e==="center"),H.changed&&(A(G,"dv-drop-target-anchor-container-changed",!0),setTimeout(()=>{A(G,"dv-drop-target-anchor-container-changed",!1)},10));return}if(!this.overlayElement)return;const k={top:"0px",left:"0px",width:"100%",height:"100%"};y?(k.left=`${100*(1-C)}%`,k.width=`${100*C}%`):D?k.width=`${100*C}%`:v?k.height=`${100*C}%`:x&&(k.top=`${100*(1-C)}%`,k.height=`${100*C}%`),Oi(this.overlayElement,k),A(this.overlayElement,"dv-drop-target-small-vertical",u),A(this.overlayElement,"dv-drop-target-small-horizontal",m),A(this.overlayElement,"dv-drop-target-left",_),A(this.overlayElement,"dv-drop-target-right",p),A(this.overlayElement,"dv-drop-target-top",g),A(this.overlayElement,"dv-drop-target-bottom",b),A(this.overlayElement,"dv-drop-target-center",e==="center")}calculateQuadrant(e,t,i,n,s){var r,a;const l=(a=(r=this.options.overlayModel)===null||r===void 0?void 0:r.activationSize)!==null&&a!==void 0?a:Vi;return l.type==="percentage"?Bi(e,t,i,n,s,l.value):Hi(e,t,i,n,s,l.value)}removeDropTarget(){var e;this.targetElement&&(this._state=void 0,(e=this.targetElement.parentElement)===null||e===void 0||e.classList.remove("dv-drop-target"),this.targetElement.remove(),this.targetElement=void 0,this.overlayElement=void 0)}}te.USED_EVENT_ID="__dockview_droptarget_event_is_used__";function Bi(o,e,t,i,n,s){const r=100*e/i,a=100*t/n;return o.has("left")&&r<s?"left":o.has("right")&&r>100-s?"right":o.has("top")&&a<s?"top":o.has("bottom")&&a>100-s?"bottom":o.has("center")?"center":null}function Hi(o,e,t,i,n,s){return o.has("left")&&e<s?"left":o.has("right")&&e>i-s?"right":o.has("top")&&t<s?"top":o.has("bottom")&&t>n-s?"bottom":o.has("center")?"center":null}class St extends Je{constructor(){super()}}class Ui extends E{get isFocused(){return this._isFocused}get isActive(){return this._isActive}get isVisible(){return this._isVisible}get width(){return this._width}get height(){return this._height}constructor(e,t){super(),this.id=e,this.component=t,this._isFocused=!1,this._isActive=!1,this._isVisible=!0,this._width=0,this._height=0,this._parameters={},this.panelUpdatesDisposable=new Z,this._onDidDimensionChange=new f,this.onDidDimensionsChange=this._onDidDimensionChange.event,this._onDidChangeFocus=new f,this.onDidFocusChange=this._onDidChangeFocus.event,this._onWillFocus=new f,this.onWillFocus=this._onWillFocus.event,this._onDidVisibilityChange=new f,this.onDidVisibilityChange=this._onDidVisibilityChange.event,this._onWillVisibilityChange=new f,this.onWillVisibilityChange=this._onWillVisibilityChange.event,this._onDidActiveChange=new f,this.onDidActiveChange=this._onDidActiveChange.event,this._onActiveChange=new f,this.onActiveChange=this._onActiveChange.event,this._onDidParametersChange=new f,this.onDidParametersChange=this._onDidParametersChange.event,this.addDisposables(this.onDidFocusChange(i=>{this._isFocused=i.isFocused}),this.onDidActiveChange(i=>{this._isActive=i.isActive}),this.onDidVisibilityChange(i=>{this._isVisible=i.isVisible}),this.onDidDimensionsChange(i=>{this._width=i.width,this._height=i.height}),this.panelUpdatesDisposable,this._onDidDimensionChange,this._onDidChangeFocus,this._onDidVisibilityChange,this._onDidActiveChange,this._onWillFocus,this._onActiveChange,this._onWillFocus,this._onWillVisibilityChange,this._onDidParametersChange)}getParameters(){return this._parameters}initialize(e){this.panelUpdatesDisposable.value=this._onDidParametersChange.event(t=>{this._parameters=t,e.update({params:t})})}setVisible(e){this._onWillVisibilityChange.fire({isVisible:e})}setActive(){this._onActiveChange.fire()}updateParameters(e){this._onDidParametersChange.fire(e)}}class Fi extends E{get element(){return this._element}get width(){return this._width}get height(){return this._height}get params(){var e;return(e=this._params)===null||e===void 0?void 0:e.params}constructor(e,t,i){super(),this.id=e,this.component=t,this.api=i,this._height=0,this._width=0,this._element=document.createElement("div"),this._element.tabIndex=-1,this._element.style.outline="none",this._element.style.height="100%",this._element.style.width="100%",this._element.style.overflow="hidden";const n=_t(this._element);this.addDisposables(this.api,n.onDidFocus(()=>{this.api._onDidChangeFocus.fire({isFocused:!0})}),n.onDidBlur(()=>{this.api._onDidChangeFocus.fire({isFocused:!1})}),n)}focus(){const e=new St;this.api._onWillFocus.fire(e),!e.defaultPrevented&&this._element.focus()}layout(e,t){this._width=e,this._height=t,this.api._onDidDimensionChange.fire({width:e,height:t}),this.part&&this._params&&this.part.update(this._params.params)}init(e){this._params=e,this.part=this.getComponent()}update(e){var t,i;this._params=Object.assign(Object.assign({},this._params),{params:Object.assign(Object.assign({},(t=this._params)===null||t===void 0?void 0:t.params),e.params)});for(const n of Object.keys(e.params))e.params[n]===void 0&&delete this._params.params[n];(i=this.part)===null||i===void 0||i.update({params:this._params.params})}toJSON(){var e,t;const i=(t=(e=this._params)===null||e===void 0?void 0:e.params)!==null&&t!==void 0?t:{};return{id:this.id,component:this.component,params:Object.keys(i).length>0?i:void 0}}dispose(){var e;this.api.dispose(),(e=this.part)===null||e===void 0||e.dispose(),super.dispose()}}class ji extends E{get element(){return this._element}constructor(e,t){super(),this.accessor=e,this.group=t,this.disposable=new Z,this._onDidFocus=new f,this.onDidFocus=this._onDidFocus.event,this._onDidBlur=new f,this.onDidBlur=this._onDidBlur.event,this._element=document.createElement("div"),this._element.className="dv-content-container",this._element.tabIndex=-1,this.addDisposables(this._onDidFocus,this._onDidBlur);const i=t.dropTargetContainer;this.dropTarget=new te(this.element,{getOverlayOutline:()=>{var n;return((n=e.options.theme)===null||n===void 0?void 0:n.dndPanelOverlay)==="group"?this.element.parentElement:null},className:"dv-drop-target-content",acceptedTargetZones:["top","bottom","left","right","center"],canDisplayOverlay:(n,s)=>{if(this.group.locked==="no-drop-target"||this.group.locked&&s==="center")return!1;const r=q();return!r&&n.shiftKey&&this.group.location.type!=="floating"?!1:r&&r.viewId===this.accessor.id?!0:this.group.canDisplayOverlay(n,s,"content")},getOverrideTarget:i?()=>i.model:void 0}),this.addDisposables(this.dropTarget)}show(){this.element.style.display=""}hide(){this.element.style.display="none"}renderPanel(e,t={asActive:!0}){const i=t.asActive||this.panel&&this.group.isPanelActive(this.panel);this.panel&&this.panel.view.content.element.parentElement===this._element&&this._element.removeChild(this.panel.view.content.element),this.panel=e;let n;switch(e.api.renderer){case"onlyWhenVisible":this.group.renderContainer.detatch(e),this.panel&&i&&this._element.appendChild(this.panel.view.content.element),n=this._element;break;case"always":e.view.content.element.parentElement===this._element&&this._element.removeChild(e.view.content.element),n=this.group.renderContainer.attach({panel:e,referenceContainer:this});break;default:throw new Error(`dockview: invalid renderer type '${e.api.renderer}'`)}if(i){const s=_t(n),r=new E;r.addDisposables(s,s.onDidFocus(()=>this._onDidFocus.fire()),s.onDidBlur(()=>this._onDidBlur.fire())),this.disposable.value=r}}openPanel(e){this.panel!==e&&this.renderPanel(e)}layout(e,t){}closePanel(){var e;this.panel&&this.panel.api.renderer==="onlyWhenVisible"&&((e=this.panel.view.content.element.parentElement)===null||e===void 0||e.removeChild(this.panel.view.content.element)),this.panel=void 0}dispose(){this.disposable.dispose(),super.dispose()}}function Pt(o,e,t){var i,n;vt(e,"dv-dragged"),e.style.top="-9999px",document.body.appendChild(e),o.setDragImage(e,(i=t?.x)!==null&&i!==void 0?i:0,(n=t?.y)!==null&&n!==void 0?n:0),setTimeout(()=>{Ue(e,"dv-dragged"),e.remove()},0)}class $i extends xt{constructor(e,t,i,n,s){super(e,s),this.accessor=t,this.group=i,this.panel=n,this.panelTransfer=ce.getInstance()}getData(e){return this.panelTransfer.setData([new re(this.accessor.id,this.group.id,this.panel.id)],re.prototype),{dispose:()=>{this.panelTransfer.clearData(re.prototype)}}}}class qi extends E{get element(){return this._element}constructor(e,t,i){super(),this.panel=e,this.accessor=t,this.group=i,this.content=void 0,this._onPointDown=new f,this.onPointerDown=this._onPointDown.event,this._onDropped=new f,this.onDrop=this._onDropped.event,this._onDragStart=new f,this.onDragStart=this._onDragStart.event,this._element=document.createElement("div"),this._element.className="dv-tab",this._element.tabIndex=0,this._element.draggable=!this.accessor.options.disableDnd,A(this.element,"dv-inactive-tab",!0),this.dragHandler=new $i(this._element,this.accessor,this.group,this.panel,!!this.accessor.options.disableDnd),this.dropTarget=new te(this._element,{acceptedTargetZones:["left","right"],overlayModel:{activationSize:{value:50,type:"percentage"}},canDisplayOverlay:(n,s)=>{if(this.group.locked)return!1;const r=q();return r&&this.accessor.id===r.viewId?!0:this.group.model.canDisplayOverlay(n,s,"tab")},getOverrideTarget:()=>{var n;return(n=i.model.dropTargetContainer)===null||n===void 0?void 0:n.model}}),this.onWillShowOverlay=this.dropTarget.onWillShowOverlay,this.addDisposables(this._onPointDown,this._onDropped,this._onDragStart,this.dragHandler.onDragStart(n=>{if(n.dataTransfer){const s=getComputedStyle(this.element),r=this.element.cloneNode(!0);Array.from(s).forEach(a=>r.style.setProperty(a,s.getPropertyValue(a),s.getPropertyPriority(a))),r.style.position="absolute",Pt(n.dataTransfer,r,{y:-10,x:30})}this._onDragStart.fire(n)}),this.dragHandler,I(this._element,"pointerdown",n=>{this._onPointDown.fire(n)}),this.dropTarget.onDrop(n=>{this._onDropped.fire(n)}),this.dropTarget)}setActive(e){A(this.element,"dv-active-tab",e),A(this.element,"dv-inactive-tab",!e)}setContent(e){this.content&&this._element.removeChild(this.content.element),this.content=e,this._element.appendChild(this.content.element)}updateDragAndDropState(){this._element.draggable=!this.accessor.options.disableDnd,this.dragHandler.setDisabled(!!this.accessor.options.disableDnd)}dispose(){super.dispose()}}class Ge{get kind(){return this.options.kind}get nativeEvent(){return this.event.nativeEvent}get position(){return this.event.position}get defaultPrevented(){return this.event.defaultPrevented}get panel(){return this.options.panel}get api(){return this.options.api}get group(){return this.options.group}preventDefault(){this.event.preventDefault()}getData(){return this.options.getData()}constructor(e,t){this.event=e,this.options=t}}class Yi extends xt{constructor(e,t,i,n){super(e,n),this.accessor=t,this.group=i,this.panelTransfer=ce.getInstance(),this.addDisposables(I(e,"pointerdown",s=>{s.shiftKey&&di(s)},!0))}isCancelled(e){return this.group.api.location.type==="floating"&&!e.shiftKey}getData(e){const t=e.dataTransfer;this.panelTransfer.setData([new re(this.accessor.id,this.group.id,null)],re.prototype);const i=window.getComputedStyle(this.el),n=i.getPropertyValue("--dv-activegroup-visiblepanel-tab-background-color"),s=i.getPropertyValue("--dv-activegroup-visiblepanel-tab-color");if(t){const r=document.createElement("div");r.style.backgroundColor=n,r.style.color=s,r.style.padding="2px 8px",r.style.height="24px",r.style.fontSize="11px",r.style.lineHeight="20px",r.style.borderRadius="12px",r.style.position="absolute",r.style.pointerEvents="none",r.style.top="-9999px",r.textContent=`Multiple Panels (${this.group.size})`,Pt(t,r,{y:-10,x:30})}return{dispose:()=>{this.panelTransfer.clearData(re.prototype)}}}}class Xi extends E{get element(){return this._element}constructor(e,t){super(),this.accessor=e,this.group=t,this._onDrop=new f,this.onDrop=this._onDrop.event,this._onDragStart=new f,this.onDragStart=this._onDragStart.event,this._element=document.createElement("div"),this._element.className="dv-void-container",this._element.draggable=!this.accessor.options.disableDnd,A(this._element,"dv-draggable",!this.accessor.options.disableDnd),this.addDisposables(this._onDrop,this._onDragStart,I(this._element,"pointerdown",()=>{this.accessor.doSetGroupActive(this.group)})),this.handler=new Yi(this._element,e,t,!!this.accessor.options.disableDnd),this.dropTarget=new te(this._element,{acceptedTargetZones:["center"],canDisplayOverlay:(i,n)=>{const s=q();return s&&this.accessor.id===s.viewId?!0:t.model.canDisplayOverlay(i,n,"header_space")},getOverrideTarget:()=>{var i;return(i=t.model.dropTargetContainer)===null||i===void 0?void 0:i.model}}),this.onWillShowOverlay=this.dropTarget.onWillShowOverlay,this.addDisposables(this.handler,this.handler.onDragStart(i=>{this._onDragStart.fire(i)}),this.dropTarget.onDrop(i=>{this._onDrop.fire(i)}),this.dropTarget)}updateDragAndDropState(){this._element.draggable=!this.accessor.options.disableDnd,A(this._element,"dv-draggable",!this.accessor.options.disableDnd),this.handler.setDisabled(!!this.accessor.options.disableDnd)}}class Me extends E{get element(){return this._element}constructor(e){super(),this.scrollableElement=e,this._scrollLeft=0,this._element=document.createElement("div"),this._element.className="dv-scrollable",this._horizontalScrollbar=document.createElement("div"),this._horizontalScrollbar.className="dv-scrollbar-horizontal",this.element.appendChild(e),this.element.appendChild(this._horizontalScrollbar),this.addDisposables(I(this.element,"wheel",t=>{this._scrollLeft+=t.deltaY*Me.MouseWheelSpeed,this.calculateScrollbarStyles()}),I(this._horizontalScrollbar,"pointerdown",t=>{t.preventDefault(),A(this.element,"dv-scrollable-scrolling",!0);const i=t.clientX,n=this._scrollLeft,s=a=>{const l=a.clientX-i,{clientWidth:h}=this.element,{scrollWidth:d}=this.scrollableElement,c=h/d;this._scrollLeft=n+l/c,this.calculateScrollbarStyles()},r=()=>{A(this.element,"dv-scrollable-scrolling",!1),document.removeEventListener("pointermove",s),document.removeEventListener("pointerup",r),document.removeEventListener("pointercancel",r)};document.addEventListener("pointermove",s),document.addEventListener("pointerup",r),document.addEventListener("pointercancel",r)}),I(this.element,"scroll",()=>{this.calculateScrollbarStyles()}),I(this.scrollableElement,"scroll",()=>{this._scrollLeft=this.scrollableElement.scrollLeft,this.calculateScrollbarStyles()}),Ie(this.element,()=>{A(this.element,"dv-scrollable-resizing",!0),this._animationTimer&&clearTimeout(this._animationTimer),this._animationTimer=setTimeout(()=>{clearTimeout(this._animationTimer),A(this.element,"dv-scrollable-resizing",!1)},500),this.calculateScrollbarStyles()}))}calculateScrollbarStyles(){const{clientWidth:e}=this.element,{scrollWidth:t}=this.scrollableElement;if(t>e){const n=e*(e/t);this._horizontalScrollbar.style.width=`${n}px`,this._scrollLeft=M(this._scrollLeft,0,this.scrollableElement.scrollWidth-e),this.scrollableElement.scrollLeft=this._scrollLeft;const s=this._scrollLeft/(t-e);this._horizontalScrollbar.style.left=`${(e-n)*s}px`}else this._horizontalScrollbar.style.width="0px",this._horizontalScrollbar.style.left="0px",this._scrollLeft=0}}Me.MouseWheelSpeed=1;class Zi extends E{get showTabsOverflowControl(){return this._showTabsOverflowControl}set showTabsOverflowControl(e){if(this._showTabsOverflowControl!=e&&(this._showTabsOverflowControl=e,e)){const t=new li(this._tabsList);this._observerDisposable.value=new E(t,t.onDidChange(i=>{const n=i.hasScrollX||i.hasScrollY;this.toggleDropdown({reset:!n})}),I(this._tabsList,"scroll",()=>{this.toggleDropdown({reset:!1})}))}}get element(){return this._element}get panels(){return this._tabs.map(e=>e.value.panel.id)}get size(){return this._tabs.length}get tabs(){return this._tabs.map(e=>e.value)}constructor(e,t,i){if(super(),this.group=e,this.accessor=t,this._observerDisposable=new Z,this._tabs=[],this.selectedIndex=-1,this._showTabsOverflowControl=!1,this._onTabDragStart=new f,this.onTabDragStart=this._onTabDragStart.event,this._onDrop=new f,this.onDrop=this._onDrop.event,this._onWillShowOverlay=new f,this.onWillShowOverlay=this._onWillShowOverlay.event,this._onOverflowTabsChange=new f,this.onOverflowTabsChange=this._onOverflowTabsChange.event,this._tabsList=document.createElement("div"),this._tabsList.className="dv-tabs-container dv-horizontal",this.showTabsOverflowControl=i.showTabsOverflowControl,t.options.scrollbars==="native")this._element=this._tabsList;else{const n=new Me(this._tabsList);this._element=n.element,this.addDisposables(n)}this.addDisposables(this._onOverflowTabsChange,this._observerDisposable,this._onWillShowOverlay,this._onDrop,this._onTabDragStart,I(this.element,"pointerdown",n=>{if(n.defaultPrevented)return;n.button===0&&this.accessor.doSetGroupActive(this.group)}),N.from(()=>{for(const{value:n,disposable:s}of this._tabs)s.dispose(),n.dispose();this._tabs=[]}))}indexOf(e){return this._tabs.findIndex(t=>t.value.panel.id===e)}isActive(e){return this.selectedIndex>-1&&this._tabs[this.selectedIndex].value===e}setActivePanel(e){let t=0;for(const i of this._tabs){const n=e.id===i.value.panel.id;if(i.value.setActive(n),n){const s=i.value.element,r=s.parentElement;(t<r.scrollLeft||t+s.clientWidth>r.scrollLeft+r.clientWidth)&&(r.scrollLeft=t)}t+=i.value.element.clientWidth}}openPanel(e,t=this._tabs.length){if(this._tabs.find(r=>r.value.panel.id===e.id))return;const i=new qi(e,this.accessor,this.group);i.setContent(e.view.tab);const n=new E(i.onDragStart(r=>{this._onTabDragStart.fire({nativeEvent:r,panel:e})}),i.onPointerDown(r=>{if(r.defaultPrevented)return;const a=!this.accessor.options.disableFloatingGroups,l=this.group.api.location.type==="floating"&&this.size===1;if(a&&!l&&r.shiftKey){r.preventDefault();const h=this.accessor.getGroupPanel(i.panel.id),{top:d,left:c}=i.element.getBoundingClientRect(),{top:m,left:u}=this.accessor.element.getBoundingClientRect();this.accessor.addFloatingGroup(h,{x:c-u,y:d-m,inDragMode:!0});return}switch(r.button){case 0:this.group.activePanel!==e&&this.group.model.openPanel(e);break}}),i.onDrop(r=>{this._onDrop.fire({event:r.nativeEvent,index:this._tabs.findIndex(a=>a.value===i)})}),i.onWillShowOverlay(r=>{this._onWillShowOverlay.fire(new Ge(r,{kind:"tab",panel:this.group.activePanel,api:this.accessor.api,group:this.group,getData:q}))})),s={value:i,disposable:n};this.addTab(s,t)}delete(e){const t=this.indexOf(e),i=this._tabs.splice(t,1)[0],{value:n,disposable:s}=i;s.dispose(),n.dispose(),n.element.remove()}addTab(e,t=this._tabs.length){if(t<0||t>this._tabs.length)throw new Error("invalid location");this._tabsList.insertBefore(e.value.element,this._tabsList.children[t]),this._tabs=[...this._tabs.slice(0,t),e,...this._tabs.slice(t)],this.selectedIndex<0&&(this.selectedIndex=t)}toggleDropdown(e){const t=e.reset?[]:this._tabs.filter(i=>!gi(i.value.element,this._tabsList)).map(i=>i.value.panel.id);this._onOverflowTabsChange.fire({tabs:t,reset:e.reset})}updateDragAndDropState(){for(const e of this._tabs)e.value.updateDragAndDropState()}}const Et=o=>{const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttributeNS(null,"height",o.height),e.setAttributeNS(null,"width",o.width),e.setAttributeNS(null,"viewBox",o.viewbox),e.setAttributeNS(null,"aria-hidden","false"),e.setAttributeNS(null,"focusable","false"),e.classList.add("dv-svg");const t=document.createElementNS("http://www.w3.org/2000/svg","path");return t.setAttributeNS(null,"d",o.path),e.appendChild(t),e},Ji=()=>Et({width:"11",height:"11",viewbox:"0 0 28 28",path:"M2.1 27.3L0 25.2L11.55 13.65L0 2.1L2.1 0L13.65 11.55L25.2 0L27.3 2.1L15.75 13.65L27.3 25.2L25.2 27.3L13.65 15.75L2.1 27.3Z"}),Ki=()=>Et({width:"11",height:"11",viewbox:"0 0 15 25",path:"M2.15 24.1L0 21.95L9.9 12.05L0 2.15L2.15 0L14.2 12.05L2.15 24.1Z"});function Qi(){const o=document.createElement("div");o.className="dv-tabs-overflow-dropdown-default";const e=document.createElement("span");e.textContent="";const t=Ki();return o.appendChild(t),o.appendChild(e),{element:o,update:i=>{e.textContent=`${i.tabs}`}}}class en extends E{get onTabDragStart(){return this.tabs.onTabDragStart}get panels(){return this.tabs.panels}get size(){return this.tabs.size}get hidden(){return this._hidden}set hidden(e){this._hidden=e,this.element.style.display=e?"none":""}get element(){return this._element}constructor(e,t){super(),this.accessor=e,this.group=t,this._hidden=!1,this.dropdownPart=null,this._overflowTabs=[],this._dropdownDisposable=new Z,this._onDrop=new f,this.onDrop=this._onDrop.event,this._onGroupDragStart=new f,this.onGroupDragStart=this._onGroupDragStart.event,this._onWillShowOverlay=new f,this.onWillShowOverlay=this._onWillShowOverlay.event,this._element=document.createElement("div"),this._element.className="dv-tabs-and-actions-container",A(this._element,"dv-full-width-single-tab",this.accessor.options.singleTabMode==="fullwidth"),this.rightActionsContainer=document.createElement("div"),this.rightActionsContainer.className="dv-right-actions-container",this.leftActionsContainer=document.createElement("div"),this.leftActionsContainer.className="dv-left-actions-container",this.preActionsContainer=document.createElement("div"),this.preActionsContainer.className="dv-pre-actions-container",this.tabs=new Zi(t,e,{showTabsOverflowControl:!e.options.disableTabsOverflowList}),this.voidContainer=new Xi(this.accessor,this.group),this._element.appendChild(this.preActionsContainer),this._element.appendChild(this.tabs.element),this._element.appendChild(this.leftActionsContainer),this._element.appendChild(this.voidContainer.element),this._element.appendChild(this.rightActionsContainer),this.addDisposables(this.tabs.onDrop(i=>this._onDrop.fire(i)),this.tabs.onWillShowOverlay(i=>this._onWillShowOverlay.fire(i)),e.onDidOptionsChange(()=>{this.tabs.showTabsOverflowControl=!e.options.disableTabsOverflowList}),this.tabs.onOverflowTabsChange(i=>{this.toggleDropdown(i)}),this.tabs,this._onWillShowOverlay,this._onDrop,this._onGroupDragStart,this.voidContainer,this.voidContainer.onDragStart(i=>{this._onGroupDragStart.fire({nativeEvent:i,group:this.group})}),this.voidContainer.onDrop(i=>{this._onDrop.fire({event:i.nativeEvent,index:this.tabs.size})}),this.voidContainer.onWillShowOverlay(i=>{this._onWillShowOverlay.fire(new Ge(i,{kind:"header_space",panel:this.group.activePanel,api:this.accessor.api,group:this.group,getData:q}))}),I(this.voidContainer.element,"pointerdown",i=>{if(i.defaultPrevented)return;if(!this.accessor.options.disableFloatingGroups&&i.shiftKey&&this.group.api.location.type!=="floating"){i.preventDefault();const{top:s,left:r}=this.element.getBoundingClientRect(),{top:a,left:l}=this.accessor.element.getBoundingClientRect();this.accessor.addFloatingGroup(this.group,{x:r-l+20,y:s-a+20,inDragMode:!0})}}))}show(){this.hidden||(this.element.style.display="")}hide(){this._element.style.display="none"}setRightActionsElement(e){this.rightActions!==e&&(this.rightActions&&(this.rightActions.remove(),this.rightActions=void 0),e&&(this.rightActionsContainer.appendChild(e),this.rightActions=e))}setLeftActionsElement(e){this.leftActions!==e&&(this.leftActions&&(this.leftActions.remove(),this.leftActions=void 0),e&&(this.leftActionsContainer.appendChild(e),this.leftActions=e))}setPrefixActionsElement(e){this.preActions!==e&&(this.preActions&&(this.preActions.remove(),this.preActions=void 0),e&&(this.preActionsContainer.appendChild(e),this.preActions=e))}isActive(e){return this.tabs.isActive(e)}indexOf(e){return this.tabs.indexOf(e)}setActive(e){}delete(e){this.tabs.delete(e),this.updateClassnames()}setActivePanel(e){this.tabs.setActivePanel(e)}openPanel(e,t=this.tabs.size){this.tabs.openPanel(e,t),this.updateClassnames()}closePanel(e){this.delete(e.id)}updateClassnames(){A(this._element,"dv-single-tab",this.size===1)}toggleDropdown(e){const t=e.reset?[]:e.tabs;if(this._overflowTabs=t,this._overflowTabs.length>0&&this.dropdownPart){this.dropdownPart.update({tabs:t.length});return}if(this._overflowTabs.length===0){this._dropdownDisposable.dispose();return}const i=document.createElement("div");i.className="dv-tabs-overflow-dropdown-root";const n=Qi();n.update({tabs:t.length}),this.dropdownPart=n,i.appendChild(n.element),this.rightActionsContainer.prepend(i),this._dropdownDisposable.value=new E(N.from(()=>{var s,r;i.remove(),(r=(s=this.dropdownPart)===null||s===void 0?void 0:s.dispose)===null||r===void 0||r.call(s),this.dropdownPart=null}),I(i,"pointerdown",s=>{s.preventDefault()},{capture:!0}),I(i,"click",s=>{const r=document.createElement("div");r.style.overflow="auto",r.className="dv-tabs-overflow-container";for(const l of this.tabs.tabs.filter(h=>this._overflowTabs.includes(h.panel.id))){const h=this.group.panels.find(u=>u===l.panel),c=h.view.createTabRenderer("headerOverflow").element,m=document.createElement("div");A(m,"dv-tab",!0),A(m,"dv-active-tab",h.api.isActive),A(m,"dv-inactive-tab",!h.api.isActive),m.addEventListener("click",u=>{this.accessor.popupService.close(),!u.defaultPrevented&&(l.element.scrollIntoView(),l.panel.api.setActive())}),m.appendChild(c),r.appendChild(m)}const a=bi(i);this.accessor.popupService.openPopover(r,{x:s.clientX,y:s.clientY,zIndex:a?.style.zIndex?`calc(${a.style.zIndex} * 2)`:void 0})}))}updateDragAndDropState(){this.tabs.updateDragAndDropState(),this.voidContainer.updateDragAndDropState()}}class zt extends oi{constructor(e,t,i,n,s){super(),this.nativeEvent=e,this.target=t,this.position=i,this.getData=n,this.group=s}}function tn(o){return!!o.referencePanel}function nn(o){return!!o.referenceGroup}function sn(o){return!!o.referencePanel}function on(o){return!!o.referenceGroup}class Ke extends Je{get nativeEvent(){return this.options.nativeEvent}get position(){return this.options.position}get panel(){return this.options.panel}get group(){return this.options.group}get api(){return this.options.api}constructor(e){super(),this.options=e}getData(){return this.options.getData()}}class It extends Ke{get kind(){return this._kind}constructor(e){super(e),this._kind=e.kind}}class rn extends E{get element(){throw new Error("dockview: not supported")}get activePanel(){return this._activePanel}get locked(){return this._locked}set locked(e){this._locked=e,A(this.container,"dv-locked-groupview",e==="no-drop-target"||e)}get isActive(){return this._isGroupActive}get panels(){return this._panels}get size(){return this._panels.length}get isEmpty(){return this._panels.length===0}get hasWatermark(){return!!(this.watermark&&this.container.contains(this.watermark.element))}get header(){return this.tabsContainer}get isContentFocused(){return document.activeElement?Fe(document.activeElement,this.contentContainer.element):!1}get location(){return this._location}set location(e){switch(this._location=e,A(this.container,"dv-groupview-floating",!1),A(this.container,"dv-groupview-popout",!1),e.type){case"grid":this.contentContainer.dropTarget.setTargetZones(["top","bottom","left","right","center"]);break;case"floating":this.contentContainer.dropTarget.setTargetZones(["center"]),this.contentContainer.dropTarget.setTargetZones(e?["center"]:["top","bottom","left","right","center"]),A(this.container,"dv-groupview-floating",!0);break;case"popout":this.contentContainer.dropTarget.setTargetZones(["center"]),A(this.container,"dv-groupview-popout",!0);break}this.groupPanel.api._onDidLocationChange.fire({location:this.location})}constructor(e,t,i,n,s){var r;super(),this.container=e,this.accessor=t,this.id=i,this.options=n,this.groupPanel=s,this._isGroupActive=!1,this._locked=!1,this._location={type:"grid"},this.mostRecentlyUsed=[],this._overwriteRenderContainer=null,this._overwriteDropTargetContainer=null,this._onDidChange=new f,this.onDidChange=this._onDidChange.event,this._width=0,this._height=0,this._panels=[],this._panelDisposables=new Map,this._onMove=new f,this.onMove=this._onMove.event,this._onDidDrop=new f,this.onDidDrop=this._onDidDrop.event,this._onWillDrop=new f,this.onWillDrop=this._onWillDrop.event,this._onWillShowOverlay=new f,this.onWillShowOverlay=this._onWillShowOverlay.event,this._onTabDragStart=new f,this.onTabDragStart=this._onTabDragStart.event,this._onGroupDragStart=new f,this.onGroupDragStart=this._onGroupDragStart.event,this._onDidAddPanel=new f,this.onDidAddPanel=this._onDidAddPanel.event,this._onDidPanelTitleChange=new f,this.onDidPanelTitleChange=this._onDidPanelTitleChange.event,this._onDidPanelParametersChange=new f,this.onDidPanelParametersChange=this._onDidPanelParametersChange.event,this._onDidRemovePanel=new f,this.onDidRemovePanel=this._onDidRemovePanel.event,this._onDidActivePanelChange=new f,this.onDidActivePanelChange=this._onDidActivePanelChange.event,this._onUnhandledDragOverEvent=new f,this.onUnhandledDragOverEvent=this._onUnhandledDragOverEvent.event,A(this.container,"dv-groupview",!0),this._api=new Pe(this.accessor),this.tabsContainer=new en(this.accessor,this.groupPanel),this.contentContainer=new ji(this.accessor,this),e.append(this.tabsContainer.element,this.contentContainer.element),this.header.hidden=!!n.hideHeader,this.locked=(r=n.locked)!==null&&r!==void 0?r:!1,this.addDisposables(this._onTabDragStart,this._onGroupDragStart,this._onWillShowOverlay,this.tabsContainer.onTabDragStart(a=>{this._onTabDragStart.fire(a)}),this.tabsContainer.onGroupDragStart(a=>{this._onGroupDragStart.fire(a)}),this.tabsContainer.onDrop(a=>{this.handleDropEvent("header",a.event,"center",a.index)}),this.contentContainer.onDidFocus(()=>{this.accessor.doSetGroupActive(this.groupPanel)}),this.contentContainer.onDidBlur(()=>{}),this.contentContainer.dropTarget.onDrop(a=>{this.handleDropEvent("content",a.nativeEvent,a.position)}),this.tabsContainer.onWillShowOverlay(a=>{this._onWillShowOverlay.fire(a)}),this.contentContainer.dropTarget.onWillShowOverlay(a=>{this._onWillShowOverlay.fire(new Ge(a,{kind:"content",panel:this.activePanel,api:this._api,group:this.groupPanel,getData:q}))}),this._onMove,this._onDidChange,this._onDidDrop,this._onWillDrop,this._onDidAddPanel,this._onDidRemovePanel,this._onDidActivePanelChange,this._onUnhandledDragOverEvent,this._onDidPanelTitleChange,this._onDidPanelParametersChange)}focusContent(){this.contentContainer.element.focus()}set renderContainer(e){this.panels.forEach(t=>{this.renderContainer.detatch(t)}),this._overwriteRenderContainer=e,this.panels.forEach(t=>{this.rerender(t)})}get renderContainer(){var e;return(e=this._overwriteRenderContainer)!==null&&e!==void 0?e:this.accessor.overlayRenderContainer}set dropTargetContainer(e){this._overwriteDropTargetContainer=e}get dropTargetContainer(){var e;return(e=this._overwriteDropTargetContainer)!==null&&e!==void 0?e:this.accessor.rootDropTargetContainer}initialize(){this.options.panels&&this.options.panels.forEach(e=>{this.doAddPanel(e)}),this.options.activePanel&&this.openPanel(this.options.activePanel),this.setActive(this.isActive,!0),this.updateContainer(),this.accessor.options.createRightHeaderActionComponent&&(this._rightHeaderActions=this.accessor.options.createRightHeaderActionComponent(this.groupPanel),this.addDisposables(this._rightHeaderActions),this._rightHeaderActions.init({containerApi:this._api,api:this.groupPanel.api,group:this.groupPanel}),this.tabsContainer.setRightActionsElement(this._rightHeaderActions.element)),this.accessor.options.createLeftHeaderActionComponent&&(this._leftHeaderActions=this.accessor.options.createLeftHeaderActionComponent(this.groupPanel),this.addDisposables(this._leftHeaderActions),this._leftHeaderActions.init({containerApi:this._api,api:this.groupPanel.api,group:this.groupPanel}),this.tabsContainer.setLeftActionsElement(this._leftHeaderActions.element)),this.accessor.options.createPrefixHeaderActionComponent&&(this._prefixHeaderActions=this.accessor.options.createPrefixHeaderActionComponent(this.groupPanel),this.addDisposables(this._prefixHeaderActions),this._prefixHeaderActions.init({containerApi:this._api,api:this.groupPanel.api,group:this.groupPanel}),this.tabsContainer.setPrefixActionsElement(this._prefixHeaderActions.element))}rerender(e){this.contentContainer.renderPanel(e,{asActive:!1})}indexOf(e){return this.tabsContainer.indexOf(e.id)}toJSON(){var e;const t={views:this.tabsContainer.panels,activeView:(e=this._activePanel)===null||e===void 0?void 0:e.id,id:this.id};return this.locked!==!1&&(t.locked=this.locked),this.header.hidden&&(t.hideHeader=!0),t}moveToNext(e){e||(e={}),e.panel||(e.panel=this.activePanel);const t=e.panel?this.panels.indexOf(e.panel):-1;let i;if(t<this.panels.length-1)i=t+1;else if(!e.suppressRoll)i=0;else return;this.openPanel(this.panels[i])}moveToPrevious(e){if(e||(e={}),e.panel||(e.panel=this.activePanel),!e.panel)return;const t=this.panels.indexOf(e.panel);let i;if(t>0)i=t-1;else if(!e.suppressRoll)i=this.panels.length-1;else return;this.openPanel(this.panels[i])}containsPanel(e){return this.panels.includes(e)}init(e){}update(e){}focus(){var e;(e=this._activePanel)===null||e===void 0||e.focus()}openPanel(e,t={}){(typeof t.index!="number"||t.index>this.panels.length)&&(t.index=this.panels.length);const i=!!t.skipSetActive;if(e.updateParentGroup(this.groupPanel,{skipSetActive:t.skipSetActive}),this.doAddPanel(e,t.index,{skipSetActive:i}),this._activePanel===e){this.contentContainer.renderPanel(e,{asActive:!0});return}i||this.doSetActivePanel(e),t.skipSetGroupActive||this.accessor.doSetGroupActive(this.groupPanel),t.skipSetActive||this.updateContainer()}removePanel(e,t={skipSetActive:!1}){const i=typeof e=="string"?e:e.id,n=this._panels.find(s=>s.id===i);if(!n)throw new Error("invalid operation");return this._removePanel(n,t)}closeAllPanels(){if(this.panels.length>0){const e=[...this.panels];for(const t of e)this.doClose(t)}else this.accessor.removeGroup(this.groupPanel)}closePanel(e){this.doClose(e)}doClose(e){const t=this.panels.length===1&&this.accessor.groups.length===1;this.accessor.removePanel(e,t&&this.accessor.options.noPanelsOverlay==="emptyGroup"?{removeEmptyGroup:!1}:void 0)}isPanelActive(e){return this._activePanel===e}updateActions(e){this.tabsContainer.setRightActionsElement(e)}setActive(e,t=!1){!t&&this.isActive===e||(this._isGroupActive=e,A(this.container,"dv-active-group",e),A(this.container,"dv-inactive-group",!e),this.tabsContainer.setActive(this.isActive),!this._activePanel&&this.panels.length>0&&this.doSetActivePanel(this.panels[0]),this.updateContainer())}layout(e,t){var i;this._width=e,this._height=t,this.contentContainer.layout(this._width,this._height),!((i=this._activePanel)===null||i===void 0)&&i.layout&&this._activePanel.layout(this._width,this._height)}_removePanel(e,t){const i=this._activePanel===e;if(this.doRemovePanel(e),i&&this.panels.length>0){const n=this.mostRecentlyUsed[0];this.openPanel(n,{skipSetActive:t.skipSetActive,skipSetGroupActive:t.skipSetActiveGroup})}return this._activePanel&&this.panels.length===0&&this.doSetActivePanel(void 0),t.skipSetActive||this.updateContainer(),e}doRemovePanel(e){const t=this.panels.indexOf(e);if(this._activePanel===e&&this.contentContainer.closePanel(),this.tabsContainer.delete(e.id),this._panels.splice(t,1),this.mostRecentlyUsed.includes(e)){const n=this.mostRecentlyUsed.indexOf(e);this.mostRecentlyUsed.splice(n,1)}const i=this._panelDisposables.get(e.id);i&&(i.dispose(),this._panelDisposables.delete(e.id)),this._onDidRemovePanel.fire({panel:e})}doAddPanel(e,t=this.panels.length,i={skipSetActive:!1}){const s=this._panels.indexOf(e)>-1;this.tabsContainer.show(),this.contentContainer.show(),this.tabsContainer.openPanel(e,t),i.skipSetActive||this.contentContainer.openPanel(e),!s&&(this.updateMru(e),this.panels.splice(t,0,e),this._panelDisposables.set(e.id,new E(e.api.onDidTitleChange(r=>this._onDidPanelTitleChange.fire(r)),e.api.onDidParametersChange(r=>this._onDidPanelParametersChange.fire(r)))),this._onDidAddPanel.fire({panel:e}))}doSetActivePanel(e){this._activePanel!==e&&(this._activePanel=e,e&&(this.tabsContainer.setActivePanel(e),e.layout(this._width,this._height),this.updateMru(e),this._onDidActivePanelChange.fire({panel:e})))}updateMru(e){this.mostRecentlyUsed.includes(e)&&this.mostRecentlyUsed.splice(this.mostRecentlyUsed.indexOf(e),1),this.mostRecentlyUsed=[e,...this.mostRecentlyUsed]}updateContainer(){var e,t;if(this.panels.forEach(i=>i.runEvents()),this.isEmpty&&!this.watermark){const i=this.accessor.createWatermarkComponent();i.init({containerApi:this._api,group:this.groupPanel}),this.watermark=i,I(this.watermark.element,"pointerdown",()=>{this.isActive||this.accessor.doSetGroupActive(this.groupPanel)}),this.contentContainer.element.appendChild(this.watermark.element)}!this.isEmpty&&this.watermark&&(this.watermark.element.remove(),(t=(e=this.watermark).dispose)===null||t===void 0||t.call(e),this.watermark=void 0)}canDisplayOverlay(e,t,i){const n=new zt(e,i,t,q,this.accessor.getPanel(this.id));return this._onUnhandledDragOverEvent.fire(n),n.isAccepted}handleDropEvent(e,t,i,n){if(this.locked==="no-drop-target")return;function s(){switch(e){case"header":return typeof n=="number"?"tab":"header_space";case"content":return"content"}}const r=typeof n=="number"?this.panels[n]:void 0,a=new It({nativeEvent:t,position:i,panel:r,getData:()=>q(),kind:s(),group:this.groupPanel,api:this._api});if(this._onWillDrop.fire(a),a.defaultPrevented)return;const l=q();if(l&&l.viewId===this.accessor.id){if(e==="content"&&l.groupId===this.id&&(i==="center"||l.panelId===null)||e==="header"&&l.groupId===this.id&&l.panelId===null)return;if(l.panelId===null){const{groupId:u}=l;this._onMove.fire({target:i,groupId:u,index:n});return}if(this.tabsContainer.indexOf(l.panelId)!==-1&&this.tabsContainer.size===1)return;const{groupId:d,panelId:c}=l;if(this.id===d&&!i&&this.tabsContainer.indexOf(c)===n)return;this._onMove.fire({target:i,groupId:l.groupId,itemId:l.panelId,index:n})}else this._onDidDrop.fire(new Ke({nativeEvent:t,position:i,panel:r,getData:()=>q(),group:this.groupPanel,api:this._api}))}updateDragAndDropState(){this.tabsContainer.updateDragAndDropState()}dispose(){var e,t,i;super.dispose(),(e=this.watermark)===null||e===void 0||e.element.remove(),(i=(t=this.watermark)===null||t===void 0?void 0:t.dispose)===null||i===void 0||i.call(t),this.watermark=void 0;for(const n of this.panels)n.dispose();this.tabsContainer.dispose(),this.contentContainer.dispose()}}class Qe extends Ui{constructor(e,t,i){super(e,t),this._onDidConstraintsChangeInternal=new f,this.onDidConstraintsChangeInternal=this._onDidConstraintsChangeInternal.event,this._onDidConstraintsChange=new f,this.onDidConstraintsChange=this._onDidConstraintsChange.event,this._onDidSizeChange=new f,this.onDidSizeChange=this._onDidSizeChange.event,this.addDisposables(this._onDidConstraintsChangeInternal,this._onDidConstraintsChange,this._onDidSizeChange),i&&this.initialize(i)}setConstraints(e){this._onDidConstraintsChangeInternal.fire(e)}setSize(e){this._onDidSizeChange.fire(e)}}class an extends Fi{get priority(){return this._priority}get snap(){return this._snap}get minimumWidth(){return this.__minimumWidth()}get minimumHeight(){return this.__minimumHeight()}get maximumHeight(){return this.__maximumHeight()}get maximumWidth(){return this.__maximumWidth()}__minimumWidth(){const e=typeof this._minimumWidth=="function"?this._minimumWidth():this._minimumWidth;return e!==this._evaluatedMinimumWidth&&(this._evaluatedMinimumWidth=e,this.updateConstraints()),e}__maximumWidth(){const e=typeof this._maximumWidth=="function"?this._maximumWidth():this._maximumWidth;return e!==this._evaluatedMaximumWidth&&(this._evaluatedMaximumWidth=e,this.updateConstraints()),e}__minimumHeight(){const e=typeof this._minimumHeight=="function"?this._minimumHeight():this._minimumHeight;return e!==this._evaluatedMinimumHeight&&(this._evaluatedMinimumHeight=e,this.updateConstraints()),e}__maximumHeight(){const e=typeof this._maximumHeight=="function"?this._maximumHeight():this._maximumHeight;return e!==this._evaluatedMaximumHeight&&(this._evaluatedMaximumHeight=e,this.updateConstraints()),e}get isActive(){return this.api.isActive}get isVisible(){return this.api.isVisible}constructor(e,t,i,n){super(e,t,n??new Qe(e,t)),this._evaluatedMinimumWidth=0,this._evaluatedMaximumWidth=Number.MAX_SAFE_INTEGER,this._evaluatedMinimumHeight=0,this._evaluatedMaximumHeight=Number.MAX_SAFE_INTEGER,this._minimumWidth=0,this._minimumHeight=0,this._maximumWidth=Number.MAX_SAFE_INTEGER,this._maximumHeight=Number.MAX_SAFE_INTEGER,this._snap=!1,this._onDidChange=new f,this.onDidChange=this._onDidChange.event,typeof i?.minimumWidth=="number"&&(this._minimumWidth=i.minimumWidth),typeof i?.maximumWidth=="number"&&(this._maximumWidth=i.maximumWidth),typeof i?.minimumHeight=="number"&&(this._minimumHeight=i.minimumHeight),typeof i?.maximumHeight=="number"&&(this._maximumHeight=i.maximumHeight),this.api.initialize(this),this.addDisposables(this.api.onWillVisibilityChange(s=>{const{isVisible:r}=s,{accessor:a}=this._params;a.setVisible(this,r)}),this.api.onActiveChange(()=>{const{accessor:s}=this._params;s.doSetGroupActive(this)}),this.api.onDidConstraintsChangeInternal(s=>{(typeof s.minimumWidth=="number"||typeof s.minimumWidth=="function")&&(this._minimumWidth=s.minimumWidth),(typeof s.minimumHeight=="number"||typeof s.minimumHeight=="function")&&(this._minimumHeight=s.minimumHeight),(typeof s.maximumWidth=="number"||typeof s.maximumWidth=="function")&&(this._maximumWidth=s.maximumWidth),(typeof s.maximumHeight=="number"||typeof s.maximumHeight=="function")&&(this._maximumHeight=s.maximumHeight)}),this.api.onDidSizeChange(s=>{this._onDidChange.fire({height:s.height,width:s.width})}),this._onDidChange)}setVisible(e){this.api._onDidVisibilityChange.fire({isVisible:e})}setActive(e){this.api._onDidActiveChange.fire({isActive:e})}init(e){e.maximumHeight&&(this._maximumHeight=e.maximumHeight),e.minimumHeight&&(this._minimumHeight=e.minimumHeight),e.maximumWidth&&(this._maximumWidth=e.maximumWidth),e.minimumWidth&&(this._minimumWidth=e.minimumWidth),this._priority=e.priority,this._snap=!!e.snap,super.init(e),typeof e.isVisible=="boolean"&&this.setVisible(e.isVisible)}updateConstraints(){this.api._onDidConstraintsChange.fire({minimumWidth:this._evaluatedMinimumWidth,maximumWidth:this._evaluatedMaximumWidth,minimumHeight:this._evaluatedMinimumHeight,maximumHeight:this._evaluatedMaximumHeight})}toJSON(){const e=super.toJSON(),t=n=>n===Number.MAX_SAFE_INTEGER?void 0:n,i=n=>n<=0?void 0:n;return Object.assign(Object.assign({},e),{minimumHeight:i(this.minimumHeight),maximumHeight:t(this.maximumHeight),minimumWidth:i(this.minimumWidth),maximumWidth:t(this.maximumWidth),snap:this.snap,priority:this.priority})}}const fe="dockview: DockviewGroupPanelApiImpl not initialized";class ln extends Qe{get location(){if(!this._group)throw new Error(fe);return this._group.model.location}constructor(e,t){super(e,"__dockviewgroup__"),this.accessor=t,this._onDidLocationChange=new f,this.onDidLocationChange=this._onDidLocationChange.event,this._onDidActivePanelChange=new f,this.onDidActivePanelChange=this._onDidActivePanelChange.event,this.addDisposables(this._onDidLocationChange,this._onDidActivePanelChange)}close(){if(this._group)return this.accessor.removeGroup(this._group)}getWindow(){return this.location.type==="popout"?this.location.getWindow():window}moveTo(e){var t,i,n,s;if(!this._group)throw new Error(fe);const r=(t=e.group)!==null&&t!==void 0?t:this.accessor.addGroup({direction:ki((i=e.position)!==null&&i!==void 0?i:"right"),skipSetActive:(n=e.skipSetActive)!==null&&n!==void 0?n:!1});this.accessor.moveGroupOrPanel({from:{groupId:this._group.id},to:{group:r,position:e.group&&(s=e.position)!==null&&s!==void 0?s:"center",index:e.index},skipSetActive:e.skipSetActive})}maximize(){if(!this._group)throw new Error(fe);this.location.type==="grid"&&this.accessor.maximizeGroup(this._group)}isMaximized(){if(!this._group)throw new Error(fe);return this.accessor.isMaximizedGroup(this._group)}exitMaximized(){if(!this._group)throw new Error(fe);this.isMaximized()&&this.accessor.exitMaximizedGroup()}initialize(e){this._group=e}}const hn=100,dn=100;class ht extends an{get minimumWidth(){var e;if(typeof this._explicitConstraints.minimumWidth=="number")return this._explicitConstraints.minimumWidth;const t=(e=this.activePanel)===null||e===void 0?void 0:e.minimumWidth;return typeof t=="number"?t:super.__minimumWidth()}get minimumHeight(){var e;if(typeof this._explicitConstraints.minimumHeight=="number")return this._explicitConstraints.minimumHeight;const t=(e=this.activePanel)===null||e===void 0?void 0:e.minimumHeight;return typeof t=="number"?t:super.__minimumHeight()}get maximumWidth(){var e;if(typeof this._explicitConstraints.maximumWidth=="number")return this._explicitConstraints.maximumWidth;const t=(e=this.activePanel)===null||e===void 0?void 0:e.maximumWidth;return typeof t=="number"?t:super.__maximumWidth()}get maximumHeight(){var e;if(typeof this._explicitConstraints.maximumHeight=="number")return this._explicitConstraints.maximumHeight;const t=(e=this.activePanel)===null||e===void 0?void 0:e.maximumHeight;return typeof t=="number"?t:super.__maximumHeight()}get panels(){return this._model.panels}get activePanel(){return this._model.activePanel}get size(){return this._model.size}get model(){return this._model}get locked(){return this._model.locked}set locked(e){this._model.locked=e}get header(){return this._model.header}constructor(e,t,i){var n,s,r,a,l,h;super(t,"groupview_default",{minimumHeight:(s=(n=i.constraints)===null||n===void 0?void 0:n.minimumHeight)!==null&&s!==void 0?s:dn,minimumWidth:(a=(r=i.constraints)===null||r===void 0?void 0:r.minimumWidth)!==null&&a!==void 0?a:hn,maximumHeight:(l=i.constraints)===null||l===void 0?void 0:l.maximumHeight,maximumWidth:(h=i.constraints)===null||h===void 0?void 0:h.maximumWidth},new ln(t,e)),this._explicitConstraints={},this.api.initialize(this),this._model=new rn(this.element,e,t,i,this),this.addDisposables(this.model.onDidActivePanelChange(d=>{this.api._onDidActivePanelChange.fire(d)}),this.api.onDidConstraintsChangeInternal(d=>{d.minimumWidth!==void 0&&(this._explicitConstraints.minimumWidth=typeof d.minimumWidth=="function"?d.minimumWidth():d.minimumWidth),d.minimumHeight!==void 0&&(this._explicitConstraints.minimumHeight=typeof d.minimumHeight=="function"?d.minimumHeight():d.minimumHeight),d.maximumWidth!==void 0&&(this._explicitConstraints.maximumWidth=typeof d.maximumWidth=="function"?d.maximumWidth():d.maximumWidth),d.maximumHeight!==void 0&&(this._explicitConstraints.maximumHeight=typeof d.maximumHeight=="function"?d.maximumHeight():d.maximumHeight)}))}focus(){this.api.isActive||this.api.setActive(),super.focus()}initialize(){this._model.initialize()}setActive(e){super.setActive(e),this.model.setActive(e)}layout(e,t){super.layout(e,t),this.model.layout(e,t)}getComponent(){return this._model}toJSON(){return this.model.toJSON()}}const cn={name:"dark",className:"dockview-theme-dark"},un={className:"dockview-theme-abyss"};class pn extends Qe{get location(){return this.group.api.location}get title(){return this.panel.title}get isGroupActive(){return this.group.isActive}get renderer(){return this.panel.renderer}set group(e){const t=this._group;this._group!==e&&(this._group=e,this._onDidGroupChange.fire({}),this.setupGroupEventListeners(t),this._onDidLocationChange.fire({location:this.group.api.location}))}get group(){return this._group}get tabComponent(){return this._tabComponent}constructor(e,t,i,n,s){super(e.id,n),this.panel=e,this.accessor=i,this._onDidTitleChange=new f,this.onDidTitleChange=this._onDidTitleChange.event,this._onDidActiveGroupChange=new f,this.onDidActiveGroupChange=this._onDidActiveGroupChange.event,this._onDidGroupChange=new f,this.onDidGroupChange=this._onDidGroupChange.event,this._onDidRendererChange=new f,this.onDidRendererChange=this._onDidRendererChange.event,this._onDidLocationChange=new f,this.onDidLocationChange=this._onDidLocationChange.event,this.groupEventsDisposable=new Z,this._tabComponent=s,this.initialize(e),this._group=t,this.setupGroupEventListeners(),this.addDisposables(this.groupEventsDisposable,this._onDidRendererChange,this._onDidTitleChange,this._onDidGroupChange,this._onDidActiveGroupChange,this._onDidLocationChange)}getWindow(){return this.group.api.getWindow()}moveTo(e){var t,i;this.accessor.moveGroupOrPanel({from:{groupId:this._group.id,panelId:this.panel.id},to:{group:(t=e.group)!==null&&t!==void 0?t:this._group,position:e.group&&(i=e.position)!==null&&i!==void 0?i:"center",index:e.index},skipSetActive:e.skipSetActive})}setTitle(e){this.panel.setTitle(e)}setRenderer(e){this.panel.setRenderer(e)}close(){this.group.model.closePanel(this.panel)}maximize(){this.group.api.maximize()}isMaximized(){return this.group.api.isMaximized()}exitMaximized(){this.group.api.exitMaximized()}setupGroupEventListeners(e){var t;let i=(t=e?.isActive)!==null&&t!==void 0?t:!1;this.groupEventsDisposable.value=new E(this.group.api.onDidVisibilityChange(n=>{const s=!n.isVisible&&this.isVisible,r=n.isVisible&&!this.isVisible,a=this.group.model.isPanelActive(this.panel);(s||r&&a)&&this._onDidVisibilityChange.fire(n)}),this.group.api.onDidLocationChange(n=>{this.group===this.panel.group&&this._onDidLocationChange.fire(n)}),this.group.api.onDidActiveChange(()=>{this.group===this.panel.group&&i!==this.isGroupActive&&(i=this.isGroupActive,this._onDidActiveGroupChange.fire({isActive:this.isGroupActive}))}))}}class pe extends E{get params(){return this._params}get title(){return this._title}get group(){return this._group}get renderer(){var e;return(e=this._renderer)!==null&&e!==void 0?e:this.accessor.renderer}get minimumWidth(){return this._minimumWidth}get minimumHeight(){return this._minimumHeight}get maximumWidth(){return this._maximumWidth}get maximumHeight(){return this._maximumHeight}constructor(e,t,i,n,s,r,a,l){super(),this.id=e,this.accessor=n,this.containerApi=s,this.view=a,this._renderer=l.renderer,this._group=r,this._minimumWidth=l.minimumWidth,this._minimumHeight=l.minimumHeight,this._maximumWidth=l.maximumWidth,this._maximumHeight=l.maximumHeight,this.api=new pn(this,this._group,n,t,i),this.addDisposables(this.api.onActiveChange(()=>{n.setActivePanel(this)}),this.api.onDidSizeChange(h=>{this.group.api.setSize(h)}),this.api.onDidRendererChange(()=>{this.group.model.rerender(this)}))}init(e){this._params=e.params,this.view.init(Object.assign(Object.assign({},e),{api:this.api,containerApi:this.containerApi})),this.setTitle(e.title)}focus(){const e=new St;this.api._onWillFocus.fire(e),!e.defaultPrevented&&(this.api.isActive||this.api.setActive())}toJSON(){return{id:this.id,contentComponent:this.view.contentComponent,tabComponent:this.view.tabComponent,params:Object.keys(this._params||{}).length>0?this._params:void 0,title:this.title,renderer:this._renderer,minimumHeight:this._minimumHeight,maximumHeight:this._maximumHeight,minimumWidth:this._minimumWidth,maximumWidth:this._maximumWidth}}setTitle(e){e!==this.title&&(this._title=e,this.api._onDidTitleChange.fire({title:e}))}setRenderer(e){e!==this.renderer&&(this._renderer=e,this.api._onDidRendererChange.fire({renderer:e}))}update(e){var t;this._params=Object.assign(Object.assign({},(t=this._params)!==null&&t!==void 0?t:{}),e.params);for(const i of Object.keys(e.params))e.params[i]===void 0&&delete this._params[i];this.view.update({params:this._params})}updateParentGroup(e,t){this._group=e,this.api.group=this._group;const i=this._group.model.isPanelActive(this),n=this.group.api.isActive&&i;t?.skipSetActive||this.api.isActive!==n&&this.api._onDidActiveChange.fire({isActive:this.group.api.isActive&&i}),this.api.isVisible!==i&&this.api._onDidVisibilityChange.fire({isVisible:i})}runEvents(){const e=this._group.model.isPanelActive(this),t=this.group.api.isActive&&e;this.api.isActive!==t&&this.api._onDidActiveChange.fire({isActive:this.group.api.isActive&&e}),this.api.isVisible!==e&&this.api._onDidVisibilityChange.fire({isVisible:e})}layout(e,t){this.api._onDidDimensionChange.fire({width:e,height:t}),this.view.layout(e,t)}dispose(){this.api.dispose(),this.view.dispose()}}let dt=class extends E{get element(){return this._element}constructor(){super(),this._element=document.createElement("div"),this._element.className="dv-default-tab",this._content=document.createElement("div"),this._content.className="dv-default-tab-content",this.action=document.createElement("div"),this.action.className="dv-default-tab-action",this.action.appendChild(Ji()),this._element.appendChild(this._content),this._element.appendChild(this.action),this.render()}init(e){this._title=e.title,this.addDisposables(e.api.onDidTitleChange(t=>{this._title=t.title,this.render()}),I(this.action,"pointerdown",t=>{t.preventDefault()}),I(this.action,"click",t=>{t.defaultPrevented||(t.preventDefault(),e.api.close())})),this.render()}render(){var e;this._content.textContent!==this._title&&(this._content.textContent=(e=this._title)!==null&&e!==void 0?e:"")}};class Gt{get content(){return this._content}get tab(){return this._tab}constructor(e,t,i,n){this.accessor=e,this.id=t,this.contentComponent=i,this.tabComponent=n,this._content=this.createContentComponent(this.id,i),this._tab=this.createTabComponent(this.id,n)}createTabRenderer(e){var t;const i=this.createTabComponent(this.id,this.tabComponent);return this._params&&i.init(Object.assign(Object.assign({},this._params),{tabLocation:e})),this._updateEvent&&((t=i.update)===null||t===void 0||t.call(i,this._updateEvent)),i}init(e){this._params=e,this.content.init(e),this.tab.init(Object.assign(Object.assign({},e),{tabLocation:"header"}))}layout(e,t){var i,n;(n=(i=this.content).layout)===null||n===void 0||n.call(i,e,t)}update(e){var t,i,n,s;this._updateEvent=e,(i=(t=this.content).update)===null||i===void 0||i.call(t,e),(s=(n=this.tab).update)===null||s===void 0||s.call(n,e)}dispose(){var e,t,i,n;(t=(e=this.content).dispose)===null||t===void 0||t.call(e),(n=(i=this.tab).dispose)===null||n===void 0||n.call(i)}createContentComponent(e,t){return this.accessor.options.createComponent({id:e,name:t})}createTabComponent(e,t){const i=t??this.accessor.options.defaultTabComponent;if(i){if(this.accessor.options.createTabComponent){const n=this.accessor.options.createTabComponent({id:e,name:i});return n||new dt}console.warn(`dockview: tabComponent '${t}' was not found. falling back to the default tab.`)}return new dt}}class mn{constructor(e){this.accessor=e}fromJSON(e,t){var i,n;const s=e.id,r=e.params,a=e.title,l=e.view,h=l?l.content.id:(i=e.contentComponent)!==null&&i!==void 0?i:"unknown",d=l?(n=l.tab)===null||n===void 0?void 0:n.id:e.tabComponent,c=new Gt(this.accessor,s,h,d),m=new pe(s,h,d,this.accessor,new Pe(this.accessor),t,c,{renderer:e.renderer,minimumWidth:e.minimumWidth,minimumHeight:e.minimumHeight,maximumWidth:e.maximumWidth,maximumHeight:e.maximumHeight});return m.init({title:a??s,params:r??{}}),m}}class fn extends E{get element(){return this._element}constructor(){super(),this._element=document.createElement("div"),this._element.className="dv-watermark"}init(e){}}class gn{constructor(){this._orderedList=[]}push(e){this._orderedList=[...this._orderedList.filter(t=>t!==e),e],this.update()}destroy(e){this._orderedList=this._orderedList.filter(t=>t!==e),this.update()}update(){for(let e=0;e<this._orderedList.length;e++)this._orderedList[e].setAttribute("aria-level",`${e}`),this._orderedList[e].style.zIndex=`calc(var(--dv-overlay-z-index, 999) + ${e*2})`}}const be=new gn;class oe extends E{set minimumInViewportWidth(e){this.options.minimumInViewportWidth=e}set minimumInViewportHeight(e){this.options.minimumInViewportHeight=e}get element(){return this._element}get isVisible(){return this._isVisible}constructor(e){super(),this.options=e,this._element=document.createElement("div"),this._onDidChange=new f,this.onDidChange=this._onDidChange.event,this._onDidChangeEnd=new f,this.onDidChangeEnd=this._onDidChangeEnd.event,this.addDisposables(this._onDidChange,this._onDidChangeEnd),this._element.className="dv-resize-container",this._isVisible=!0,this.setupResize("top"),this.setupResize("bottom"),this.setupResize("left"),this.setupResize("right"),this.setupResize("topleft"),this.setupResize("topright"),this.setupResize("bottomleft"),this.setupResize("bottomright"),this._element.appendChild(this.options.content),this.options.container.appendChild(this._element),this.setBounds(Object.assign(Object.assign(Object.assign(Object.assign({height:this.options.height,width:this.options.width},"top"in this.options&&{top:this.options.top}),"bottom"in this.options&&{bottom:this.options.bottom}),"left"in this.options&&{left:this.options.left}),"right"in this.options&&{right:this.options.right})),be.push(this._element)}setVisible(e){e!==this.isVisible&&(this._isVisible=e,A(this.element,"dv-hidden",!this.isVisible))}bringToFront(){be.push(this._element)}setBounds(e={}){typeof e.height=="number"&&(this._element.style.height=`${e.height}px`),typeof e.width=="number"&&(this._element.style.width=`${e.width}px`),"top"in e&&typeof e.top=="number"&&(this._element.style.top=`${e.top}px`,this._element.style.bottom="auto",this.verticalAlignment="top"),"bottom"in e&&typeof e.bottom=="number"&&(this._element.style.bottom=`${e.bottom}px`,this._element.style.top="auto",this.verticalAlignment="bottom"),"left"in e&&typeof e.left=="number"&&(this._element.style.left=`${e.left}px`,this._element.style.right="auto",this.horiziontalAlignment="left"),"right"in e&&typeof e.right=="number"&&(this._element.style.right=`${e.right}px`,this._element.style.left="auto",this.horiziontalAlignment="right");const t=this.options.container.getBoundingClientRect(),i=this._element.getBoundingClientRect(),n=Math.max(0,this.getMinimumWidth(i.width)),s=Math.max(0,this.getMinimumHeight(i.height));if(this.verticalAlignment==="top"){const r=M(i.top-t.top,-s,Math.max(0,t.height-i.height+s));this._element.style.top=`${r}px`,this._element.style.bottom="auto"}if(this.verticalAlignment==="bottom"){const r=M(t.bottom-i.bottom,-s,Math.max(0,t.height-i.height+s));this._element.style.bottom=`${r}px`,this._element.style.top="auto"}if(this.horiziontalAlignment==="left"){const r=M(i.left-t.left,-n,Math.max(0,t.width-i.width+n));this._element.style.left=`${r}px`,this._element.style.right="auto"}if(this.horiziontalAlignment==="right"){const r=M(t.right-i.right,-n,Math.max(0,t.width-i.width+n));this._element.style.right=`${r}px`,this._element.style.left="auto"}this._onDidChange.fire()}toJSON(){const e=this.options.container.getBoundingClientRect(),t=this._element.getBoundingClientRect(),i={};return this.verticalAlignment==="top"?i.top=parseFloat(this._element.style.top):this.verticalAlignment==="bottom"?i.bottom=parseFloat(this._element.style.bottom):i.top=t.top-e.top,this.horiziontalAlignment==="left"?i.left=parseFloat(this._element.style.left):this.horiziontalAlignment==="right"?i.right=parseFloat(this._element.style.right):i.left=t.left-e.left,i.width=t.width,i.height=t.height,i}setupDrag(e,t={inDragMode:!1}){const i=new Z,n=()=>{let s=null;const r=Se();i.value=new E({dispose:()=>{r.release()}},I(window,"pointermove",a=>{const l=this.options.container.getBoundingClientRect(),h=a.clientX-l.left,d=a.clientY-l.top;A(this._element,"dv-resize-container-dragging",!0);const c=this._element.getBoundingClientRect();s===null&&(s={x:a.clientX-c.left,y:a.clientY-c.top});const m=Math.max(0,this.getMinimumWidth(c.width)),u=Math.max(0,this.getMinimumHeight(c.height)),_=M(d-s.y,-u,Math.max(0,l.height-c.height+u)),p=M(s.y-d+l.height-c.height,-u,Math.max(0,l.height-c.height+u)),g=M(h-s.x,-m,Math.max(0,l.width-c.width+m)),b=M(s.x-h+l.width-c.width,-m,Math.max(0,l.width-c.width+m)),y={};_<=p?y.top=_:y.bottom=p,g<=b?y.left=g:y.right=b,this.setBounds(y)}),I(window,"pointerup",()=>{A(this._element,"dv-resize-container-dragging",!1),i.dispose(),this._onDidChangeEnd.fire()}))};this.addDisposables(i,I(e,"pointerdown",s=>{if(s.defaultPrevented){s.preventDefault();return}ot(s)||n()}),I(this.options.content,"pointerdown",s=>{s.defaultPrevented||ot(s)||s.shiftKey&&n()}),I(this.options.content,"pointerdown",()=>{be.push(this._element)},!0)),t.inDragMode&&n()}setupResize(e){const t=document.createElement("div");t.className=`dv-resize-handle-${e}`,this._element.appendChild(t);const i=new Z;this.addDisposables(i,I(t,"pointerdown",n=>{n.preventDefault();let s=null;const r=Se();i.value=new E(I(window,"pointermove",a=>{const l=this.options.container.getBoundingClientRect(),h=this._element.getBoundingClientRect(),d=a.clientY-l.top,c=a.clientX-l.left;s===null&&(s={originalY:d,originalHeight:h.height,originalX:c,originalWidth:h.width});let m,u,_,p,g,b;const y=()=>{m=M(d,-Number.MAX_VALUE,s.originalY+s.originalHeight>l.height?this.getMinimumHeight(l.height):Math.max(0,s.originalY+s.originalHeight-oe.MINIMUM_HEIGHT)),_=s.originalY+s.originalHeight-m,u=l.height-m-_},D=()=>{m=s.originalY-s.originalHeight,_=M(d-m,m<0&&typeof this.options.minimumInViewportHeight=="number"?-m+this.options.minimumInViewportHeight:oe.MINIMUM_HEIGHT,Number.MAX_VALUE),u=l.height-m-_},v=()=>{p=M(c,-Number.MAX_VALUE,s.originalX+s.originalWidth>l.width?this.getMinimumWidth(l.width):Math.max(0,s.originalX+s.originalWidth-oe.MINIMUM_WIDTH)),b=s.originalX+s.originalWidth-p,g=l.width-p-b},x=()=>{p=s.originalX-s.originalWidth,b=M(c-p,p<0&&typeof this.options.minimumInViewportWidth=="number"?-p+this.options.minimumInViewportWidth:oe.MINIMUM_WIDTH,Number.MAX_VALUE),g=l.width-p-b};switch(e){case"top":y();break;case"bottom":D();break;case"left":v();break;case"right":x();break;case"topleft":y(),v();break;case"topright":y(),x();break;case"bottomleft":D(),v();break;case"bottomright":D(),x();break}const C={};m<=u?C.top=m:C.bottom=u,p<=g?C.left=p:C.right=g,C.height=_,C.width=b,this.setBounds(C)}),{dispose:()=>{r.release()}},I(window,"pointerup",()=>{i.dispose(),this._onDidChangeEnd.fire()}))}))}getMinimumWidth(e){return typeof this.options.minimumInViewportWidth=="number"?e-this.options.minimumInViewportWidth:0}getMinimumHeight(e){return typeof this.options.minimumInViewportHeight=="number"?e-this.options.minimumInViewportHeight:0}dispose(){be.destroy(this._element),this._element.remove(),super.dispose()}}oe.MINIMUM_HEIGHT=20;oe.MINIMUM_WIDTH=20;class vn extends E{constructor(e,t){super(),this.group=e,this.overlay=t,this.addDisposables(t)}position(e){this.overlay.setBounds(e)}}const De=100,ne={left:100,top:100,width:300,height:300},_n=100;class wn{constructor(){this.cache=new Map,this.currentFrameId=0,this.rafId=null}getPosition(e){const t=this.cache.get(e);if(t&&t.frameId===this.currentFrameId)return t.rect;this.scheduleFrameUpdate();const i=je(e);return this.cache.set(e,{rect:i,frameId:this.currentFrameId}),i}invalidate(){this.currentFrameId++}scheduleFrameUpdate(){this.rafId||(this.rafId=requestAnimationFrame(()=>{this.currentFrameId++,this.rafId=null}))}}function bn(){const o=document.createElement("div");return o.tabIndex=-1,o}class ct extends E{constructor(e,t){super(),this.element=e,this.accessor=t,this.map={},this._disposed=!1,this.positionCache=new wn,this.pendingUpdates=new Set,this.addDisposables(N.from(()=>{for(const i of Object.values(this.map))i.disposable.dispose(),i.destroy.dispose();this._disposed=!0}))}updateAllPositions(){if(!this._disposed){this.positionCache.invalidate();for(const e of Object.values(this.map))e.panel.api.isVisible&&e.resize&&e.resize()}}detatch(e){if(this.map[e.api.id]){const{disposable:t,destroy:i}=this.map[e.api.id];return t.dispose(),i.dispose(),delete this.map[e.api.id],!0}return!1}attach(e){const{panel:t,referenceContainer:i}=e;if(!this.map[t.api.id]){const d=bn();d.className="dv-render-overlay",this.map[t.api.id]={panel:t,disposable:N.NONE,destroy:N.NONE,element:d}}const n=this.map[t.api.id].element;t.view.content.element.parentElement!==n&&n.appendChild(t.view.content.element),n.parentElement!==this.element&&this.element.appendChild(n);const s=()=>{const d=t.api.id;this.pendingUpdates.has(d)||(this.pendingUpdates.add(d),requestAnimationFrame(()=>{if(this.pendingUpdates.delete(d),this.isDisposed||!this.map[d])return;const c=this.positionCache.getPosition(i.element),m=this.positionCache.getPosition(this.element),u=c.left-m.left,_=c.top-m.top,p=c.width,g=c.height;n.style.left=`${u}px`,n.style.top=`${_}px`,n.style.width=`${p}px`,n.style.height=`${g}px`,A(n,"dv-render-overlay-float",t.group.api.location.type==="floating")}))},r=()=>{t.api.isVisible&&(this.positionCache.invalidate(),s()),n.style.display=t.api.isVisible?"":"none"},a=new Z,l=()=>{t.api.location.type==="floating"?queueMicrotask(()=>{const d=this.accessor.floatingGroups.find(_=>_.group===t.api.group);if(!d)return;const c=d.overlay.element,m=()=>{const _=Number(c.getAttribute("aria-level"));n.style.zIndex=`calc(var(--dv-overlay-z-index, 999) + ${_*2+1})`},u=new MutationObserver(()=>{m()});a.value=N.from(()=>u.disconnect()),u.observe(c,{attributeFilter:["aria-level"],attributes:!0}),m()}):n.style.zIndex=""},h=new E(a,new At(n,{onDragEnd:d=>{i.dropTarget.dnd.onDragEnd(d)},onDragEnter:d=>{i.dropTarget.dnd.onDragEnter(d)},onDragLeave:d=>{i.dropTarget.dnd.onDragLeave(d)},onDrop:d=>{i.dropTarget.dnd.onDrop(d)},onDragOver:d=>{i.dropTarget.dnd.onDragOver(d)}}),t.api.onDidVisibilityChange(()=>{r()}),t.api.onDidDimensionsChange(()=>{t.api.isVisible&&s()}),t.api.onDidLocationChange(()=>{l()}));return this.map[t.api.id].destroy=N.from(()=>{var d;t.view.content.element.parentElement===n&&n.removeChild(t.view.content.element),(d=n.parentElement)===null||d===void 0||d.removeChild(n)}),l(),queueMicrotask(()=>{this.isDisposed||r()}),this.map[t.api.id].disposable.dispose(),this.map[t.api.id].disposable=h,this.map[t.api.id].resize=s,n}}var Dn=function(o,e,t,i){function n(s){return s instanceof t?s:new t(function(r){r(s)})}return new(t||(t=Promise))(function(s,r){function a(d){try{h(i.next(d))}catch(c){r(c)}}function l(d){try{h(i.throw(d))}catch(c){r(c)}}function h(d){d.done?s(d.value):n(d.value).then(a,l)}h((i=i.apply(o,e||[])).next())})};class Cn extends E{get window(){var e,t;return(t=(e=this._window)===null||e===void 0?void 0:e.value)!==null&&t!==void 0?t:null}constructor(e,t,i){super(),this.target=e,this.className=t,this.options=i,this._onWillClose=new f,this.onWillClose=this._onWillClose.event,this._onDidClose=new f,this.onDidClose=this._onDidClose.event,this._window=null,this.addDisposables(this._onWillClose,this._onDidClose,{dispose:()=>{this.close()}})}dimensions(){if(!this._window)return null;const e=this._window.value.screenX,t=this._window.value.screenY,i=this._window.value.innerWidth,n=this._window.value.innerHeight;return{top:t,left:e,width:i,height:n}}close(){var e,t;this._window&&(this._onWillClose.fire(),(t=(e=this.options).onWillClose)===null||t===void 0||t.call(e,{id:this.target,window:this._window.value}),this._window.disposable.dispose(),this._window=null,this._onDidClose.fire())}open(){var e,t;return Dn(this,void 0,void 0,function*(){if(this._window)throw new Error("instance of popout window is already open");const i=`${this.options.url}`,n=Object.entries({top:this.options.top,left:this.options.left,width:this.options.width,height:this.options.height}).map(([l,h])=>`${l}=${h}`).join(","),s=window.open(i,this.target,n);if(!s)return null;const r=new E;this._window={value:s,disposable:r},r.addDisposables(N.from(()=>{s.close()}),I(window,"beforeunload",()=>{this.close()}));const a=this.createPopoutWindowContainer();return this.className&&a.classList.add(this.className),(t=(e=this.options).onDidOpen)===null||t===void 0||t.call(e,{id:this.target,window:s}),new Promise((l,h)=>{s.addEventListener("unload",d=>{}),s.addEventListener("load",()=>{try{const d=s.document;d.title=document.title,d.body.appendChild(a),ci(d,window.document.styleSheets),I(s,"beforeunload",()=>{this.close()}),l(a)}catch(d){h(d)}})})})}createPopoutWindowContainer(){const e=document.createElement("div");return e.classList.add("dv-popout-window"),e.id="dv-popout-window",e.style.position="absolute",e.style.width="100%",e.style.height="100%",e.style.top="0px",e.style.left="0px",e}}class yn extends E{constructor(e){super(),this.accessor=e,this.init()}init(){const e=new Set,t=new Set;this.addDisposables(this.accessor.onDidAddPanel(i=>{if(e.has(i.api.id))throw new Error(`dockview: Invalid event sequence. [onDidAddPanel] called for panel ${i.api.id} but panel already exists`);e.add(i.api.id)}),this.accessor.onDidRemovePanel(i=>{if(e.has(i.api.id))e.delete(i.api.id);else throw new Error(`dockview: Invalid event sequence. [onDidRemovePanel] called for panel ${i.api.id} but panel does not exists`)}),this.accessor.onDidAddGroup(i=>{if(t.has(i.api.id))throw new Error(`dockview: Invalid event sequence. [onDidAddGroup] called for group ${i.api.id} but group already exists`);t.add(i.api.id)}),this.accessor.onDidRemoveGroup(i=>{if(t.has(i.api.id))t.delete(i.api.id);else throw new Error(`dockview: Invalid event sequence. [onDidRemoveGroup] called for group ${i.api.id} but group does not exists`)}))}}class xn extends E{constructor(e){super(),this.root=e,this._active=null,this._activeDisposable=new Z,this._element=document.createElement("div"),this._element.className="dv-popover-anchor",this._element.style.position="relative",this.root.prepend(this._element),this.addDisposables(N.from(()=>{this.close()}),this._activeDisposable)}openPopover(e,t){var i;this.close();const n=document.createElement("div");n.style.position="absolute",n.style.zIndex=(i=t.zIndex)!==null&&i!==void 0?i:"var(--dv-overlay-z-index)",n.appendChild(e);const s=this._element.getBoundingClientRect(),r=s.left,a=s.top;n.style.top=`${t.y-a}px`,n.style.left=`${t.x-r}px`,this._element.appendChild(n),this._active=n,this._activeDisposable.value=new E(I(window,"pointerdown",l=>{var h;const d=l.target;if(!(d instanceof HTMLElement))return;let c=d;for(;c&&c!==n;)c=(h=c?.parentElement)!==null&&h!==void 0?h:null;c||this.close()})),requestAnimationFrame(()=>{wi(n,this.root)})}close(){this._active&&(this._active.remove(),this._activeDisposable.dispose(),this._active=null)}}class ut extends E{get disabled(){return this._disabled}set disabled(e){var t;this.disabled!==e&&(this._disabled=e,e&&((t=this.model)===null||t===void 0||t.clear()))}get model(){if(!this.disabled)return{clear:()=>{var e;this._model&&((e=this._model.root.parentElement)===null||e===void 0||e.removeChild(this._model.root)),this._model=void 0},exists:()=>!!this._model,getElements:(e,t)=>{const i=this._outline!==t;if(this._outline=t,this._model)return this._model.changed=i,this._model;const n=this.createContainer(),s=this.createAnchor();if(this._model={root:n,overlay:s,changed:i},n.appendChild(s),this.element.appendChild(n),e?.target instanceof HTMLElement){const r=e.target.getBoundingClientRect(),a=this.element.getBoundingClientRect();s.style.left=`${r.left-a.left}px`,s.style.top=`${r.top-a.top}px`}return this._model}}}constructor(e,t){super(),this.element=e,this._disabled=!1,this._disabled=t.disabled,this.addDisposables(N.from(()=>{var i;(i=this.model)===null||i===void 0||i.clear()}))}createContainer(){const e=document.createElement("div");return e.className="dv-drop-target-container",e}createAnchor(){const e=document.createElement("div");return e.className="dv-drop-target-anchor",e.style.visibility="hidden",e}}const pt={activationSize:{type:"pixels",value:10},size:{type:"pixels",value:20}};function Ce(o){const e=o.from.activePanel;[...o.from.panels].map(i=>{const n=o.from.model.removePanel(i);return o.from.model.renderContainer.detatch(i),n}).forEach(i=>{o.to.model.openPanel(i,{skipSetActive:e!==i,skipSetGroupActive:!0})})}class An extends Gi{get orientation(){return this.gridview.orientation}get totalPanels(){return this.panels.length}get panels(){return this.groups.flatMap(e=>e.panels)}get options(){return this._options}get activePanel(){const e=this.activeGroup;if(e)return e.activePanel}get renderer(){var e;return(e=this.options.defaultRenderer)!==null&&e!==void 0?e:"onlyWhenVisible"}get api(){return this._api}get floatingGroups(){return this._floatingGroups}get popoutRestorationPromise(){return this._popoutRestorationPromise}constructor(e,t){var i,n,s;super(e,{proportionalLayout:!0,orientation:P.HORIZONTAL,styles:t.hideBorders?{separatorBorder:"transparent"}:void 0,disableAutoResizing:t.disableAutoResizing,locked:t.locked,margin:(n=(i=t.theme)===null||i===void 0?void 0:i.gap)!==null&&n!==void 0?n:0,className:t.className}),this.nextGroupId=Ct(),this._deserializer=new mn(this),this._watermark=null,this._onWillDragPanel=new f,this.onWillDragPanel=this._onWillDragPanel.event,this._onWillDragGroup=new f,this.onWillDragGroup=this._onWillDragGroup.event,this._onDidDrop=new f,this.onDidDrop=this._onDidDrop.event,this._onWillDrop=new f,this.onWillDrop=this._onWillDrop.event,this._onWillShowOverlay=new f,this.onWillShowOverlay=this._onWillShowOverlay.event,this._onUnhandledDragOverEvent=new f,this.onUnhandledDragOverEvent=this._onUnhandledDragOverEvent.event,this._onDidRemovePanel=new f,this.onDidRemovePanel=this._onDidRemovePanel.event,this._onDidAddPanel=new f,this.onDidAddPanel=this._onDidAddPanel.event,this._onDidPopoutGroupSizeChange=new f,this.onDidPopoutGroupSizeChange=this._onDidPopoutGroupSizeChange.event,this._onDidPopoutGroupPositionChange=new f,this.onDidPopoutGroupPositionChange=this._onDidPopoutGroupPositionChange.event,this._onDidOpenPopoutWindowFail=new f,this.onDidOpenPopoutWindowFail=this._onDidOpenPopoutWindowFail.event,this._onDidLayoutFromJSON=new f,this.onDidLayoutFromJSON=this._onDidLayoutFromJSON.event,this._onDidActivePanelChange=new f({replay:!0}),this.onDidActivePanelChange=this._onDidActivePanelChange.event,this._onDidMovePanel=new f,this.onDidMovePanel=this._onDidMovePanel.event,this._onDidMaximizedGroupChange=new f,this.onDidMaximizedGroupChange=this._onDidMaximizedGroupChange.event,this._floatingGroups=[],this._popoutGroups=[],this._popoutRestorationPromise=Promise.resolve(),this._onDidRemoveGroup=new f,this.onDidRemoveGroup=this._onDidRemoveGroup.event,this._onDidAddGroup=new f,this.onDidAddGroup=this._onDidAddGroup.event,this._onDidOptionsChange=new f,this.onDidOptionsChange=this._onDidOptionsChange.event,this._onDidActiveGroupChange=new f,this.onDidActiveGroupChange=this._onDidActiveGroupChange.event,this._moving=!1,this._options=t,this.popupService=new xn(this.element),this._themeClassnames=new bt(this.element),this._api=new Pe(this),this.rootDropTargetContainer=new ut(this.element,{disabled:!0}),this.overlayRenderContainer=new ct(this.gridview.element,this),this._rootDropTarget=new te(this.element,{className:"dv-drop-target-edge",canDisplayOverlay:(r,a)=>{const l=q();if(l)return l.viewId!==this.id?!1:a==="center"?this.gridview.length===0:!0;if(a==="center"&&this.gridview.length!==0)return!1;const h=new zt(r,"edge",a,q);return this._onUnhandledDragOverEvent.fire(h),h.isAccepted},acceptedTargetZones:["top","bottom","left","right","center"],overlayModel:(s=t.rootOverlayModel)!==null&&s!==void 0?s:pt,getOverrideTarget:()=>{var r;return(r=this.rootDropTargetContainer)===null||r===void 0?void 0:r.model}}),this.updateDropTargetModel(t),A(this.gridview.element,"dv-dockview",!0),A(this.element,"dv-debug",!!t.debug),this.updateTheme(),this.updateWatermark(),t.debug&&this.addDisposables(new yn(this)),this.addDisposables(this.rootDropTargetContainer,this.overlayRenderContainer,this._onWillDragPanel,this._onWillDragGroup,this._onWillShowOverlay,this._onDidActivePanelChange,this._onDidAddPanel,this._onDidRemovePanel,this._onDidLayoutFromJSON,this._onDidDrop,this._onWillDrop,this._onDidMovePanel,this._onDidAddGroup,this._onDidRemoveGroup,this._onDidActiveGroupChange,this._onUnhandledDragOverEvent,this._onDidMaximizedGroupChange,this._onDidOptionsChange,this._onDidPopoutGroupSizeChange,this._onDidPopoutGroupPositionChange,this._onDidOpenPopoutWindowFail,this.onDidViewVisibilityChangeMicroTaskQueue(()=>{this.updateWatermark()}),this.onDidAdd(r=>{this._moving||this._onDidAddGroup.fire(r)}),this.onDidRemove(r=>{this._moving||this._onDidRemoveGroup.fire(r)}),this.onDidActiveChange(r=>{this._moving||this._onDidActiveGroupChange.fire(r)}),this.onDidMaximizedChange(r=>{this._onDidMaximizedGroupChange.fire({group:r.panel,isMaximized:r.isMaximized})}),de.any(this.onDidAdd,this.onDidRemove)(()=>{this.updateWatermark()}),de.any(this.onDidAddPanel,this.onDidRemovePanel,this.onDidAddGroup,this.onDidRemove,this.onDidMovePanel,this.onDidActivePanelChange,this.onDidPopoutGroupPositionChange,this.onDidPopoutGroupSizeChange)(()=>{this._bufferOnDidLayoutChange.fire()}),N.from(()=>{for(const r of[...this._floatingGroups])r.dispose();for(const r of[...this._popoutGroups])r.disposable.dispose()}),this._rootDropTarget,this._rootDropTarget.onWillShowOverlay(r=>{this.gridview.length>0&&r.position==="center"||this._onWillShowOverlay.fire(new Ge(r,{kind:"edge",panel:void 0,api:this._api,group:void 0,getData:q}))}),this._rootDropTarget.onDrop(r=>{var a;const l=new It({nativeEvent:r.nativeEvent,position:r.position,panel:void 0,api:this._api,group:void 0,getData:q,kind:"edge"});if(this._onWillDrop.fire(l),l.defaultPrevented)return;const h=q();h?this.moveGroupOrPanel({from:{groupId:h.groupId,panelId:(a=h.panelId)!==null&&a!==void 0?a:void 0},to:{group:this.orthogonalize(r.position),position:"center"}}):this._onDidDrop.fire(new Ke({nativeEvent:r.nativeEvent,position:r.position,panel:void 0,api:this._api,group:void 0,getData:q}))}),this._rootDropTarget)}setVisible(e,t){switch(e.api.location.type){case"grid":super.setVisible(e,t);break;case"floating":{const i=this.floatingGroups.find(n=>n.group===e);i&&(i.overlay.setVisible(t),e.api._onDidVisibilityChange.fire({isVisible:t}));break}case"popout":console.warn("dockview: You cannot hide a group that is in a popout window");break}}addPopoutGroup(e,t){var i,n,s,r,a;if(e instanceof pe&&e.group.size===1)return this.addPopoutGroup(e.group,t);const l=fi(this.gridview.element),h=this.element;function d(){return t?.position?t.position:e instanceof ht?e.element.getBoundingClientRect():e.group?e.group.element.getBoundingClientRect():h.getBoundingClientRect()}const c=d(),m=(n=(i=t?.overridePopoutGroup)===null||i===void 0?void 0:i.id)!==null&&n!==void 0?n:this.getNextGroupId(),u=new Cn(`${this.id}-${m}`,l??"",{url:(a=(s=t?.popoutUrl)!==null&&s!==void 0?s:(r=this.options)===null||r===void 0?void 0:r.popoutUrl)!==null&&a!==void 0?a:"/popout.html",left:window.screenX+c.left,top:window.screenY+c.top,width:c.width,height:c.height,onDidOpen:t?.onDidOpen,onWillClose:t?.onWillClose}),_=new E(u,u.onDidClose(()=>{_.dispose()}));return u.open().then(p=>{var g;if(u.isDisposed)return!1;const b=t?.referenceGroup?t.referenceGroup:e instanceof pe?e.group:e,y=e.api.location.type,D=b.element.parentElement!==null;let v;if(D?t?.overridePopoutGroup?v=t.overridePopoutGroup:(v=this.createGroup({id:m}),p&&this._onDidAddGroup.fire(v)):v=b,p===null)return console.error("dockview: failed to create popout. perhaps you need to allow pop-ups for this website"),_.dispose(),this._onDidOpenPopoutWindowFail.fire(),this.movingLock(()=>Ce({from:v,to:b})),b.api.isVisible||b.api.setVisible(!0),!1;const x=document.createElement("div");x.className="dv-overlay-render-container";const C=new ct(x,this);v.model.renderContainer=C,v.layout(u.window.innerWidth,u.window.innerHeight);let O;if(!t?.overridePopoutGroup&&D)if(e instanceof pe)this.movingLock(()=>{const z=b.model.removePanel(e);v.model.openPanel(z)});else switch(this.movingLock(()=>Ce({from:b,to:v})),y){case"grid":b.api.setVisible(!1);break;case"floating":case"popout":O=(g=this._floatingGroups.find(z=>z.group.api.id===e.api.id))===null||g===void 0?void 0:g.overlay.toJSON(),this.removeGroup(b);break}p.classList.add("dv-dockview"),p.style.overflow="hidden",p.appendChild(x),p.appendChild(v.element);const k=document.createElement("div"),F=new ut(k,{disabled:this.rootDropTargetContainer.disabled});p.appendChild(k),v.model.dropTargetContainer=F,v.model.location={type:"popout",getWindow:()=>u.window,popoutUrl:t?.popoutUrl},D&&e.api.location.type==="grid"&&e.api.setVisible(!1),this.doSetGroupAndPanelActive(v),_.addDisposables(v.api.onDidActiveChange(z=>{var w;z.isActive&&((w=u.window)===null||w===void 0||w.focus())}),v.api.onWillFocus(()=>{var z;(z=u.window)===null||z===void 0||z.focus()}));let V;const H=D&&b&&this.getPanel(b.id),j={window:u,popoutGroup:v,referenceGroup:H?b.id:void 0,disposable:{dispose:()=>(_.dispose(),V)}},G=vi(u.window);return _.addDisposables(G,_i(u.window,()=>{this._onDidPopoutGroupSizeChange.fire({width:u.window.innerWidth,height:u.window.innerHeight,group:v})}),G.event(()=>{this._onDidPopoutGroupPositionChange.fire({screenX:u.window.screenX,screenY:u.window.screenX,group:v})}),I(u.window,"resize",()=>{v.layout(u.window.innerWidth,u.window.innerHeight)}),C,N.from(()=>{if(!this.isDisposed){if(D&&this.getPanel(b.id))this.movingLock(()=>Ce({from:v,to:b})),b.api.isVisible||b.api.setVisible(!0),this.getPanel(v.id)&&this.doRemoveGroup(v,{skipPopoutAssociated:!0});else if(this.getPanel(v.id)){if(v.model.renderContainer=this.overlayRenderContainer,v.model.dropTargetContainer=this.rootDropTargetContainer,V=v,!this._popoutGroups.find(w=>w.popoutGroup===v))return;O?this.addFloatingGroup(v,{height:O.height,width:O.width,position:O}):(this.doRemoveGroup(v,{skipDispose:!0,skipActive:!0,skipPopoutReturn:!0}),v.model.location={type:"grid"},this.movingLock(()=>{this.doAddGroup(v,[0])})),this.doSetGroupAndPanelActive(v)}}})),this._popoutGroups.push(j),this.updateWatermark(),!0}).catch(p=>(console.error("dockview: failed to create popout.",p),!1))}addFloatingGroup(e,t){var i,n,s,r,a;let l;if(e instanceof pe)l=this.createGroup(),this._onDidAddGroup.fire(l),this.movingLock(()=>this.removePanel(e,{removeEmptyGroup:!0,skipDispose:!0,skipSetActiveGroup:!0})),this.movingLock(()=>l.model.openPanel(e,{skipSetGroupActive:!0}));else{l=e;const p=(i=this._popoutGroups.find(y=>y.popoutGroup===l))===null||i===void 0?void 0:i.referenceGroup,g=p?this.getPanel(p):void 0;typeof t?.skipRemoveGroup=="boolean"&&t.skipRemoveGroup||(g?(this.movingLock(()=>Ce({from:e,to:g})),this.doRemoveGroup(e,{skipPopoutReturn:!0,skipPopoutAssociated:!0}),this.doRemoveGroup(g,{skipDispose:!0}),l=g):this.doRemoveGroup(e,{skipDispose:!0,skipPopoutReturn:!0,skipPopoutAssociated:!1}))}function h(){if(t?.position){const p={};return"left"in t.position?p.left=Math.max(t.position.left,0):"right"in t.position?p.right=Math.max(t.position.right,0):p.left=ne.left,"top"in t.position?p.top=Math.max(t.position.top,0):"bottom"in t.position?p.bottom=Math.max(t.position.bottom,0):p.top=ne.top,typeof t.width=="number"?p.width=Math.max(t.width,0):p.width=ne.width,typeof t.height=="number"?p.height=Math.max(t.height,0):p.height=ne.height,p}return{left:typeof t?.x=="number"?Math.max(t.x,0):ne.left,top:typeof t?.y=="number"?Math.max(t.y,0):ne.top,width:typeof t?.width=="number"?Math.max(t.width,0):ne.width,height:typeof t?.height=="number"?Math.max(t.height,0):ne.height}}const d=h(),c=new oe(Object.assign(Object.assign({container:this.gridview.element,content:l.element},d),{minimumInViewportWidth:this.options.floatingGroupBounds==="boundedWithinViewport"?void 0:(s=(n=this.options.floatingGroupBounds)===null||n===void 0?void 0:n.minimumWidthWithinViewport)!==null&&s!==void 0?s:De,minimumInViewportHeight:this.options.floatingGroupBounds==="boundedWithinViewport"?void 0:(a=(r=this.options.floatingGroupBounds)===null||r===void 0?void 0:r.minimumHeightWithinViewport)!==null&&a!==void 0?a:De})),m=l.element.querySelector(".dv-void-container");if(!m)throw new Error("failed to find drag handle");c.setupDrag(m,{inDragMode:typeof t?.inDragMode=="boolean"?t.inDragMode:!1});const u=new vn(l,c),_=new E(l.api.onDidActiveChange(p=>{p.isActive&&c.bringToFront()}),Ie(l.element,p=>{const{width:g,height:b}=p.contentRect;l.layout(g,b)}));u.addDisposables(c.onDidChange(()=>{l.layout(l.width,l.height)}),c.onDidChangeEnd(()=>{this._bufferOnDidLayoutChange.fire()}),l.onDidChange(p=>{c.setBounds({height:p?.height,width:p?.width})}),{dispose:()=>{_.dispose(),ke(this._floatingGroups,u),l.model.location={type:"grid"},this.updateWatermark()}}),this._floatingGroups.push(u),l.model.location={type:"floating"},t?.skipActiveGroup||this.doSetGroupAndPanelActive(l),this.updateWatermark()}orthogonalize(e,t){switch(this.gridview.normalize(),e){case"top":case"bottom":this.gridview.orientation===P.HORIZONTAL&&this.gridview.insertOrthogonalSplitviewAtRoot();break;case"left":case"right":this.gridview.orientation===P.VERTICAL&&this.gridview.insertOrthogonalSplitviewAtRoot();break}switch(e){case"top":case"left":case"center":return this.createGroupAtLocation([0],void 0,t);case"bottom":case"right":return this.createGroupAtLocation([this.gridview.length],void 0,t);default:throw new Error(`unsupported position ${e}`)}}updateOptions(e){var t,i;if(super.updateOptions(e),"floatingGroupBounds"in e)for(const r of this._floatingGroups){switch(e.floatingGroupBounds){case"boundedWithinViewport":r.overlay.minimumInViewportHeight=void 0,r.overlay.minimumInViewportWidth=void 0;break;case void 0:r.overlay.minimumInViewportHeight=De,r.overlay.minimumInViewportWidth=De;break;default:r.overlay.minimumInViewportHeight=(t=e.floatingGroupBounds)===null||t===void 0?void 0:t.minimumHeightWithinViewport,r.overlay.minimumInViewportWidth=(i=e.floatingGroupBounds)===null||i===void 0?void 0:i.minimumWidthWithinViewport}r.overlay.setBounds()}this.updateDropTargetModel(e);const n=this.options.disableDnd;this._options=Object.assign(Object.assign({},this.options),e);const s=this.options.disableDnd;n!==s&&this.updateDragAndDropState(),"theme"in e&&this.updateTheme(),this.layout(this.gridview.width,this.gridview.height,!0)}layout(e,t,i){if(super.layout(e,t,i),this._floatingGroups)for(const n of this._floatingGroups)n.overlay.setBounds()}updateDragAndDropState(){for(const e of this.groups)e.model.updateDragAndDropState()}focus(){var e;(e=this.activeGroup)===null||e===void 0||e.focus()}getGroupPanel(e){return this.panels.find(t=>t.id===e)}setActivePanel(e){e.group.model.openPanel(e),this.doSetGroupAndPanelActive(e.group)}moveToNext(e={}){var t;if(!e.group){if(!this.activeGroup)return;e.group=this.activeGroup}if(e.includePanel&&e.group&&e.group.activePanel!==e.group.panels[e.group.panels.length-1]){e.group.model.moveToNext({suppressRoll:!0});return}const i=U(e.group.element),n=(t=this.gridview.next(i))===null||t===void 0?void 0:t.view;this.doSetGroupAndPanelActive(n)}moveToPrevious(e={}){var t;if(!e.group){if(!this.activeGroup)return;e.group=this.activeGroup}if(e.includePanel&&e.group&&e.group.activePanel!==e.group.panels[0]){e.group.model.moveToPrevious({suppressRoll:!0});return}const i=U(e.group.element),n=(t=this.gridview.previous(i))===null||t===void 0?void 0:t.view;n&&this.doSetGroupAndPanelActive(n)}toJSON(){var e;const t=this.gridview.serialize(),i=this.panels.reduce((a,l)=>(a[l.id]=l.toJSON(),a),{}),n=this._floatingGroups.map(a=>({data:a.group.toJSON(),position:a.overlay.toJSON()})),s=this._popoutGroups.map(a=>({data:a.popoutGroup.toJSON(),gridReferenceGroup:a.referenceGroup,position:a.window.dimensions(),url:a.popoutGroup.api.location.type==="popout"?a.popoutGroup.api.location.popoutUrl:void 0})),r={grid:t,panels:i,activeGroup:(e=this.activeGroup)===null||e===void 0?void 0:e.id};return n.length>0&&(r.floatingGroups=n),s.length>0&&(r.popoutGroups=s),r}fromJSON(e){var t,i;if(this.clear(),typeof e!="object"||e===null)throw new Error("serialized layout must be a non-null object");const{grid:n,panels:s,activeGroup:r}=e;if(n.root.type!=="branch"||!Array.isArray(n.root.data))throw new Error("root must be of type branch");try{const a=this.width,l=this.height,h=u=>{const{id:_,locked:p,hideHeader:g,views:b,activeView:y}=u;if(typeof _!="string")throw new Error("group id must be of type string");const D=this.createGroup({id:_,locked:!!p,hideHeader:!!g});this._onDidAddGroup.fire(D);const v=[];for(const x of b){const C=this._deserializer.fromJSON(s[x],D);v.push(C)}for(let x=0;x<b.length;x++){const C=v[x],O=typeof y=="string"&&y===C.id;D.model.openPanel(C,{skipSetActive:!O,skipSetGroupActive:!0})}return!D.activePanel&&D.panels.length>0&&D.model.openPanel(D.panels[D.panels.length-1],{skipSetGroupActive:!0}),D};this.gridview.deserialize(n,{fromJSON:u=>h(u.data)}),this.layout(a,l,!0);const d=(t=e.floatingGroups)!==null&&t!==void 0?t:[];for(const u of d){const{data:_,position:p}=u,g=h(_);this.addFloatingGroup(g,{position:p,width:p.width,height:p.height,skipRemoveGroup:!0,inDragMode:!1})}const c=(i=e.popoutGroups)!==null&&i!==void 0?i:[],m=[];c.forEach((u,_)=>{const{data:p,position:g,gridReferenceGroup:b,url:y}=u,D=h(p),v=new Promise(x=>{setTimeout(()=>{this.addPopoutGroup(D,{position:g??void 0,overridePopoutGroup:b?D:void 0,referenceGroup:b?this.getPanel(b):void 0,popoutUrl:y}),x()},_*_n)});m.push(v)}),this._popoutRestorationPromise=Promise.all(m).then(()=>{});for(const u of this._floatingGroups)u.overlay.setBounds();if(typeof r=="string"){const u=this.getPanel(r);u&&this.doSetGroupAndPanelActive(u)}}catch(a){console.error("dockview: failed to deserialize layout. Reverting changes",a);for(const l of this.groups)for(const h of l.panels)this.removePanel(h,{removeEmptyGroup:!1,skipDispose:!1});for(const l of this.groups)l.dispose(),this._groups.delete(l.id),this._onDidRemoveGroup.fire(l);for(const l of[...this._floatingGroups])l.dispose();throw this.clear(),a}this.updateWatermark(),requestAnimationFrame(()=>{this.overlayRenderContainer.updateAllPositions()}),this._onDidLayoutFromJSON.fire()}clear(){const e=Array.from(this._groups.values()).map(i=>i.value),t=!!this.activeGroup;for(const i of e)this.removeGroup(i,{skipActive:!0});t&&this.doSetGroupAndPanelActive(void 0),this.gridview.clear()}closeAllGroups(){for(const e of this._groups.entries()){const[t,i]=e;i.value.model.closeAllPanels()}}addPanel(e){var t,i;if(this.panels.find(l=>l.id===e.id))throw new Error(`panel with id ${e.id} already exists`);let n;if(e.position&&e.floating)throw new Error("you can only provide one of: position, floating as arguments to .addPanel(...)");const s={width:e.initialWidth,height:e.initialHeight};let r;if(e.position)if(tn(e.position)){const l=typeof e.position.referencePanel=="string"?this.getGroupPanel(e.position.referencePanel):e.position.referencePanel;if(r=e.position.index,!l)throw new Error(`referencePanel '${e.position.referencePanel}' does not exist`);n=this.findGroup(l)}else if(nn(e.position)){if(n=typeof e.position.referenceGroup=="string"?(t=this._groups.get(e.position.referenceGroup))===null||t===void 0?void 0:t.value:e.position.referenceGroup,r=e.position.index,!n)throw new Error(`referenceGroup '${e.position.referenceGroup}' does not exist`)}else{const l=this.orthogonalize(lt(e.position.direction)),h=this.createPanel(e,l);return l.model.openPanel(h,{skipSetActive:e.inactive,skipSetGroupActive:e.inactive,index:r}),e.inactive||this.doSetGroupAndPanelActive(l),l.api.setSize({height:s?.height,width:s?.width}),h}else n=this.activeGroup;let a;if(n){const l=at(((i=e.position)===null||i===void 0?void 0:i.direction)||"within");if(e.floating){const h=this.createGroup();this._onDidAddGroup.fire(h);const d=typeof e.floating=="object"&&e.floating!==null?e.floating:{};this.addFloatingGroup(h,Object.assign(Object.assign({},d),{inDragMode:!1,skipRemoveGroup:!0,skipActiveGroup:!0})),a=this.createPanel(e,h),h.model.openPanel(a,{skipSetActive:e.inactive,skipSetGroupActive:e.inactive,index:r})}else if(n.api.location.type==="floating"||l==="center")a=this.createPanel(e,n),n.model.openPanel(a,{skipSetActive:e.inactive,skipSetGroupActive:e.inactive,index:r}),n.api.setSize({width:s?.width,height:s?.height}),e.inactive||this.doSetGroupAndPanelActive(n);else{const h=U(n.element),d=ue(this.gridview.orientation,h,l),c=this.createGroupAtLocation(d,this.orientationAtLocation(d)===P.VERTICAL?s?.height:s?.width);a=this.createPanel(e,c),c.model.openPanel(a,{skipSetActive:e.inactive,skipSetGroupActive:e.inactive,index:r}),e.inactive||this.doSetGroupAndPanelActive(c)}}else if(e.floating){const l=this.createGroup();this._onDidAddGroup.fire(l);const h=typeof e.floating=="object"&&e.floating!==null?e.floating:{};this.addFloatingGroup(l,Object.assign(Object.assign({},h),{inDragMode:!1,skipRemoveGroup:!0,skipActiveGroup:!0})),a=this.createPanel(e,l),l.model.openPanel(a,{skipSetActive:e.inactive,skipSetGroupActive:e.inactive,index:r})}else{const l=this.createGroupAtLocation([0],this.gridview.orientation===P.VERTICAL?s?.height:s?.width);a=this.createPanel(e,l),l.model.openPanel(a,{skipSetActive:e.inactive,skipSetGroupActive:e.inactive,index:r}),e.inactive||this.doSetGroupAndPanelActive(l)}return a}removePanel(e,t={removeEmptyGroup:!0}){const i=e.group;if(!i)throw new Error(`cannot remove panel ${e.id}. it's missing a group.`);i.model.removePanel(e,{skipSetActiveGroup:t.skipSetActiveGroup}),t.skipDispose||(e.group.model.renderContainer.detatch(e),e.dispose()),i.size===0&&t.removeEmptyGroup&&this.removeGroup(i,{skipActive:t.skipSetActiveGroup})}createWatermarkComponent(){return this.options.createWatermarkComponent?this.options.createWatermarkComponent():new fn}updateWatermark(){var e,t;if(this.groups.filter(i=>i.api.location.type==="grid"&&i.api.isVisible).length===0){if(!this._watermark){this._watermark=this.createWatermarkComponent(),this._watermark.init({containerApi:new Pe(this)});const i=document.createElement("div");i.className="dv-watermark-container",pi(i,"watermark-component"),i.appendChild(this._watermark.element),this.gridview.element.appendChild(i)}}else this._watermark&&(this._watermark.element.parentElement.remove(),(t=(e=this._watermark).dispose)===null||t===void 0||t.call(e),this._watermark=null)}addGroup(e){var t;if(e){let i;if(sn(e)){const h=typeof e.referencePanel=="string"?this.panels.find(d=>d.id===e.referencePanel):e.referencePanel;if(!h)throw new Error(`reference panel ${e.referencePanel} does not exist`);if(i=this.findGroup(h),!i)throw new Error(`reference group for reference panel ${e.referencePanel} does not exist`)}else if(on(e)){if(i=typeof e.referenceGroup=="string"?(t=this._groups.get(e.referenceGroup))===null||t===void 0?void 0:t.value:e.referenceGroup,!i)throw new Error(`reference group ${e.referenceGroup} does not exist`)}else{const h=this.orthogonalize(lt(e.direction),e);return e.skipSetActive||this.doSetGroupAndPanelActive(h),h}const n=at(e.direction||"within"),s=U(i.element),r=ue(this.gridview.orientation,s,n),a=this.createGroup(e),l=this.getLocationOrientation(r)===P.VERTICAL?e.initialHeight:e.initialWidth;return this.doAddGroup(a,r,l),e.skipSetActive||this.doSetGroupAndPanelActive(a),a}else{const i=this.createGroup(e);return this.doAddGroup(i),this.doSetGroupAndPanelActive(i),i}}getLocationOrientation(e){return e.length%2==0&&this.gridview.orientation===P.HORIZONTAL?P.HORIZONTAL:P.VERTICAL}removeGroup(e,t){this.doRemoveGroup(e,t)}doRemoveGroup(e,t){var i;const n=[...e.panels];if(!t?.skipDispose)for(const a of n)this.removePanel(a,{removeEmptyGroup:!1,skipDispose:(i=t?.skipDispose)!==null&&i!==void 0?i:!1});const s=this.activePanel;if(e.api.location.type==="floating"){const a=this._floatingGroups.find(l=>l.group===e);if(a){if(t?.skipDispose||(a.group.dispose(),this._groups.delete(e.id),this._onDidRemoveGroup.fire(e)),ke(this._floatingGroups,a),a.dispose(),!t?.skipActive&&this._activeGroup===e){const l=Array.from(this._groups.values());this.doSetGroupAndPanelActive(l.length>0?l[0].value:void 0)}return a.group}throw new Error("failed to find floating group")}if(e.api.location.type==="popout"){const a=this._popoutGroups.find(l=>l.popoutGroup===e);if(a){if(!t?.skipDispose){if(!t?.skipPopoutAssociated){const h=a.referenceGroup?this.getPanel(a.referenceGroup):void 0;h&&h.panels.length===0&&this.removeGroup(h)}a.popoutGroup.dispose(),this._groups.delete(e.id),this._onDidRemoveGroup.fire(e)}ke(this._popoutGroups,a);const l=a.disposable.dispose();if(!t?.skipPopoutReturn&&l&&(this.doAddGroup(l,[0]),this.doSetGroupAndPanelActive(l)),!t?.skipActive&&this._activeGroup===e){const h=Array.from(this._groups.values());this.doSetGroupAndPanelActive(h.length>0?h[0].value:void 0)}return this.updateWatermark(),a.popoutGroup}throw new Error("failed to find popout group")}const r=super.doRemoveGroup(e,t);return t?.skipActive||this.activePanel!==s&&this._onDidActivePanelChange.fire(this.activePanel),r}movingLock(e){const t=this._moving;try{return this._moving=!0,e()}finally{this._moving=t}}moveGroupOrPanel(e){var t;const i=e.to.group,n=e.from.groupId,s=e.from.panelId,r=e.to.position,a=e.to.index,l=n?(t=this._groups.get(n))===null||t===void 0?void 0:t.value:void 0;if(!l)throw new Error(`Failed to find group id ${n}`);if(s===void 0){this.moveGroup({from:{group:l},to:{group:i,position:r},skipSetActive:e.skipSetActive});return}if(!r||r==="center"){const h=this.movingLock(()=>l.model.removePanel(s,{skipSetActive:!1,skipSetActiveGroup:!0}));if(!h)throw new Error(`No panel with id ${s}`);l.model.size===0&&this.doRemoveGroup(l,{skipActive:!0});const d=i.model.size===0;this.movingLock(()=>{var c;return i.model.openPanel(h,{index:a,skipSetActive:((c=e.skipSetActive)!==null&&c!==void 0?c:!1)&&!d,skipSetGroupActive:!0})}),e.skipSetActive||this.doSetGroupAndPanelActive(i),this._onDidMovePanel.fire({panel:h,from:l})}else{const h=U(i.element),d=ue(this.gridview.orientation,h,r);if(l.size<2){const[c,m]=he(d);if(l.api.location.type==="grid"){const g=U(l.element),[b,y]=he(g);if(Di(b,c)){this.gridview.moveView(b,y,m),this._onDidMovePanel.fire({panel:this.getGroupPanel(s),from:l});return}}if(l.api.location.type==="popout"){const g=this._popoutGroups.find(D=>D.popoutGroup===l),b=this.movingLock(()=>g.popoutGroup.model.removePanel(g.popoutGroup.panels[0],{skipSetActive:!0,skipSetActiveGroup:!0}));this.doRemoveGroup(l,{skipActive:!0});const y=this.createGroupAtLocation(d);this.movingLock(()=>y.model.openPanel(b)),this.doSetGroupAndPanelActive(y),this._onDidMovePanel.fire({panel:this.getGroupPanel(s),from:l});return}const u=this.movingLock(()=>this.doRemoveGroup(l,{skipActive:!0,skipDispose:!0})),_=U(i.element),p=ue(this.gridview.orientation,_,r);this.movingLock(()=>this.doAddGroup(u,p)),this.doSetGroupAndPanelActive(u),this._onDidMovePanel.fire({panel:this.getGroupPanel(s),from:l})}else{const c=this.movingLock(()=>l.model.removePanel(s,{skipSetActive:!1,skipSetActiveGroup:!0}));if(!c)throw new Error(`No panel with id ${s}`);const m=ue(this.gridview.orientation,h,r),u=this.createGroupAtLocation(m);this.movingLock(()=>u.model.openPanel(c,{skipSetGroupActive:!0})),this.doSetGroupAndPanelActive(u),this._onDidMovePanel.fire({panel:c,from:l})}}}moveGroup(e){const t=e.from.group,i=e.to.group,n=e.to.position;if(n==="center"){const s=t.activePanel,r=this.movingLock(()=>[...t.panels].map(a=>t.model.removePanel(a.id,{skipSetActive:!0})));t?.model.size===0&&this.doRemoveGroup(t,{skipActive:!0}),this.movingLock(()=>{for(const a of r)i.model.openPanel(a,{skipSetActive:a!==s,skipSetGroupActive:!0})}),e.skipSetActive!==!0?this.doSetGroupAndPanelActive(i):this.activePanel||this.doSetGroupAndPanelActive(i)}else{switch(t.api.location.type){case"grid":this.gridview.removeView(U(t.element));break;case"floating":{const s=this._floatingGroups.find(r=>r.group===t);if(!s)throw new Error("failed to find floating group");s.dispose();break}case"popout":{const s=this._popoutGroups.find(a=>a.popoutGroup===t);if(!s)throw new Error("failed to find popout group");const r=this._popoutGroups.indexOf(s);if(r>=0&&this._popoutGroups.splice(r,1),s.referenceGroup){const a=this.getPanel(s.referenceGroup);a&&!a.api.isVisible&&this.doRemoveGroup(a,{skipActive:!0})}s.window.dispose(),i.api.location.type==="grid"?(t.model.renderContainer=this.overlayRenderContainer,t.model.dropTargetContainer=this.rootDropTargetContainer,t.model.location={type:"grid"}):i.api.location.type==="floating"&&(t.model.renderContainer=this.overlayRenderContainer,t.model.dropTargetContainer=this.rootDropTargetContainer,t.model.location={type:"floating"});break}}if(i.api.location.type==="grid"){const s=U(i.element),r=ue(this.gridview.orientation,s,n);let a;switch(this.gridview.orientation){case P.VERTICAL:a=s.length%2==0?t.api.width:t.api.height;break;case P.HORIZONTAL:a=s.length%2==0?t.api.height:t.api.width;break}this.gridview.addView(t,a,r)}else if(i.api.location.type==="floating"){const s=this._floatingGroups.find(r=>r.group===i);if(s){const r=s.overlay.toJSON();let a,l;"left"in r?a=r.left+50:"right"in r?a=Math.max(0,r.right-r.width-50):a=50,"top"in r?l=r.top+50:"bottom"in r?l=Math.max(0,r.bottom-r.height-50):l=50,this.addFloatingGroup(t,{height:r.height,width:r.width,position:{left:a,top:l}})}}}if(t.panels.forEach(s=>{this._onDidMovePanel.fire({panel:s,from:t})}),e.skipSetActive===!1){const s=i??t;this.doSetGroupAndPanelActive(s)}}doSetGroupActive(e){super.doSetGroupActive(e);const t=this.activePanel;!this._moving&&t!==this._onDidActivePanelChange.value&&this._onDidActivePanelChange.fire(t)}doSetGroupAndPanelActive(e){super.doSetGroupActive(e);const t=this.activePanel;e&&this.hasMaximizedGroup()&&!this.isMaximizedGroup(e)&&this.exitMaximizedGroup(),!this._moving&&t!==this._onDidActivePanelChange.value&&this._onDidActivePanelChange.fire(t)}getNextGroupId(){let e=this.nextGroupId.next();for(;this._groups.has(e);)e=this.nextGroupId.next();return e}createGroup(e){e||(e={});let t=e?.id;if(t&&this._groups.has(e.id)&&(console.warn(`dockview: Duplicate group id ${e?.id}. reassigning group id to avoid errors`),t=void 0),!t)for(t=this.nextGroupId.next();this._groups.has(t);)t=this.nextGroupId.next();const i=new ht(this,t,e);if(i.init({params:{},accessor:this}),!this._groups.has(i.id)){const n=new E(i.model.onTabDragStart(s=>{this._onWillDragPanel.fire(s)}),i.model.onGroupDragStart(s=>{this._onWillDragGroup.fire(s)}),i.model.onMove(s=>{const{groupId:r,itemId:a,target:l,index:h}=s;this.moveGroupOrPanel({from:{groupId:r,panelId:a},to:{group:i,position:l,index:h}})}),i.model.onDidDrop(s=>{this._onDidDrop.fire(s)}),i.model.onWillDrop(s=>{this._onWillDrop.fire(s)}),i.model.onWillShowOverlay(s=>{if(this.options.disableDnd){s.preventDefault();return}this._onWillShowOverlay.fire(s)}),i.model.onUnhandledDragOverEvent(s=>{this._onUnhandledDragOverEvent.fire(s)}),i.model.onDidAddPanel(s=>{this._moving||this._onDidAddPanel.fire(s.panel)}),i.model.onDidRemovePanel(s=>{this._moving||this._onDidRemovePanel.fire(s.panel)}),i.model.onDidActivePanelChange(s=>{this._moving||s.panel===this.activePanel&&this._onDidActivePanelChange.value!==s.panel&&this._onDidActivePanelChange.fire(s.panel)}),de.any(i.model.onDidPanelTitleChange,i.model.onDidPanelParametersChange)(()=>{this._bufferOnDidLayoutChange.fire()}));this._groups.set(i.id,{value:i,disposable:n})}return i.initialize(),i}createPanel(e,t){var i,n,s;const r=e.component,a=(i=e.tabComponent)!==null&&i!==void 0?i:this.options.defaultTabComponent,l=new Gt(this,e.id,r,a),h=new pe(e.id,r,a,this,this._api,t,l,{renderer:e.renderer,minimumWidth:e.minimumWidth,minimumHeight:e.minimumHeight,maximumWidth:e.maximumWidth,maximumHeight:e.maximumHeight});return h.init({title:(n=e.title)!==null&&n!==void 0?n:e.id,params:(s=e?.params)!==null&&s!==void 0?s:{}}),h}createGroupAtLocation(e,t,i){const n=this.createGroup(i);return this.doAddGroup(n,e,t),n}findGroup(e){var t;return(t=Array.from(this._groups.values()).find(i=>i.value.model.containsPanel(e)))===null||t===void 0?void 0:t.value}orientationAtLocation(e){const t=this.gridview.orientation;return e.length%2==1?t:ee(t)}updateDropTargetModel(e){"dndEdges"in e&&(this._rootDropTarget.disabled=typeof e.dndEdges=="boolean"&&e.dndEdges===!1,typeof e.dndEdges=="object"&&e.dndEdges!==null?this._rootDropTarget.setOverlayModel(e.dndEdges):this._rootDropTarget.setOverlayModel(pt)),"rootOverlayModel"in e&&this.updateDropTargetModel({dndEdges:e.dndEdges})}updateTheme(){var e,t;const i=(e=this._options.theme)!==null&&e!==void 0?e:un;switch(this._themeClassnames.setClassNames(i.className),this.gridview.margin=(t=i.gap)!==null&&t!==void 0?t:0,i.dndOverlayMounting){case"absolute":this.rootDropTargetContainer.disabled=!1;break;case"relative":default:this.rootDropTargetContainer.disabled=!0;break}}}function Sn(o,e){return new An(o,e).api}class et{_element;onResizeCb=null;_loaded=!1;get loaded(){return this._loaded}get element(){return this._element}constructor(){this._element=document.createElement("div")}init(e){e.params.handler=this,this.setup?.(e),e.api.onDidDimensionsChange(t=>{this.onResize?.(t.width,t.height),this.onResizeCb?.(t.width,t.height)})}}class Pn{_element;get element(){return this._element}constructor(){this._element=document.createElement("div"),this._element.style.padding="5px 10px 0 10px"}init(e){e.api.onDidTitleChange(t=>{this._element.textContent=t.title})}}class Mt extends et{canvas;setup(){this.canvas=document.createElement("canvas"),this._element.appendChild(this.canvas)}onResize(e,t){this.canvas.width=e,this.canvas.height=t}}class Xe{static hexStrToRgb(e){if(e=e.replace(/^#/,""),e.length===3&&(e=e.split("").map(s=>s+s).join("")),e.length!==6)return null;const t=parseInt(e.substring(0,2),16),i=parseInt(e.substring(2,4),16),n=parseInt(e.substring(4,6),16);return{r:t,g:i,b:n}}static rgbToHexStr(e){const t=Math.max(0,Math.min(255,e.r)).toString(16).padStart(2,"0"),i=Math.max(0,Math.min(255,e.g)).toString(16).padStart(2,"0"),n=Math.max(0,Math.min(255,e.b)).toString(16).padStart(2,"0");return`#${t}${i}${n}`}static sleep(e){return new Promise(t=>setTimeout(t,e))}}class Ot extends et{_parameters;get parameters(){return this._parameters}constructor(){super(),this._element.classList.add("inspector-panel","scrollable")}onFieldChangeCb;updateFields(e){if(this._parameters=e,this._element.innerHTML="",!e)return;const t=this.createField("Position",e.position,"xyz"),i=this.createField("Rotation",e.rotation,"xyz"),n=this.createField("Scale",e.scale,"xyz"),s=this.createField("Material",e.color,"color");this._element.append(t,i,n,s)}createField(e,t,i){const n=document.createElement("div");n.className="inspector-field";const s=document.createElement("p");s.textContent=e,s.className="inspector-title";const r=document.createElement("div");if(r.className="inspector-params",i==="xyz")for(let a=0;a<i.length;++a){const l=i.charAt(a),h=document.createElement("div");h.className="inspector-input-wrapper";const d=document.createElement("label");d.textContent=l.toUpperCase(),d.setAttribute("for",`${l}Input`),d.className="inspector-label";const c=document.createElement("input");c.type="number",c.name=`${l}Input`,c.value=t[a]?.toString()??"0",c.className="inspector-input",c.addEventListener("change",()=>{t[a]=parseFloat(c.value),this.onFieldChangeCb?.(e,i,t)}),h.append(d,c),r.appendChild(h)}else if(i==="color"){const a=document.createElement("div");a.className="inspector-input-wrapper";const l=document.createElement("label");l.textContent="Color",l.setAttribute("for","colorInput"),l.className="inspector-label";const h=document.createElement("input");h.type="color",h.name="colorInput",h.value=Xe.rgbToHexStr({r:t[0],g:t[1],b:t[2]}),h.className="inspector-color-input",h.addEventListener("input",()=>{const d=Xe.hexStrToRgb(h.value)??{r:0,g:0,b:0};t[0]=d.r,t[1]=d.g,t[2]=d.b,this.onFieldChangeCb?.(e,i,t)}),a.append(l,h),r.appendChild(a)}return n.append(s,r),n}}class Tt extends et{listElement;itemsMap=new Map;panelContextMenuCallback;constructor(){super(),this._element.classList.add("hierarchy-panel","scrollable"),this.listElement=document.createElement("ul"),this.listElement.classList.add("hierarchy-list"),this._element.appendChild(this.listElement),this._element.addEventListener("contextmenu",e=>{if(e.preventDefault(),e.stopPropagation(),e.target.closest(".hierarchy-item"))return;const t=this.panelContextMenuCallback?.({name:"Hierarchy"},e.clientX,e.clientY);t&&t.length>0&&this.showContextMenu(t,e.clientX,e.clientY)})}onContextMenu(e){this.panelContextMenuCallback=e}addItem(e,t){const i=document.createElement("li");if(i.textContent=e.name,i.classList.add("hierarchy-item"),e.onClick&&i.addEventListener("click",s=>{s.stopPropagation(),e.onClick(e)}),i.addEventListener("contextmenu",s=>{s.preventDefault(),s.stopPropagation();const r=e.onContextMenu?.(e,s.clientX,s.clientY);r&&r.length>0&&this.showContextMenu(r,s.clientX,s.clientY)}),(t??this.listElement).appendChild(i),this.itemsMap.set(e.name,i),e.children&&e.children.length>0){const s=document.createElement("ul");s.classList.add("hierarchy-list"),i.appendChild(s);for(const r of e.children)this.addItem(r,s)}}removeItem(e){const t=this.itemsMap.get(e.name);t&&(t.remove(),this.itemsMap.delete(e.name))}showContextMenu(e,t,i){const n=document.getElementById("hierarchy-context-menu");n&&n.remove();const s=document.createElement("div");s.id="hierarchy-context-menu",s.classList.add("hierarchy-context-menu"),s.style.left=`${t}px`,s.style.top=`${i}px`,e.forEach(r=>{const a=document.createElement("div");if(a.classList.add("hierarchy-context-menu-item"),a.textContent=r.text,s.appendChild(a),r.callback&&a.addEventListener("click",()=>{r.callback(),s.remove()}),r.children&&r.children.length>0){a.classList.add("has-children");const l=document.createElement("div");l.classList.add("hierarchy-context-submenu"),l.style.display="none",a.appendChild(l),this.buildSubMenu(l,r.children),a.addEventListener("mouseenter",()=>{this.positionSubMenu(l,a),l.style.display="block"}),a.addEventListener("mouseleave",()=>{l.style.display="none"})}}),document.body.appendChild(s),document.addEventListener("click",()=>s.remove(),{once:!0})}buildSubMenu(e,t){t.forEach(i=>{const n=document.createElement("div");if(n.classList.add("hierarchy-context-menu-item"),n.textContent=i.text,e.appendChild(n),i.callback&&n.addEventListener("click",()=>{i.callback(),e.closest("#hierarchy-context-menu")?.remove()}),i.children&&i.children.length>0){n.classList.add("has-children");const s=document.createElement("div");s.classList.add("hierarchy-context-submenu"),s.style.display="none",n.appendChild(s),this.buildSubMenu(s,i.children)}})}positionSubMenu(e,t){const i=t.getBoundingClientRect(),n=e.getBoundingClientRect(),s=window.innerWidth,r=window.innerHeight;let a=i.width,l=0;i.right+n.width>s&&(a=-n.width),i.top+n.height>r&&(l=r-n.height-i.top),e.style.left=`${a}px`,e.style.top=`${l}px`}}class En{api;panelHandlers;constructor(e){this.panelHandlers=[];const t=new Mt,i=new Ot,n=new Tt;this.panelHandlers.push(t),this.panelHandlers.push(i),this.panelHandlers.push(n),this.api=Sn(e,{theme:cn,createComponent:s=>{switch(s.name){case"Scene":return t;case"Inspector":return i;case"Hierarchy":return n;default:throw new Error("Panel not found")}},createTabComponent:s=>{switch(s.name){case"default":return new Pn;default:throw new Error("Tab not found")}}})}async initLayout(){const e=this.api.addPanel({id:"scene",component:"Scene",title:"Scene",tabComponent:"default"}),t=this.api.addPanel({id:"inspector",component:"Inspector",title:"Inspector",tabComponent:"default",position:{referencePanel:e,direction:"right"},minimumWidth:200,maximumWidth:350,initialWidth:250});this.api.addPanel({id:"hierarchy",component:"Hierarchy",title:"Hierarchy",tabComponent:"default",position:{referencePanel:t,direction:"above"},minimumWidth:200,maximumWidth:350,initialWidth:250}),await Xe.sleep(50)}getPanel(e){for(const t of this.panelHandlers)if(t instanceof e)return t;return null}}const zn=document.querySelector("#app"),Oe=new En(zn);await Oe.initLayout();const Lt=Oe.getPanel(Ot),kt=Oe.getPanel(Mt),Ee=Oe.getPanel(Tt);Lt.onFieldChangeCb=(o,e,t)=>{const i=X.lastIntersectedObj;i&&(o==="Position"?i.position=t:o==="Rotation"?i.rotation=t:o==="Scale"?i.scale=t:o==="Material"&&(i.color=[t[0]/255,t[1]/255,t[2]/255]),i.sync())};const Vt=o=>{let e=null;o&&(e={position:o.position,rotation:o.rotation,scale:o.scale,color:[o.color[0]*255,o.color[1]*255,o.color[2]*255]}),Lt.updateFields(e)},Rt=o=>[{text:`Remove ${o.name}`,callback:()=>{X.removeObject(o.data?.objectRef),Ee.removeItem(o)}}],Wt=o=>{const e=o.data?.objectRef;e&&(X.selectObject(e),Vt(e))};Ee.onContextMenu(()=>{const o=i=>i.charAt(0).toUpperCase()+i.slice(1).toLowerCase();return[{text:"Create new primitive",children:Object.keys(He).map(i=>({text:o(i),callback:()=>{const n=He[i],s=new $({primitive:n});X.addObject(s),s.name=`${o(i)}${$.getCountByType(s.primitive)}`,Ee.addItem({name:s.name,onClick:Wt,onContextMenu:Rt,data:{objectRef:s}})}}))}]});let ae,X,mt,T;const ze=kt.canvas;await In(ze);Nt(ze.width,ze.height);kt.onResizeCb=Nt;Gn(ze);async function In(o){const e=await navigator.gpu.requestAdapter();if(!e)throw Error("Could not request GPU adapter.");if(ae=await e.requestDevice(),!ae)throw Error("Could not request GPU device.");const t=o.getContext("webgpu");if(!t)throw Error("Could not request WebGPU canvas context.");const i=navigator.gpu.getPreferredCanvasFormat();t.configure({device:ae,format:i,alphaMode:"opaque"}),T=new ti,T.position=[5,8,12],X=new Ze(ae,i,T),mt=new ni(ae,i,T);const n=new $({name:"Cube",color:[.2,.8,.2]});X.addObject(n),Ee.addItem({name:n.name,onClick:Wt,onContextMenu:Rt,data:{objectRef:n}});function s(r){const a=ae.createCommandEncoder(),l=t.getCurrentTexture().createView(),h=a.beginRenderPass({colorAttachments:[{view:l,loadOp:"clear",storeOp:"store"}]});X.updateUniforms({time:r/1e3}),X.render(h),mt.render(h),h.end(),ae.queue.submit([a.finish()]),requestAnimationFrame(s)}requestAnimationFrame(s)}let Ve=!1,Re=!1,ye=[0,0];function Nt(o,e){X.updateUniforms({resolution:[o,e]}),T.aspect=o/e,T.updateMatrices()}function Gn(o){o.addEventListener("mousedown",e=>{const t=o.getBoundingClientRect(),i=e.clientX-t.left,n=e.clientY-t.top;e.button===0&&(Ve=!0),e.button===2&&(Re=!0),ye=[i,n],X.updateUniforms({mouse:[i,n,1,0]}),(async()=>{await new Promise(r=>setTimeout(r,50));const s=await X.checkCollision();s&&console.log(`intersected object name: ${s.name}`),Vt(s)})()}),o.addEventListener("mouseup",e=>{const t=o.getBoundingClientRect(),i=e.clientX-t.left,n=e.clientY-t.top;e.button===0&&(Ve=!1),e.button===2&&(Re=!1),X.updateUniforms({mouse:[i,n,0,0]})}),o.addEventListener("mousemove",e=>{const t=o.getBoundingClientRect(),i=e.clientX-t.left,n=e.clientY-t.top,s=i-ye[0],r=n-ye[1];ye=[i,n];const a=.005,l=.01;if(Ve&&(T.orbit(s,r,a),T.updateMatrices()),Re){const h=Q();Ne(h,T.target,T.position),le(h,h);const d=Q();ge(d,h,T.up),le(d,d);const c=Q();ge(c,d,h),_e(T.position,T.position,d,-s*l),_e(T.target,T.target,d,-s*l),_e(T.position,T.position,c,r*l),_e(T.target,T.target,c,r*l),T.updateMatrices()}}),o.addEventListener("wheel",e=>{T.zoom(e.deltaY),T.updateMatrices()}),window.addEventListener("contextmenu",e=>e.preventDefault())}
